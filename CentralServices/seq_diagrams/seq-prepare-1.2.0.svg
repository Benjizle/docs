<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2618px" preserveAspectRatio="none" style="width:2086px;height:2618px;" version="1.1" viewBox="0 0 2086 2618" width="2086px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vy3v29rzfo1u" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="606" x="741" y="23.5352">1.2.0. DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure</text><rect fill="#D3D3D3" height="2572.666" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="2572.666" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2572.666" style="stroke: #A80036; stroke-width: 1.0;" width="1409.5" x="649.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1303.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="506.3848" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="753.9551"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="2330.4023" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="876.5" y="1159.4082"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="876.5" y="1289.6504"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="2330.4023" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1234.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1559.5" y="2278.9355"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1750.5" y="2338.2461"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1865" y="1570.1348"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2002" y="1599.4453"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="2316.4023" style="stroke: #000000; stroke-width: 2.0;" width="2042" x="33" y="170.7754"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="914.5" x="1150.5" y="1531.5137"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="720.5" x2="720.5" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="881.5" x2="881.5" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1239.5" x2="1239.5" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1564" x2="1564" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1755.5" x2="1755.5" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1869.5" x2="1869.5" y1="153.7754" y2="2504.1777"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2007" x2="2007" y1="153.7754" y2="2504.1777"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2516.7129">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="2533.2012">Payer</text><ellipse cx="67.5" cy="2546.1543" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2554.1543 L67.5,2581.1543 M54.5,2562.1543 L80.5,2562.1543 M67.5,2581.1543 L54.5,2596.1543 M67.5,2581.1543 L80.5,2596.1543 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2516.7129">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="2533.2012">Payee</text><ellipse cx="126.5" cy="2546.1543" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2554.1543 L126.5,2581.1543 M113.5,2562.1543 L139.5,2562.1543 M126.5,2581.1543 L113.5,2596.1543 M126.5,2581.1543 L139.5,2596.1543 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="150.8223">ML API Adapter</text><path d="M325,109.2871 L325,133.2871 M325,121.2871 L342,121.2871 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="121.2871" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2516.7129">ML API Adapter</text><path d="M325,2523.666 L325,2547.666 M325,2535.666 L342,2535.666 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2535.666" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="150.8223">ML API Notification Event Handler</text><ellipse cx="527" cy="121.2871" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,109.2871,529,104.2871,527,109.2871,529,114.2871,523,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="2516.7129">ML API Notification Event Handler</text><ellipse cx="527" cy="2535.666" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,2523.666,529,2518.666,527,2523.666,529,2528.666,523,2523.666" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="653.5" y="150.8223">Central Service API</text><path d="M700,109.2871 L700,133.2871 M700,121.2871 L717,121.2871 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="729" cy="121.2871" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="653.5" y="2516.7129">Central Service API</text><path d="M700,2523.666 L700,2547.666 M700,2535.666 L717,2535.666 " fill="none" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="729" cy="2535.666" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="801.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="797.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="804.5" y="138.8223">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="801.5" y="2503.1777"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="797.5" y="2507.1777"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="804.5" y="2527.7129">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1160.5" y="150.8223">Prepare Event Handler</text><ellipse cx="1239.5" cy="121.2871" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1235.5,109.2871,1241.5,104.2871,1239.5,109.2871,1241.5,114.2871,1235.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1160.5" y="2516.7129">Prepare Event Handler</text><ellipse cx="1239.5" cy="2535.666" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1235.5,2523.666,1241.5,2518.666,1239.5,2523.666,1241.5,2528.666,1235.5,2523.666" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1495" y="114.2871"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1491" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1498" y="138.8223">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1495" y="2503.1777"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1491" y="2507.1777"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1498" y="2527.7129">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="1704.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="1700.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="1707.5" y="138.8223">Errors-Topic</text><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="1704.5" y="2503.1777"/><rect fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="1700.5" y="2507.1777"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="1707.5" y="2527.7129">Errors-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1820.5" y="150.8223">Transfer DAO</text><ellipse cx="1870" cy="121.2871" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1858" x2="1882" y1="135.2871" y2="135.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1820.5" y="2516.7129">Transfer DAO</text><ellipse cx="1870" cy="2535.666" fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1858" x2="1882" y1="2549.666" y2="2549.666"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1959" y="150.8223">Central Store</text><path d="M1989,101.2871 C1989,91.2871 2007,91.2871 2007,91.2871 C2007,91.2871 2025,91.2871 2025,101.2871 L2025,127.2871 C2025,137.2871 2007,137.2871 2007,137.2871 C2007,137.2871 1989,137.2871 1989,127.2871 L1989,101.2871 " fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1989,101.2871 C1989,111.2871 2007,111.2871 2007,111.2871 C2007,111.2871 2025,111.2871 2025,101.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1959" y="2516.7129">Central Store</text><path d="M1989,2529.666 C1989,2519.666 2007,2519.666 2007,2519.666 C2007,2519.666 2025,2519.666 2025,2529.666 L2025,2555.666 C2025,2565.666 2007,2565.666 2007,2565.666 C2007,2565.666 1989,2565.666 1989,2555.666 L1989,2529.666 " fill="#FEFECE" filter="url(#f1vy3v29rzfo1u)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1989,2529.666 C1989,2539.666 2007,2539.666 2007,2539.666 C2007,2539.666 2025,2539.666 2025,2529.666 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="506.3848" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="753.9551"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="2330.4023" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="876.5" y="1159.4082"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="876.5" y="1289.6504"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="2330.4023" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1234.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1559.5" y="2278.9355"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1750.5" y="2338.2461"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1865" y="1570.1348"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2002" y="1599.4453"/><path d="M33,170.7754 L253,170.7754 L253,177.7754 L243,187.7754 L33,187.7754 L33,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2316.4023" style="stroke: #000000; stroke-width: 2.0;" width="2042" x="33" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="48" y="184.3438">Prepare Validation Failure</text><path d="M72,193.0859 L72,723.0859 L413,723.0859 L413,203.0859 L403,193.0859 L72,193.0859 " fill="#FFFF00" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,193.0859 L403,203.0859 L413,203.0859 L403,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="78" y="210.6543">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="225.9648">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="241.2754">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="256.5859">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="271.8965">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="287.207">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="302.5176">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="317.8281">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="333.1387">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="348.4492">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="363.7598">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="379.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="394.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="78" y="409.6914">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="425.002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="94" y="440.3125">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="94" y="455.623">"payeeFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="94" y="470.9336">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="94" y="486.2441">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="110" y="501.5547">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="110" y="516.8652">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="532.1758">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="94" y="547.4863">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="94" y="562.7969">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="94" y="578.1074">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="593.418">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="608.7285">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="624.0391">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="142" y="639.3496">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="142" y="654.6602">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="669.9707">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="685.2813">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="700.5918">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="715.9023">}</text><polygon fill="#A80036" points="328.5,749.9551,338.5,753.9551,328.5,757.9551,332.5,753.9551" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="753.9551" y2="753.9551"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="749.2129">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="749.2129">POST - http://transfers</text><path d="M355,766.9551 L355,1128.9551 L617,1128.9551 L617,776.9551 L607,766.9551 L355,766.9551 " fill="#FFFF00" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M607,766.9551 L607,776.9551 L617,776.9551 L607,766.9551 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="784.5234">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="799.834">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="377" y="815.1445">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="377" y="830.4551">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="377" y="845.7656">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="861.0762">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="876.3867">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="393" y="891.6973">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="393" y="907.0078">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="922.3184">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="937.6289">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="952.9395">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="968.25">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="983.5605">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="998.8711">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="1014.1816">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1029.4922">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="425" y="1044.8027">status: "success"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1060.1133">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1075.4238">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1090.7344">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1106.0449">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1121.3555">}</text><polygon fill="#A80036" points="864.5,1155.4082,874.5,1159.4082,864.5,1163.4082,868.5,1159.4082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="870.5" y1="1159.4082" y2="1159.4082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1154.666">2</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="271" x="370.5" y="1154.666">Route &amp; Publish Prepare event for Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="886.5" x2="928.5" y1="1188.7188" y2="1188.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="928.5" x2="928.5" y1="1188.7188" y2="1201.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="887.5" x2="928.5" y1="1201.7188" y2="1201.7188"/><polygon fill="#A80036" points="897.5,1197.7188,887.5,1201.7188,897.5,1205.7188,893.5,1201.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="893.5" y="1183.9766">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="906.5" y="1183.9766">Ensure event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,1227.0293,351.5,1231.0293,361.5,1235.0293,357.5,1231.0293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="880.5" y1="1231.0293" y2="1231.0293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1226.2871">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363" x="380.5" y="1226.2871">Respond replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,1256.3398,68.5,1260.3398,78.5,1264.3398,74.5,1260.3398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="72.5" x2="344.5" y1="1260.3398" y2="1260.3398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1255.5977">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1255.5977">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="897.5,1285.6504,887.5,1289.6504,897.5,1293.6504,893.5,1289.6504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="891.5" x2="1233.5" y1="1289.6504" y2="1289.6504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="903.5" y="1284.9082">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="916.5" y="1284.9082">Consume Prepare event message for Payer</text><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="218" x="1157.5" y="1352.6504"/><polygon fill="#EEEEEE" points="1157.5,1352.6504,1221.5,1352.6504,1221.5,1359.6504,1211.5,1369.6504,1157.5,1369.6504,1157.5,1352.6504" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1170.5" y="1367.2188">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="1163.5" y="1386.2188">Persist Event Information {1.1.1.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1167.5" y="1401.5293"/><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="216" x="1157.5" y="1438.582"/><polygon fill="#EEEEEE" points="1157.5,1438.582,1221.5,1438.582,1221.5,1445.582,1211.5,1455.582,1157.5,1455.582,1157.5,1438.582" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1170.5" y="1453.1504">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="1163.5" y="1472.1504">Validate Prepare Transfer {1.1.1.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1167.5" y="1487.4609"/><path d="M1150.5,1531.5137 L1694.5,1531.5137 L1694.5,1538.5137 L1684.5,1548.5137 L1150.5,1548.5137 L1150.5,1531.5137 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="914.5" x="1150.5" y="1531.5137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="499" x="1165.5" y="1545.082">Persist Transfer State (with transferState='ABORTED' on validation failure)</text><polygon fill="#A80036" points="1853,1566.1348,1863,1570.1348,1853,1574.1348,1857,1570.1348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1244.5" x2="1859" y1="1570.1348" y2="1570.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1251.5" y="1565.3926">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1264.5" y="1565.3926">Request to persist transfer</text><polygon fill="#A80036" points="1990,1595.4453,2000,1599.4453,1990,1603.4453,1994,1599.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1875" x2="1996" y1="1599.4453" y2="1599.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1882" y="1594.7031">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1895" y="1594.7031">Persist transfer</text><polygon fill="#A80036" points="1255.5,1654.7559,1245.5,1658.7559,1255.5,1662.7559,1251.5,1658.7559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1249.5" x2="1869" y1="1658.7559" y2="1658.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1261.5" y="1654.0137">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1274.5" y="1654.0137">Return success</text><path d="M1249,1678.7559 L1249,1703.7559 L1381,1703.7559 L1381,1688.7559 L1371,1678.7559 L1249,1678.7559 " fill="#FF0000" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1371,1678.7559 L1371,1688.7559 L1381,1688.7559 L1371,1678.7559 " fill="#FF0000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1255" y="1696.3242">Validation failure!</text><path d="M1249,1718.0664 L1249,2248.0664 L1856,2248.0664 L1856,1728.0664 L1846,1718.0664 L1249,1718.0664 " fill="#FFFF00" filter="url(#f1vy3v29rzfo1u)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1846,1718.0664 L1846,1728.0664 L1856,1728.0664 L1846,1718.0664 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1255" y="1735.6348">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1255" y="1750.9453">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1271" y="1766.2559">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="1271" y="1781.5664">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1271" y="1796.877">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1271" y="1812.1875">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1271" y="1827.498">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1287" y="1842.8086">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1287" y="1858.1191">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1303" y="1873.4297">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="1319" y="1888.7402">"errorCode": &lt;possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="1319" y="1904.0508">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="1319" y="1919.3613">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1287" y="1934.6719">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1271" y="1949.9824">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1271" y="1965.293">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1287" y="1980.6035">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1303" y="1995.9141">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1303" y="2011.2246">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1303" y="2026.5352">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1303" y="2041.8457">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1303" y="2057.1563">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="1303" y="2072.4668">status: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1319" y="2087.7773">type: functional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1319" y="2103.0879">code: failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1303" y="2118.3984">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="1303" y="2133.709">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="1319" y="2149.0195">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="1319" y="2164.3301">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="1319" y="2179.6406">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1303" y="2194.9512">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1287" y="2210.2617">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1271" y="2225.5723">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1255" y="2240.8828">}</text><polygon fill="#A80036" points="1547.5,2274.9355,1557.5,2278.9355,1547.5,2282.9355,1551.5,2278.9355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1244.5" x2="1553.5" y1="2278.9355" y2="2278.9355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1251.5" y="2274.1934">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="1273.5" y="2274.1934">Publish Notification (failure) event for Payer</text><polygon fill="#A80036" points="1738.5,2334.2461,1748.5,2338.2461,1738.5,2342.2461,1742.5,2338.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1244.5" x2="1744.5" y1="2338.2461" y2="2338.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1251.5" y="2333.5039">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="465" x="1273.5" y="2333.5039">Publish Notification (failure) event for Payer (handled by seperate process)</text><rect fill="#FFFFFF" filter="url(#f1vy3v29rzfo1u)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1597" x="40" y="2401.2461"/><polygon fill="#EEEEEE" points="40,2401.2461,104,2401.2461,104,2408.2461,94,2418.2461,40,2418.2461,40,2401.2461" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="53" y="2415.8145">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="694.5" y="2434.8145">Send notification to Participant (Payer) {1.1.4.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="698.5" y="2450.125"/><!--
@startuml
title 1.2.0. DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "Errors-Topic" as ERRORS_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant ERRORS_NOTIFICATIONS
    participant TRANS_DAO
    participant DB
end box

activate NOTIFY_HANDLER
activate PREP_HANDLER
group Prepare Validation Failure
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp1,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    DFSP1 -> MLAPI: POST - http://transfers
    activate MLAPI
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <transferMessage.payerFsp>,
            to: <transferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success"
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: <color #FF0000>**Route & Publish Prepare event for Payer**</color>
    activate TOPIC_PREPARE_DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensure event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 - -> MLAPI: Respond replication acknoledgements have been received
    deactivate TOPIC_PREPARE_DFSP1
    MLAPI - -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI

    TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume Prepare event message for Payer
    activate TOPIC_PREPARE_DFSP1
    deactivate TOPIC_PREPARE_DFSP1
    |||
    ref over PREP_HANDLER :  Persist Event Information {1.1.1.} \n
    |||
    ref over PREP_HANDLER :  Validate Prepare Transfer {1.1.1.} \n
    |||
    group Persist Transfer State (with transferState='ABORTED' on validation failure)
        PREP_HANDLER -> TRANS_DAO: Request to persist transfer
        activate TRANS_DAO
        TRANS_DAO -> DB: Persist transfer
        activate DB
        deactivate DB
        TRANS_DAO - -> PREP_HANDLER: Return success
        deactivate TRANS_DAO
    end

    note right of PREP_HANDLER #red: Validation failure!
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <ledgerName>,
            to: <transferMessage.payerFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: {
                    "errorInformation": {
                        "errorCode": <possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]>
                        "errorDescription": "<refer to section 35.1.3 for description>",
                        "extensionList": <transferMessage.extensionList>
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createdAt: <timestamp>,
                    status: {
                        type: functional
                        code: failure
                    }
                    state: {
                        status: 'error',
                        code: <errorInformation.errorCode>
                        description: <errorInformation.errorDescription>
                    }
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS
    PREP_HANDLER -> ERRORS_NOTIFICATIONS: Publish Notification (failure) event for Payer (handled by seperate process)
    activate ERRORS_NOTIFICATIONS
    deactivate ERRORS_NOTIFICATIONS
    |||
    ref over DFSP1, TOPIC_NOTIFICATIONS : Send notification to Participant (Payer) {1.1.4.} \n
    |||
end
deactivate PREP_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>