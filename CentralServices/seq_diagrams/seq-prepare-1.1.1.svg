<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4930px" preserveAspectRatio="none" style="width:1957px;height:4930px;" version="1.1" viewBox="0 0 1957 4930" width="1957px" zoomAndPan="magnify"><defs><filter height="300%" id="f16k6h9cmjtslm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="865.5" y="23.5352">1.1.1. Prepare Handler Consume</text><rect fill="#FFFFE0" height="4885.1641" style="stroke: #A80036; stroke-width: 1.0;" width="1706" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="831.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="195.9082"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="2819.4258"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="4717.877" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="1855.8516"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="4784.8535"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="923.7402"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="1306.1563"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="1954.4277"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="3607.5684"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="4235.1582"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="475.3926"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="699.5664"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="3074.5996"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="3341.084"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="504.7031"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="728.877"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="953.0508"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="1335.4668"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="1983.7383"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="3103.9102"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="3370.3945"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="3636.8789"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="4264.4688"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="4703.877" style="stroke: #000000; stroke-width: 2.0;" width="1933" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="4672.5664" style="stroke: #000000; stroke-width: 2.0;" width="1913" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="828" x="407" y="241.2188"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="816.7637" style="stroke: #000000; stroke-width: 2.0;" width="1354" x="397" y="412.7715"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="437.082"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="661.2559"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="885.4297"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="1532.9355" style="stroke: #000000; stroke-width: 2.0;" width="1529" x="397" y="1243.5352"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1361" x="407" y="1267.8457"/><rect fill="#FFFFFF" height="882.3086" style="stroke: none; stroke-width: 1.0;" width="1529" x="397" y="1894.1621"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1361" x="407" y="1916.1172"/><rect fill="#FFFFFF" height="2046.6934" style="stroke: none; stroke-width: 1.0;" width="1913" x="23" y="2783.4707"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="828" x="407" y="2864.7363"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1335" x="407" y="3036.2891"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1335" x="407" y="3302.7734"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="3569.2578"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="1029.7324" style="stroke: #000000; stroke-width: 2.0;" width="1391" x="387" y="3793.4316"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="631" x="397" y="3817.7422"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="610" x="407" y="3842.0527"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="611" x="407" y="3915.6738"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="554" x="407" y="3989.2949"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1361" x="407" y="4196.8477"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="117" x2="117" y1="116.2871" y2="4854.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="496" x2="496" y1="116.2871" y2="4854.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1018" x2="1018" y1="116.2871" y2="4854.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1169" x2="1169" y1="116.2871" y2="4854.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1284" x2="1284" y1="116.2871" y2="4854.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1401" x2="1401" y1="116.2871" y2="4854.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1683" x2="1683" y1="116.2871" y2="4854.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1828" x2="1828" y1="116.2871" y2="4854.1641"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="37" y="76.7988"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="33" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="40" y="101.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="37" y="4853.1641"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="33" y="4857.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="40" y="4877.6992">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="417" y="113.334">Prepare Event Handler</text><ellipse cx="496" cy="83.7988" fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="492,71.7988,498,66.7988,496,71.7988,498,76.7988,492,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="417" y="4866.6992">Prepare Event Handler</text><ellipse cx="496" cy="4885.6523" fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="492,4873.6523,498,4868.6523,496,4873.6523,498,4878.6523,492,4873.6523" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="937" y="76.7988"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="933" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="940" y="101.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="937" y="4853.1641"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="933" y="4857.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="940" y="4877.6992">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="1117" y="76.7988"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="1113" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1120" y="101.334">Events-Topic</text><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="1117" y="4853.1641"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="1113" y="4857.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1120" y="4877.6992">Events-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1235" y="113.334">Transfer DAO</text><ellipse cx="1284.5" cy="83.7988" fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1272.5" x2="1296.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1235" y="4866.6992">Transfer DAO</text><ellipse cx="1284.5" cy="4885.6523" fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1272.5" x2="1296.5" y1="4899.6523" y2="4899.6523"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1344" y="113.334">Participant DAO</text><ellipse cx="1401" cy="83.7988" fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1389" x2="1413" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1344" y="4866.6992">Participant DAO</text><ellipse cx="1401" cy="4885.6523" fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1389" x2="1413" y1="4899.6523" y2="4899.6523"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1635" y="113.334">Central Store</text><path d="M1665,63.7988 C1665,53.7988 1683,53.7988 1683,53.7988 C1683,53.7988 1701,53.7988 1701,63.7988 L1701,89.7988 C1701,99.7988 1683,99.7988 1683,99.7988 C1683,99.7988 1665,99.7988 1665,89.7988 L1665,63.7988 " fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1665,63.7988 C1665,73.7988 1683,73.7988 1683,73.7988 C1683,73.7988 1701,73.7988 1701,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1635" y="4866.6992">Central Store</text><path d="M1665,4879.6523 C1665,4869.6523 1683,4869.6523 1683,4869.6523 C1683,4869.6523 1701,4869.6523 1701,4879.6523 L1701,4905.6523 C1701,4915.6523 1683,4915.6523 1683,4915.6523 C1683,4915.6523 1665,4915.6523 1665,4905.6523 L1665,4879.6523 " fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1665,4879.6523 C1665,4889.6523 1683,4889.6523 1683,4889.6523 C1683,4889.6523 1701,4889.6523 1701,4879.6523 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1741" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1748" y="101.334">TOPIC_NOTIFICATIONS</text><rect fill="#FEFECE" filter="url(#f16k6h9cmjtslm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1741" y="4853.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1748" y="4873.6992">TOPIC_NOTIFICATIONS</text><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="195.9082"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="2819.4258"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="4717.877" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="1855.8516"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="4784.8535"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="923.7402"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="1306.1563"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="1954.4277"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="3607.5684"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279.5" y="4235.1582"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="475.3926"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="699.5664"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="3074.5996"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1396" y="3341.084"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="504.7031"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="728.877"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="953.0508"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="1335.4668"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="1983.7383"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="3103.9102"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="3370.3945"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="3636.8789"/><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1678" y="4264.4688"/><rect fill="none" height="4703.877" style="stroke: #000000; stroke-width: 2.0;" width="1933" x="13" y="133.2871"/><polygon fill="#EEEEEE" points="13,133.2871,236,133.2871,236,140.2871,226,150.2871,13,150.2871,13,133.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="28" y="146.8555">Prepare Handler Consume</text><rect fill="none" height="4672.5664" style="stroke: #000000; stroke-width: 2.0;" width="1913" x="23" y="157.5977"/><polygon fill="#EEEEEE" points="23,157.5977,85,157.5977,85,164.5977,75,174.5977,23,174.5977,23,157.5977" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="170.2324">[Consume Single Message]</text><polygon fill="#A80036" points="133,191.9082,123,195.9082,133,199.9082,129,195.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127" x2="490" y1="195.9082" y2="195.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="139" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="152" y="191.4766">Consume Prepare event message for Payer</text><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="828" x="407" y="241.2188"/><polygon fill="#EEEEEE" points="407,241.2188,622,241.2188,622,248.2188,612,258.2188,407,258.2188,407,241.2188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="422" y="254.7871">Persist Event Information</text><polygon fill="#A80036" points="1157,300.5293,1167,304.5293,1157,308.5293,1161,304.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1163" y1="304.5293" y2="304.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="508" y="300.0977">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="521" y="300.0977">Publish event information</text><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="810" x="414" y="312.8398"/><polygon fill="#EEEEEE" points="414,312.8398,478,312.8398,478,319.8398,468,329.8398,414,329.8398,414,312.8398" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="427" y="327.4082">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="720" y="346.4082">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="724" y="361.7188"/><rect fill="none" height="816.7637" style="stroke: #000000; stroke-width: 2.0;" width="1354" x="397" y="412.7715"/><polygon fill="#EEEEEE" points="397,412.7715,616,412.7715,616,419.7715,606,429.7715,397,429.7715,397,412.7715" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="412" y="426.3398">Validate Prepare Transfer</text><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="437.082"/><polygon fill="#EEEEEE" points="407,437.082,549,437.082,549,444.082,539,454.082,407,454.082,407,437.082" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="422" y="450.6504">Validate Payer</text><polygon fill="#A80036" points="1384,471.3926,1394,475.3926,1384,479.3926,1388,475.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1390" y1="475.3926" y2="475.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="508" y="470.9609">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="521" y="470.9609">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1666,500.7031,1676,504.7031,1666,508.7031,1670,504.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1406" x2="1672" y1="504.7031" y2="504.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1413" y="500.2715">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1426" y="500.2715">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1645,518.0137,1720,518.0137,1730,529.0137,1720,541.0137,1645,541.0137,1635,529.0137,1645,518.0137" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="1647" y="534.582">particpants</text><polygon fill="#A80036" points="1417,563.3242,1407,567.3242,1417,571.3242,1413,567.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1411" x2="1682" y1="567.3242" y2="567.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1423" y="562.8926">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1436" y="562.8926">Return Participant details if it exists</text><polygon fill="#A80036" points="512,592.6348,502,596.6348,512,600.6348,508,596.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1400" y1="596.6348" y2="596.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="518" y="592.2031">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="531" y="592.2031">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="626.2559" y2="626.2559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="626.2559" y2="639.2559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="639.2559" y2="639.2559"/><polygon fill="#A80036" points="512,635.2559,502,639.2559,512,643.2559,508,639.2559" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="508" y="621.5137">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="521" y="621.5137">Validate Payer</text><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="661.2559"/><polygon fill="#EEEEEE" points="407,661.2559,551,661.2559,551,668.2559,541,678.2559,407,678.2559,407,661.2559" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="422" y="674.8242">Validate Payee</text><polygon fill="#A80036" points="1384,695.5664,1394,699.5664,1384,703.5664,1388,699.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1390" y1="699.5664" y2="699.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="508" y="695.1348">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="521" y="695.1348">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1666,724.877,1676,728.877,1666,732.877,1670,728.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1406" x2="1672" y1="728.877" y2="728.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1413" y="724.4453">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1426" y="724.4453">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1645,742.1875,1720,742.1875,1730,753.1875,1720,765.1875,1645,765.1875,1635,753.1875,1645,742.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="1647" y="758.7559">particpants</text><polygon fill="#A80036" points="1417,787.498,1407,791.498,1417,795.498,1413,791.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1411" x2="1682" y1="791.498" y2="791.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1423" y="787.0664">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1445" y="787.0664">Return Participant details if it exists</text><polygon fill="#A80036" points="512,816.8086,502,820.8086,512,824.8086,508,820.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1400" y1="820.8086" y2="820.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="816.377">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="540" y="816.377">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="850.4297" y2="850.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="850.4297" y2="863.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="863.4297" y2="863.4297"/><polygon fill="#A80036" points="512,859.4297,502,863.4297,512,867.4297,508,863.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="845.6875">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="530" y="845.6875">Validate Payee</text><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="885.4297"/><polygon fill="#EEEEEE" points="407,885.4297,559,885.4297,559,892.4297,549,902.4297,407,902.4297,407,885.4297" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="422" y="898.998">Duplicate check</text><polygon fill="#A80036" points="1267.5,919.7402,1277.5,923.7402,1267.5,927.7402,1271.5,923.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1273.5" y1="923.7402" y2="923.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="919.3086">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="530" y="919.3086">Request to retrieve Transfer (if it exists)</text><polygon fill="#A80036" points="1666,949.0508,1676,953.0508,1666,957.0508,1670,953.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1289.5" x2="1672" y1="953.0508" y2="953.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1296.5" y="948.6191">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="1318.5" y="948.6191">Request Transfer</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1653,966.3613,1713,966.3613,1723,977.3613,1713,989.3613,1653,989.3613,1643,977.3613,1653,966.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="1655" y="982.9297">transfers</text><polygon fill="#A80036" points="1300.5,1011.6719,1290.5,1015.6719,1300.5,1019.6719,1296.5,1015.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1294.5" x2="1682" y1="1015.6719" y2="1015.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1306.5" y="1011.2402">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1328.5" y="1011.2402">Return Transfer if it exists</text><polygon fill="#A80036" points="512,1040.9824,502,1044.9824,512,1048.9824,508,1044.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1283.5" y1="1044.9824" y2="1044.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="1040.5508">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="540" y="1040.5508">Return Transfer if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="1074.6035" y2="1074.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="1074.6035" y2="1087.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="1087.6035" y2="1087.6035"/><polygon fill="#A80036" points="512,1083.6035,502,1087.6035,512,1091.6035,508,1087.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1069.8613">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="530" y="1069.8613">Validate duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="1123.9141" y2="1123.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="1123.9141" y2="1136.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="1136.9141" y2="1136.9141"/><polygon fill="#A80036" points="512,1132.9141,502,1136.9141,512,1140.9141,508,1136.9141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1119.1719">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="530" y="1119.1719">Validate amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="1166.2246" y2="1166.2246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="1166.2246" y2="1179.2246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="1179.2246" y2="1179.2246"/><polygon fill="#A80036" points="512,1175.2246,502,1179.2246,512,1183.2246,508,1179.2246" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1161.4824">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="530" y="1161.4824">Validate crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="1208.5352" y2="1208.5352"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="1208.5352" y2="1221.5352"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="1221.5352" y2="1221.5352"/><polygon fill="#A80036" points="512,1217.5352,502,1221.5352,512,1225.5352,508,1221.5352" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1203.793">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="530" y="1203.793">Validate message signature (to be confirmed in future requirement)</text><rect fill="none" height="1532.9355" style="stroke: #000000; stroke-width: 2.0;" width="1529" x="397" y="1243.5352"/><polygon fill="#EEEEEE" points="397,1243.5352,459,1243.5352,459,1250.5352,449,1260.5352,397,1260.5352,397,1243.5352" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="412" y="1257.1035">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="474" y="1256.1699">[Validation success]</text><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1361" x="407" y="1267.8457"/><polygon fill="#EEEEEE" points="407,1267.8457,938,1267.8457,938,1274.8457,928,1284.8457,407,1284.8457,407,1267.8457" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="486" x="422" y="1281.4141">Persist Transfer State (with transferState='RECEIVED' on validation pass)</text><polygon fill="#A80036" points="1267.5,1302.1563,1277.5,1306.1563,1267.5,1310.1563,1271.5,1306.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1273.5" y1="1306.1563" y2="1306.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1301.7246">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="530" y="1301.7246">Request to persist transfer</text><polygon fill="#A80036" points="1666,1331.4668,1676,1335.4668,1666,1339.4668,1670,1335.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1289.5" x2="1672" y1="1335.4668" y2="1335.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1296.5" y="1331.0352">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1318.5" y="1331.0352">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1617,1378.7773,1748,1378.7773,1758,1389.7773,1748,1401.7773,1617,1401.7773,1607,1389.7773,1617,1378.7773" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1619" y="1395.3457">transferStateChange</text><polygon fill="#A80036" points="512,1424.0879,502,1428.0879,512,1432.0879,508,1428.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1283.5" y1="1428.0879" y2="1428.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="1423.6563">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="540" y="1423.6563">Return success</text><polygon fill="#FFFF00" filter="url(#f16k6h9cmjtslm)" points="506,1448.3984,506,1825.3984,768,1825.3984,768,1458.3984,758,1448.3984,506,1448.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="758" x2="758" y1="1448.3984" y2="1458.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768" x2="758" y1="1458.3984" y2="1458.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="512" y="1465.9668">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="1481.2773">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="528" y="1496.5879">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="528" y="1511.8984">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="528" y="1527.209">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="528" y="1542.5195">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="528" y="1557.8301">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="544" y="1573.1406">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="544" y="1588.4512">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="528" y="1603.7617">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="528" y="1619.0723">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="544" y="1634.3828">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="560" y="1649.6934">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="560" y="1665.0039">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="560" y="1680.3145">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="560" y="1695.625">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="560" y="1710.9355">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="560" y="1726.2461">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="576" y="1741.5566">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="576" y="1756.8672">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="560" y="1772.1777">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="544" y="1787.4883">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="528" y="1802.7988">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="1818.1094">}</text><polygon fill="#A80036" points="1001,1851.8516,1011,1855.8516,1001,1859.8516,1005,1855.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1007" y1="1855.8516" y2="1855.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1851.4199">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="530" y="1851.4199">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="397" x2="1926" y1="1895.1621" y2="1895.1621"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="402" y="1905.7969">[Validation failure]</text><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1361" x="407" y="1916.1172"/><polygon fill="#EEEEEE" points="407,1916.1172,928,1916.1172,928,1923.1172,918,1933.1172,407,1933.1172,407,1916.1172" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="476" x="422" y="1929.6855">Persist Transfer State (with transferState='ABORTED' on validation fail)</text><polygon fill="#A80036" points="1267.5,1950.4277,1277.5,1954.4277,1267.5,1958.4277,1271.5,1954.4277" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1273.5" y1="1954.4277" y2="1954.4277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1949.9961">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="530" y="1949.9961">Request to persist transfer</text><polygon fill="#A80036" points="1666,1979.7383,1676,1983.7383,1666,1987.7383,1670,1983.7383" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1289.5" x2="1672" y1="1983.7383" y2="1983.7383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1296.5" y="1979.3066">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1318.5" y="1979.3066">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1617,2027.0488,1748,2027.0488,1758,2038.0488,1748,2050.0488,1617,2050.0488,1607,2038.0488,1617,2027.0488" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1619" y="2043.6172">transferStateChange</text><polygon fill="#A80036" points="512,2072.3594,502,2076.3594,512,2080.3594,508,2076.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1283.5" y1="2076.3594" y2="2076.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="2071.9277">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="540" y="2071.9277">Return success</text><polygon fill="#FFFF00" filter="url(#f16k6h9cmjtslm)" points="506,2096.6699,506,2626.6699,1113,2626.6699,1113,2106.6699,1103,2096.6699,506,2096.6699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1103" x2="1103" y1="2096.6699" y2="2106.6699"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113" x2="1103" y1="2106.6699" y2="2106.6699"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="512" y="2114.2383">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="2129.5488">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="528" y="2144.8594">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="528" y="2160.1699">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="528" y="2175.4805">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="528" y="2190.791">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="528" y="2206.1016">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="544" y="2221.4121">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="544" y="2236.7227">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="560" y="2252.0332">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="576" y="2267.3438">"errorCode": &lt;possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="576" y="2282.6543">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="576" y="2297.9648">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="544" y="2313.2754">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="528" y="2328.5859">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="528" y="2343.8965">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="544" y="2359.207">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="560" y="2374.5176">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="560" y="2389.8281">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="560" y="2405.1387">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="560" y="2420.4492">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="560" y="2435.7598">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="560" y="2451.0703">status: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="576" y="2466.3809">type: functional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="576" y="2481.6914">code: failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="560" y="2497.002">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="560" y="2512.3125">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="576" y="2527.623">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="576" y="2542.9336">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="576" y="2558.2441">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="560" y="2573.5547">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="544" y="2588.8652">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="528" y="2604.1758">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="2619.4863">}</text><polygon fill="#A80036" points="1816.5,2653.2285,1826.5,2657.2285,1816.5,2661.2285,1820.5,2657.2285" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1822.5" y1="2657.2285" y2="2657.2285"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2652.7969">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="530" y="2652.7969">Publish Notification (failure) event for Payer</text><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1501" x="414" y="2690.5391"/><polygon fill="#EEEEEE" points="414,2690.5391,478,2690.5391,478,2697.5391,468,2707.5391,414,2707.5391,414,2690.5391" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="427" y="2705.1074">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="1038" y="2724.1074">Send Notifixations to Participant {1.1.4.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1042" y="2739.418"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1936" y1="2784.4707" y2="2784.4707"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="2795.1055">[Consume Batch Messages]</text><polygon fill="#A80036" points="133,2815.4258,123,2819.4258,133,2823.4258,129,2819.4258" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127" x2="490" y1="2819.4258" y2="2819.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="139" y="2814.9941">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="161" y="2814.9941">Consume Prepare event batch of messages for Payer</text><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="828" x="407" y="2864.7363"/><polygon fill="#EEEEEE" points="407,2864.7363,622,2864.7363,622,2871.7363,612,2881.7363,407,2881.7363,407,2864.7363" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="422" y="2878.3047">Persist Event Information</text><polygon fill="#A80036" points="1157,2924.0469,1167,2928.0469,1157,2932.0469,1161,2928.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1163" y1="2928.0469" y2="2928.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2923.6152">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="530" y="2923.6152">Publish event information</text><rect fill="#FFFFFF" filter="url(#f16k6h9cmjtslm)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="810" x="414" y="2936.3574"/><polygon fill="#EEEEEE" points="414,2936.3574,478,2936.3574,478,2943.3574,468,2953.3574,414,2953.3574,414,2936.3574" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="427" y="2950.9258">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="720" y="2969.9258">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="724" y="2985.2363"/><rect fill="none" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1335" x="407" y="3036.2891"/><polygon fill="#EEEEEE" points="407,3036.2891,655,3036.2891,655,3043.2891,645,3053.2891,407,3053.2891,407,3036.2891" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="422" y="3049.8574">Fetch batch Payer information</text><polygon fill="#A80036" points="1384,3070.5996,1394,3074.5996,1384,3078.5996,1388,3074.5996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1390" y1="3074.5996" y2="3074.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3070.168">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="530" y="3070.168">Request to retrieve batch of Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1666,3099.9102,1676,3103.9102,1666,3107.9102,1670,3103.9102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1406" x2="1672" y1="3103.9102" y2="3103.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1413" y="3099.4785">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1435" y="3099.4785">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1643,3117.2207,1722,3117.2207,1732,3128.2207,1722,3140.2207,1643,3140.2207,1633,3128.2207,1643,3117.2207" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="1645" y="3133.7891">participants</text><polygon fill="#A80036" points="1417,3162.5313,1407,3166.5313,1417,3170.5313,1413,3166.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1411" x2="1682" y1="3166.5313" y2="3166.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1423" y="3162.0996">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1445" y="3162.0996">Return Participant details if it exists</text><polygon fill="#A80036" points="512,3191.8418,502,3195.8418,512,3199.8418,508,3195.8418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1400" y1="3195.8418" y2="3195.8418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="3191.4102">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="540" y="3191.4102">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="3225.4629" y2="3225.4629"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="3225.4629" y2="3238.4629"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="3238.4629" y2="3238.4629"/><polygon fill="#A80036" points="512,3234.4629,502,3238.4629,512,3242.4629,508,3238.4629" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3220.7207">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="530" y="3220.7207">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="3267.7734" y2="3267.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="3267.7734" y2="3280.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="3280.7734" y2="3280.7734"/><polygon fill="#A80036" points="512,3276.7734,502,3280.7734,512,3284.7734,508,3280.7734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3263.0313">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="530" y="3263.0313">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER</text><rect fill="none" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1335" x="407" y="3302.7734"/><polygon fill="#EEEEEE" points="407,3302.7734,657,3302.7734,657,3309.7734,647,3319.7734,407,3319.7734,407,3302.7734" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="422" y="3316.3418">Fetch batch Payee information</text><polygon fill="#A80036" points="1384,3337.084,1394,3341.084,1384,3345.084,1388,3341.084" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1390" y1="3341.084" y2="3341.084"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3336.6523">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="530" y="3336.6523">Request to retrieve batch of Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1666,3366.3945,1676,3370.3945,1666,3374.3945,1670,3370.3945" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1406" x2="1672" y1="3370.3945" y2="3370.3945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1413" y="3365.9629">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1435" y="3365.9629">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1643,3383.7051,1722,3383.7051,1732,3394.7051,1722,3406.7051,1643,3406.7051,1633,3394.7051,1643,3383.7051" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="1645" y="3400.2734">participants</text><polygon fill="#A80036" points="1417,3429.0156,1407,3433.0156,1417,3437.0156,1413,3433.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1411" x2="1682" y1="3433.0156" y2="3433.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1423" y="3428.584">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1445" y="3428.584">Return Participant details if it exists</text><polygon fill="#A80036" points="512,3458.3262,502,3462.3262,512,3466.3262,508,3462.3262" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1400" y1="3462.3262" y2="3462.3262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="3457.8945">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="540" y="3457.8945">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="3491.9473" y2="3491.9473"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="3491.9473" y2="3504.9473"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="3504.9473" y2="3504.9473"/><polygon fill="#A80036" points="512,3500.9473,502,3504.9473,512,3508.9473,508,3504.9473" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3487.2051">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="530" y="3487.2051">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="3534.2578" y2="3534.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="3534.2578" y2="3547.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="3547.2578" y2="3547.2578"/><polygon fill="#A80036" points="512,3543.2578,502,3547.2578,512,3551.2578,508,3547.2578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3529.5156">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="530" y="3529.5156">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE</text><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="407" y="3569.2578"/><polygon fill="#EEEEEE" points="407,3569.2578,612,3569.2578,612,3576.2578,602,3586.2578,407,3586.2578,407,3569.2578" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="422" y="3582.8262">Fetch batch of transfers</text><polygon fill="#A80036" points="1267.5,3603.5684,1277.5,3607.5684,1267.5,3611.5684,1271.5,3607.5684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1273.5" y1="3607.5684" y2="3607.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3603.1367">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="530" y="3603.1367">Request to retrieve batch of Transfers (if it exists)</text><polygon fill="#A80036" points="1666,3632.8789,1676,3636.8789,1666,3640.8789,1670,3636.8789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1289.5" x2="1672" y1="3636.8789" y2="3636.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1296.5" y="3632.4473">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1318.5" y="3632.4473">Request batch of Transfers</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1653,3650.1895,1713,3650.1895,1723,3661.1895,1713,3673.1895,1653,3673.1895,1643,3661.1895,1653,3650.1895" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="1655" y="3666.7578">transfers</text><polygon fill="#A80036" points="1300.5,3695.5,1290.5,3699.5,1300.5,3703.5,1296.5,3699.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1294.5" x2="1682" y1="3699.5" y2="3699.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1306.5" y="3695.0684">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="1328.5" y="3695.0684">Return batch of Transfers (if it exists)</text><polygon fill="#A80036" points="512,3724.8105,502,3728.8105,512,3732.8105,508,3728.8105" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1283.5" y1="3728.8105" y2="3728.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="3724.3789">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="540" y="3724.3789">Return batch of Transfer (if it exists)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="3758.4316" y2="3758.4316"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="3758.4316" y2="3771.4316"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="3771.4316" y2="3771.4316"/><polygon fill="#A80036" points="512,3767.4316,502,3771.4316,512,3775.4316,508,3771.4316" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3753.6895">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="530" y="3753.6895">store result set in var: $LIST_TRANSFERS</text><rect fill="none" height="1029.7324" style="stroke: #000000; stroke-width: 2.0;" width="1391" x="387" y="3793.4316"/><polygon fill="#EEEEEE" points="387,3793.4316,461,3793.4316,461,3800.4316,451,3810.4316,387,3810.4316,387,3793.4316" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="402" y="3807">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="476" y="3806.0664">[for each message in batch]</text><rect fill="none" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="631" x="397" y="3817.7422"/><polygon fill="#EEEEEE" points="397,3817.7422,616,3817.7422,616,3824.7422,606,3834.7422,397,3834.7422,397,3817.7422" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="412" y="3831.3105">Validate Prepare Transfer</text><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="610" x="407" y="3842.0527"/><polygon fill="#EEEEEE" points="407,3842.0527,549,3842.0527,549,3849.0527,539,3859.0527,407,3859.0527,407,3842.0527" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="422" y="3855.6211">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="3880.6738" y2="3880.6738"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="3880.6738" y2="3893.6738"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="3893.6738" y2="3893.6738"/><polygon fill="#A80036" points="512,3889.6738,502,3893.6738,512,3897.6738,508,3893.6738" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3875.9316">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="475" x="530" y="3875.9316">Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER</text><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="611" x="407" y="3915.6738"/><polygon fill="#EEEEEE" points="407,3915.6738,551,3915.6738,551,3922.6738,541,3932.6738,407,3932.6738,407,3915.6738" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="422" y="3929.2422">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="3954.2949" y2="3954.2949"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="3954.2949" y2="3967.2949"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="3967.2949" y2="3967.2949"/><polygon fill="#A80036" points="512,3963.2949,502,3967.2949,512,3971.2949,508,3967.2949" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3949.5527">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="476" x="530" y="3949.5527">Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE</text><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="554" x="407" y="3989.2949"/><polygon fill="#EEEEEE" points="407,3989.2949,559,3989.2949,559,3996.2949,549,4006.2949,407,4006.2949,407,3989.2949" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="422" y="4002.8633">Duplicate check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="4027.916" y2="4027.916"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="4027.916" y2="4040.916"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="4040.916" y2="4040.916"/><polygon fill="#A80036" points="512,4036.916,502,4040.916,512,4044.916,508,4040.916" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="4023.1738">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="419" x="530" y="4023.1738">Validate duplicate Check against in-memory var $LIST_TRANSFERS</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="4077.2266" y2="4077.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="4077.2266" y2="4090.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="4090.2266" y2="4090.2266"/><polygon fill="#A80036" points="512,4086.2266,502,4090.2266,512,4094.2266,508,4090.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="4072.4844">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="530" y="4072.4844">Validate amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="4119.5371" y2="4119.5371"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="4119.5371" y2="4132.5371"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="4132.5371" y2="4132.5371"/><polygon fill="#A80036" points="512,4128.5371,502,4132.5371,512,4136.5371,508,4132.5371" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="4114.7949">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="530" y="4114.7949">Validate crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="4161.8477" y2="4161.8477"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="4161.8477" y2="4174.8477"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="4174.8477" y2="4174.8477"/><polygon fill="#A80036" points="512,4170.8477,502,4174.8477,512,4178.8477,508,4174.8477" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="4157.1055">53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="530" y="4157.1055">Validate message signature (to be confirmed in future requirement)</text><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1361" x="407" y="4196.8477"/><polygon fill="#EEEEEE" points="407,4196.8477,938,4196.8477,938,4203.8477,928,4213.8477,407,4213.8477,407,4196.8477" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="486" x="422" y="4210.416">Persist Transfer State (with transferState='RECEIVED' on validation pass)</text><polygon fill="#A80036" points="1267.5,4231.1582,1277.5,4235.1582,1267.5,4239.1582,1271.5,4235.1582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1273.5" y1="4235.1582" y2="4235.1582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="4230.7266">54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="530" y="4230.7266">Request to persist transfer</text><polygon fill="#A80036" points="1666,4260.4688,1676,4264.4688,1666,4268.4688,1670,4264.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1289.5" x2="1672" y1="4264.4688" y2="4264.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1296.5" y="4260.0371">55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1318.5" y="4260.0371">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f16k6h9cmjtslm)" points="1617,4307.7793,1748,4307.7793,1758,4318.7793,1748,4330.7793,1617,4330.7793,1607,4318.7793,1617,4307.7793" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1619" y="4324.3477">transferStateChange</text><polygon fill="#A80036" points="512,4353.0898,502,4357.0898,512,4361.0898,508,4357.0898" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1283.5" y1="4357.0898" y2="4357.0898"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="4352.6582">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="540" y="4352.6582">Return success</text><polygon fill="#FFFF00" filter="url(#f16k6h9cmjtslm)" points="506,4377.4004,506,4754.4004,768,4754.4004,768,4387.4004,758,4377.4004,506,4377.4004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="758" x2="758" y1="4377.4004" y2="4387.4004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768" x2="758" y1="4387.4004" y2="4387.4004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="512" y="4394.9688">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="4410.2793">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="528" y="4425.5898">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="528" y="4440.9004">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="528" y="4456.2109">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="528" y="4471.5215">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="528" y="4486.832">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="544" y="4502.1426">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="544" y="4517.4531">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="528" y="4532.7637">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="528" y="4548.0742">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="544" y="4563.3848">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="560" y="4578.6953">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="560" y="4594.0059">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="560" y="4609.3164">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="560" y="4624.627">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="560" y="4639.9375">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="560" y="4655.248">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="576" y="4670.5586">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="576" y="4685.8691">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="560" y="4701.1797">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="544" y="4716.4902">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="528" y="4731.8008">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="4747.1113">}</text><polygon fill="#A80036" points="1001,4780.8535,1011,4784.8535,1001,4788.8535,1005,4784.8535" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1007" y1="4784.8535" y2="4784.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="4780.4219">57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="530" y="4780.4219">Route &amp; Publish Position event for Payer</text><!--
@startuml
' declate title
title 1.1.1. Prepare Handler Consume

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
collections "Events-Topic" as TOPIC_EVENTS
entity "Transfer DAO" as TRANS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant TOPIC_EVENTS
    participant TRANS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

' start flow
activate PREP_HANDLER
group Prepare Handler Consume
    alt Consume Single Message
        TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume Prepare event message for Payer
        activate TOPIC_PREPARE_DFSP1
        deactivate TOPIC_PREPARE_DFSP1
        group Persist Event Information
            |||
            PREP_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end

        group Validate Prepare Transfer
            group Validate Payer
                PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
                activate PARTICIPANT_DAO
                PARTICIPANT_DAO -> DB: Request Participant details
                hnote over DB #lightyellow
                    particpants
                end note
                activate DB
                PARTICIPANT_DAO <- - DB: Return Participant details if it exists
                deactivate DB
                PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
                deactivate PARTICIPANT_DAO
                PREP_HANDLER <-> PREP_HANDLER: Validate Payer
            end
            group Validate Payee
                PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
                activate PARTICIPANT_DAO
                PARTICIPANT_DAO -> DB: Request Participant details
                hnote over DB #lightyellow
                    particpants
                end note
                activate DB
                PARTICIPANT_DAO <- - DB: Return Participant details if it exists
                deactivate DB
                PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
                deactivate PARTICIPANT_DAO
                PREP_HANDLER <-> PREP_HANDLER: Validate Payee
            end
            group Duplicate check
                PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer (if it exists)
                activate TRANS_DAO
                TRANS_DAO -> DB: Request Transfer
                hnote over DB #lightyellow
                    transfers
                end note
                activate DB
                TRANS_DAO <- - DB: Return Transfer if it exists
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return Transfer if it exists
                deactivate TRANS_DAO
                PREP_HANDLER <-> PREP_HANDLER: Validate duplicate Check
            end
            PREP_HANDLER <-> PREP_HANDLER: Validate amount
            PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition
            PREP_HANDLER <-> PREP_HANDLER: Validate message signature (to be confirmed in future requirement)
        end
        alt Validation success
            group Persist Transfer State (with transferState='RECEIVED' on validation pass)
                PREP_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    transferStateChange
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return success
                deactivate TRANS_DAO
            end

            note right of PREP_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: position,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            PREP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event for Payer
            activate TOPIC_POSITION_DFSP1
            deactivate TOPIC_POSITION_DFSP1
        else Validation failure
            group Persist Transfer State (with transferState='ABORTED' on validation fail)
                PREP_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    transferStateChange
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return success
                deactivate TRANS_DAO
            end
            note right of PREP_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <ledgerName>,
                    to: <transferMessage.payerFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": <possible codes: [3100, 3105, 3106, 3201, 3202, 3203, 3300, 3301]>
                                "errorDescription": "<refer to section 35.1.3 for description>",
                                "extensionList": <transferMessage.extensionList>
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            status: {
                                type: functional
                                code: failure
                            }
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer
            |||
            ref over PREP_HANDLER, TOPIC_NOTIFICATIONS :  Send Notifixations to Participant {1.1.4.} \n
            |||
        end

    else Consume Batch Messages
        TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume Prepare event batch of messages for Payer
        activate TOPIC_PREPARE_DFSP1
        deactivate TOPIC_PREPARE_DFSP1
        group Persist Event Information
            |||
            PREP_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end

        group Fetch batch Payer information
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payer Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participants
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payer
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER
        end

        group Fetch batch Payee information
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payee Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participants
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payee
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE
        end

        group Fetch batch of transfers
            PREP_HANDLER -> TRANS_DAO: Request to retrieve batch of Transfers (if it exists)
            activate TRANS_DAO
            TRANS_DAO -> DB: Request batch of Transfers
            hnote over DB #lightyellow
                transfers
            end note
            activate DB
            TRANS_DAO <- - DB: Return batch of Transfers (if it exists)
            deactivate DB
            TRANS_DAO - -> PREP_HANDLER: Return batch of Transfer (if it exists)
            deactivate TRANS_DAO
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_TRANSFERS
        end

        loop for each message in batch

            group Validate Prepare Transfer
                group Validate Payer
                    PREP_HANDLER <-> PREP_HANDLER: Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER
                end
                group Validate Payee
                    PREP_HANDLER <-> PREP_HANDLER: Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE
                end
                group Duplicate check
                    PREP_HANDLER <-> PREP_HANDLER: Validate duplicate Check against in-memory var $LIST_TRANSFERS
                end
                PREP_HANDLER <-> PREP_HANDLER: Validate amount
                PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition
                PREP_HANDLER <-> PREP_HANDLER: Validate message signature (to be confirmed in future requirement)
            end

            group Persist Transfer State (with transferState='RECEIVED' on validation pass)
                PREP_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    transferStateChange
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return success
                deactivate TRANS_DAO
            end

            note right of PREP_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: position,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            PREP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event for Payer
            activate TOPIC_POSITION_DFSP1
            deactivate TOPIC_POSITION_DFSP1
        end
    end
end
deactivate PREP_HANDLER
@enduml

PlantUML version 1.2017.18(Fri Oct 06 17:56:32 BST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>