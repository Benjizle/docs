<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3705px" preserveAspectRatio="none" style="width:1748px;height:3705px;" version="1.1" viewBox="0 0 1748 3705" width="1748px" zoomAndPan="magnify"><defs><filter height="300%" id="f87mi57bbncmr" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="761" y="23.5352">1.1.1. Prepare Handler Consume</text><rect fill="#FFFFE0" height="3660.4395" style="stroke: #A80036; stroke-width: 1.0;" width="1672" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="814.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="1750.5645"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="3493.1523" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="1676.2988"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="3560.4395"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1147" y="279.8398"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1147" y="1834.1855"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="835.1191"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="1159.9141"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="2449.7754"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="3044.0547"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="453.3926"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="644.2559"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="1983.4277"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="2216.6016"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="309.1504"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="482.7031"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="673.5664"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="864.4297"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="1189.2246"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="1863.4961"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="2012.7383"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="2245.9121"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="2479.0859"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="3073.3652"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="3479.1523" style="stroke: #000000; stroke-width: 2.0;" width="1724" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="3447.8418" style="stroke: #000000; stroke-width: 2.0;" width="1704" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="241.2188"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="716.832" style="stroke: #000000; stroke-width: 2.0;" width="1320" x="397" y="390.4609"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="414.7715"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="605.6348"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="796.498"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="1121.293"/><rect fill="#FFFFFF" height="1891.1406" style="stroke: none; stroke-width: 1.0;" width="1704" x="23" y="1714.2988"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="1795.5645"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="219.1738" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="1944.8066"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="219.1738" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="2177.9805"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="2411.1543"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="996.4219" style="stroke: #000000; stroke-width: 2.0;" width="1330" x="387" y="2602.0176"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="631" x="397" y="2626.3281"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="610" x="407" y="2650.6387"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="611" x="407" y="2724.2598"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="554" x="407" y="2797.8809"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="3005.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="117" x2="117" y1="116.2871" y2="3629.4395"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="496" x2="496" y1="116.2871" y2="3629.4395"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1018" x2="1018" y1="116.2871" y2="3629.4395"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1152" x2="1152" y1="116.2871" y2="3629.4395"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1250" x2="1250" y1="116.2871" y2="3629.4395"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1367" x2="1367" y1="116.2871" y2="3629.4395"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1649" x2="1649" y1="116.2871" y2="3629.4395"/><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="37" y="76.7988"/><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="33" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="40" y="101.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="37" y="3628.4395"/><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="33" y="3632.4395"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="40" y="3652.9746">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="417" y="113.334">Prepare Event Handler</text><ellipse cx="496" cy="83.7988" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="492,71.7988,498,66.7988,496,71.7988,498,76.7988,492,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="417" y="3641.9746">Prepare Event Handler</text><ellipse cx="496" cy="3660.9277" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="492,3648.9277,498,3643.9277,496,3648.9277,498,3653.9277,492,3648.9277" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="937" y="76.7988"/><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="933" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="940" y="101.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="937" y="3628.4395"/><rect fill="#FEFECE" filter="url(#f87mi57bbncmr)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="933" y="3632.4395"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="940" y="3652.9746">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1113" y="113.334">Event DAO</text><ellipse cx="1152" cy="83.7988" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1140" x2="1164" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1113" y="3641.9746">Event DAO</text><ellipse cx="1152" cy="3660.9277" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1140" x2="1164" y1="3674.9277" y2="3674.9277"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1201" y="113.334">Transfer DAO</text><ellipse cx="1250.5" cy="83.7988" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1238.5" x2="1262.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1201" y="3641.9746">Transfer DAO</text><ellipse cx="1250.5" cy="3660.9277" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1238.5" x2="1262.5" y1="3674.9277" y2="3674.9277"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1310" y="113.334">Participant DAO</text><ellipse cx="1367" cy="83.7988" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1355" x2="1379" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1310" y="3641.9746">Participant DAO</text><ellipse cx="1367" cy="3660.9277" fill="#FEFECE" filter="url(#f87mi57bbncmr)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1355" x2="1379" y1="3674.9277" y2="3674.9277"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1601" y="113.334">Central Store</text><path d="M1631,63.7988 C1631,53.7988 1649,53.7988 1649,53.7988 C1649,53.7988 1667,53.7988 1667,63.7988 L1667,89.7988 C1667,99.7988 1649,99.7988 1649,99.7988 C1649,99.7988 1631,99.7988 1631,89.7988 L1631,63.7988 " fill="#FEFECE" filter="url(#f87mi57bbncmr)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1631,63.7988 C1631,73.7988 1649,73.7988 1649,73.7988 C1649,73.7988 1667,73.7988 1667,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1601" y="3641.9746">Central Store</text><path d="M1631,3654.9277 C1631,3644.9277 1649,3644.9277 1649,3644.9277 C1649,3644.9277 1667,3644.9277 1667,3654.9277 L1667,3680.9277 C1667,3690.9277 1649,3690.9277 1649,3690.9277 C1649,3690.9277 1631,3690.9277 1631,3680.9277 L1631,3654.9277 " fill="#FEFECE" filter="url(#f87mi57bbncmr)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1631,3654.9277 C1631,3664.9277 1649,3664.9277 1649,3664.9277 C1649,3664.9277 1667,3664.9277 1667,3654.9277 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112" y="1750.5645"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="3493.1523" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="1676.2988"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1013" y="3560.4395"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1147" y="279.8398"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1147" y="1834.1855"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="835.1191"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="1159.9141"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="2449.7754"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1245.5" y="3044.0547"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="453.3926"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="644.2559"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="1983.4277"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="2216.6016"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="309.1504"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="482.7031"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="673.5664"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="864.4297"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="1189.2246"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="1863.4961"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="2012.7383"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="2245.9121"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="2479.0859"/><rect fill="#FFFFFF" filter="url(#f87mi57bbncmr)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1644" y="3073.3652"/><path d="M13,133.2871 L236,133.2871 L236,140.2871 L226,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3479.1523" style="stroke: #000000; stroke-width: 2.0;" width="1724" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="28" y="146.8555">Prepare Handler Consume</text><path d="M23,157.5977 L85,157.5977 L85,164.5977 L75,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3447.8418" style="stroke: #000000; stroke-width: 2.0;" width="1704" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="170.2324">[Consume Single Message]</text><polygon fill="#A80036" points="133,192.2188,123,196.2188,133,200.2188,129,196.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127" x2="490" y1="196.2188" y2="196.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="139" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="152" y="191.4766">Consume Prepare event message for Payer</text><path d="M407,241.2188 L622,241.2188 L622,248.2188 L612,258.2188 L407,258.2188 L407,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="422" y="254.7871">Persist Event Information</text><polygon fill="#A80036" points="1135,275.8398,1145,279.8398,1135,283.8398,1139,279.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1141" y1="279.8398" y2="279.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="508" y="275.0977">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="521" y="275.0977">Request to persist event information</text><polygon fill="#A80036" points="1632,305.1504,1642,309.1504,1632,313.1504,1636,309.1504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1157" x2="1638" y1="309.1504" y2="309.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1164" y="304.4082">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1177" y="304.4082">Persist event information</text><polygon fill="#A80036" points="512,364.4609,502,368.4609,512,372.4609,508,368.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1151" y1="368.4609" y2="368.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="518" y="363.7188">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="531" y="363.7188">Return success</text><path d="M397,390.4609 L616,390.4609 L616,397.4609 L606,407.4609 L397,407.4609 L397,390.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="716.832" style="stroke: #000000; stroke-width: 2.0;" width="1320" x="397" y="390.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="412" y="404.0293">Validate Prepare Transfer</text><path d="M407,414.7715 L549,414.7715 L549,421.7715 L539,431.7715 L407,431.7715 L407,414.7715 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="414.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="422" y="428.3398">Validate Payer</text><polygon fill="#A80036" points="1350,449.3926,1360,453.3926,1350,457.3926,1354,453.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1356" y1="453.3926" y2="453.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="508" y="448.6504">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="521" y="448.6504">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1632,478.7031,1642,482.7031,1632,486.7031,1636,482.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1372" x2="1638" y1="482.7031" y2="482.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1379" y="477.9609">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1392" y="477.9609">Request Participant details</text><polygon fill="#A80036" points="1383,508.0137,1373,512.0137,1383,516.0137,1379,512.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1377" x2="1648" y1="512.0137" y2="512.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1389" y="507.2715">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1402" y="507.2715">Return Participant details if it exists</text><polygon fill="#A80036" points="512,537.3242,502,541.3242,512,545.3242,508,541.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1366" y1="541.3242" y2="541.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="518" y="536.582">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="531" y="536.582">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="570.6348" y2="570.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="570.6348" y2="583.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="583.6348" y2="583.6348"/><polygon fill="#A80036" points="512,579.6348,502,583.6348,512,587.6348,508,583.6348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="508" y="565.8926">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="521" y="565.8926">Validate Payer</text><path d="M407,605.6348 L551,605.6348 L551,612.6348 L541,622.6348 L407,622.6348 L407,605.6348 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="605.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="422" y="619.2031">Validate Payee</text><polygon fill="#A80036" points="1350,640.2559,1360,644.2559,1350,648.2559,1354,644.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1356" y1="644.2559" y2="644.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="639.5137">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="530" y="639.5137">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1632,669.5664,1642,673.5664,1632,677.5664,1636,673.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1372" x2="1638" y1="673.5664" y2="673.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1379" y="668.8242">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1401" y="668.8242">Request Participant details</text><polygon fill="#A80036" points="1383,698.877,1373,702.877,1383,706.877,1379,702.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1377" x2="1648" y1="702.877" y2="702.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1389" y="698.1348">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1411" y="698.1348">Return Participant details if it exists</text><polygon fill="#A80036" points="512,728.1875,502,732.1875,512,736.1875,508,732.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1366" y1="732.1875" y2="732.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="727.4453">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="540" y="727.4453">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="761.498" y2="761.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="761.498" y2="774.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="774.498" y2="774.498"/><polygon fill="#A80036" points="512,770.498,502,774.498,512,778.498,508,774.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="756.7559">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="530" y="756.7559">Validate Payee</text><path d="M407,796.498 L559,796.498 L559,803.498 L549,813.498 L407,813.498 L407,796.498 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="796.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="422" y="810.0664">Duplicate check</text><polygon fill="#A80036" points="1233.5,831.1191,1243.5,835.1191,1233.5,839.1191,1237.5,835.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1239.5" y1="835.1191" y2="835.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="830.377">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="530" y="830.377">Request to retrieve Transfer (if it exists)</text><polygon fill="#A80036" points="1632,860.4297,1642,864.4297,1632,868.4297,1636,864.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="1638" y1="864.4297" y2="864.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1262.5" y="859.6875">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="1284.5" y="859.6875">Request Transfer</text><polygon fill="#A80036" points="1266.5,889.7402,1256.5,893.7402,1266.5,897.7402,1262.5,893.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1260.5" x2="1648" y1="893.7402" y2="893.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1272.5" y="888.998">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1294.5" y="888.998">Return Transfer if it exists</text><polygon fill="#A80036" points="512,919.0508,502,923.0508,512,927.0508,508,923.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1249.5" y1="923.0508" y2="923.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="918.3086">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="540" y="918.3086">Return Transfer if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="952.3613" y2="952.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="952.3613" y2="965.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="965.3613" y2="965.3613"/><polygon fill="#A80036" points="512,961.3613,502,965.3613,512,969.3613,508,965.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="947.6191">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="530" y="947.6191">Validate duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="1001.6719" y2="1001.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="1001.6719" y2="1014.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="1014.6719" y2="1014.6719"/><polygon fill="#A80036" points="512,1010.6719,502,1014.6719,512,1018.6719,508,1014.6719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="996.9297">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="530" y="996.9297">Validate amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="1043.9824" y2="1043.9824"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="1043.9824" y2="1056.9824"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="1056.9824" y2="1056.9824"/><polygon fill="#A80036" points="512,1052.9824,502,1056.9824,512,1060.9824,508,1056.9824" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1039.2402">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="530" y="1039.2402">Validate crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="1086.293" y2="1086.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="1086.293" y2="1099.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="1099.293" y2="1099.293"/><polygon fill="#A80036" points="512,1095.293,502,1099.293,512,1103.293,508,1099.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1081.5508">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="530" y="1081.5508">Validate message signature (to be confirmed in future requirement)</text><path d="M407,1121.293 L938,1121.293 L938,1128.293 L928,1138.293 L407,1138.293 L407,1121.293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="1121.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="486" x="422" y="1134.8613">Persist Transfer State (with transferState='RECEIVED' on validation pass)</text><polygon fill="#A80036" points="1233.5,1155.9141,1243.5,1159.9141,1233.5,1163.9141,1237.5,1159.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1239.5" y1="1159.9141" y2="1159.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1155.1719">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="530" y="1155.1719">Request to persist transfer</text><polygon fill="#A80036" points="1632,1185.2246,1642,1189.2246,1632,1193.2246,1636,1189.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="1638" y1="1189.2246" y2="1189.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1262.5" y="1184.4824">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1284.5" y="1184.4824">Persist transfer</text><polygon fill="#A80036" points="512,1244.5352,502,1248.5352,512,1252.5352,508,1248.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1249.5" y1="1248.5352" y2="1248.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="1243.793">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="540" y="1243.793">Return success</text><path d="M506,1268.5352 L506,1645.5352 L768,1645.5352 L768,1278.5352 L758,1268.5352 L506,1268.5352 " fill="#FFFF00" filter="url(#f87mi57bbncmr)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M758,1268.5352 L758,1278.5352 L768,1278.5352 L758,1268.5352 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="512" y="1286.1035">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="1301.4141">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="528" y="1316.7246">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="528" y="1332.0352">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="528" y="1347.3457">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="528" y="1362.6563">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="528" y="1377.9668">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="544" y="1393.2773">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="544" y="1408.5879">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="528" y="1423.8984">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="528" y="1439.209">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="544" y="1454.5195">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="560" y="1469.8301">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="560" y="1485.1406">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="560" y="1500.4512">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="560" y="1515.7617">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="560" y="1531.0723">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="560" y="1546.3828">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="576" y="1561.6934">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="576" y="1577.0039">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="560" y="1592.3145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="544" y="1607.625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="528" y="1622.9355">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="1638.2461">}</text><polygon fill="#A80036" points="1001,1672.2988,1011,1676.2988,1001,1680.2988,1005,1676.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1007" y1="1676.2988" y2="1676.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1671.5566">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="530" y="1671.5566">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1727" y1="1715.2988" y2="1715.2988"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="1725.9336">[Consume Batch Messages]</text><polygon fill="#A80036" points="133,1746.5645,123,1750.5645,133,1754.5645,129,1750.5645" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127" x2="490" y1="1750.5645" y2="1750.5645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="139" y="1745.8223">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="161" y="1745.8223">Consume Prepare event batch of messages for Payer</text><path d="M407,1795.5645 L664,1795.5645 L664,1802.5645 L654,1812.5645 L407,1812.5645 L407,1795.5645 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="1795.5645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="422" y="1809.1328">Persist batch Event Information</text><polygon fill="#A80036" points="1135,1830.1855,1145,1834.1855,1135,1838.1855,1139,1834.1855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1141" y1="1834.1855" y2="1834.1855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1829.4434">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="530" y="1829.4434">Request to persist event information for batch of messages</text><polygon fill="#A80036" points="1632,1859.4961,1642,1863.4961,1632,1867.4961,1636,1863.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1157" x2="1638" y1="1863.4961" y2="1863.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1164" y="1858.7539">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1186" y="1858.7539">Persist event batch information</text><polygon fill="#A80036" points="512,1918.8066,502,1922.8066,512,1926.8066,508,1922.8066" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1151" y1="1922.8066" y2="1922.8066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="1918.0645">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="540" y="1918.0645">Return success</text><path d="M407,1944.8066 L655,1944.8066 L655,1951.8066 L645,1961.8066 L407,1961.8066 L407,1944.8066 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="219.1738" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="1944.8066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="422" y="1958.375">Fetch batch Payer information</text><polygon fill="#A80036" points="1350,1979.4277,1360,1983.4277,1350,1987.4277,1354,1983.4277" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1356" y1="1983.4277" y2="1983.4277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="1978.6855">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="530" y="1978.6855">Request to retrieve batch of Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1632,2008.7383,1642,2012.7383,1632,2016.7383,1636,2012.7383" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1372" x2="1638" y1="2012.7383" y2="2012.7383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1379" y="2007.9961">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1401" y="2007.9961">Request Participant details</text><polygon fill="#A80036" points="1383,2038.0488,1373,2042.0488,1383,2046.0488,1379,2042.0488" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1377" x2="1648" y1="2042.0488" y2="2042.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1389" y="2037.3066">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1411" y="2037.3066">Return Participant details if it exists</text><polygon fill="#A80036" points="512,2067.3594,502,2071.3594,512,2075.3594,508,2071.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1366" y1="2071.3594" y2="2071.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="2066.6172">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="540" y="2066.6172">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2100.6699" y2="2100.6699"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2100.6699" y2="2113.6699"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2113.6699" y2="2113.6699"/><polygon fill="#A80036" points="512,2109.6699,502,2113.6699,512,2117.6699,508,2113.6699" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2095.9277">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="530" y="2095.9277">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2142.9805" y2="2142.9805"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2142.9805" y2="2155.9805"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2155.9805" y2="2155.9805"/><polygon fill="#A80036" points="512,2151.9805,502,2155.9805,512,2159.9805,508,2155.9805" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2138.2383">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="530" y="2138.2383">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M407,2177.9805 L657,2177.9805 L657,2184.9805 L647,2194.9805 L407,2194.9805 L407,2177.9805 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="219.1738" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="2177.9805"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="422" y="2191.5488">Fetch batch Payee information</text><polygon fill="#A80036" points="1350,2212.6016,1360,2216.6016,1350,2220.6016,1354,2216.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1356" y1="2216.6016" y2="2216.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2211.8594">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="530" y="2211.8594">Request to retrieve batch of Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1632,2241.9121,1642,2245.9121,1632,2249.9121,1636,2245.9121" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1372" x2="1638" y1="2245.9121" y2="2245.9121"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1379" y="2241.1699">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1401" y="2241.1699">Request Participant details</text><polygon fill="#A80036" points="1383,2271.2227,1373,2275.2227,1383,2279.2227,1379,2275.2227" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1377" x2="1648" y1="2275.2227" y2="2275.2227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1389" y="2270.4805">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1411" y="2270.4805">Return Participant details if it exists</text><polygon fill="#A80036" points="512,2300.5332,502,2304.5332,512,2308.5332,508,2304.5332" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1366" y1="2304.5332" y2="2304.5332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="2299.791">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="540" y="2299.791">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2333.8438" y2="2333.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2333.8438" y2="2346.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2346.8438" y2="2346.8438"/><polygon fill="#A80036" points="512,2342.8438,502,2346.8438,512,2350.8438,508,2346.8438" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2329.1016">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="530" y="2329.1016">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2376.1543" y2="2376.1543"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2376.1543" y2="2389.1543"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2389.1543" y2="2389.1543"/><polygon fill="#A80036" points="512,2385.1543,502,2389.1543,512,2393.1543,508,2389.1543" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2371.4121">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="530" y="2371.4121">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M407,2411.1543 L612,2411.1543 L612,2418.1543 L602,2428.1543 L407,2428.1543 L407,2411.1543 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="176.8633" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="2411.1543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="422" y="2424.7227">Fetch batch of transfers</text><polygon fill="#A80036" points="1233.5,2445.7754,1243.5,2449.7754,1233.5,2453.7754,1237.5,2449.7754" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1239.5" y1="2449.7754" y2="2449.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2445.0332">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="530" y="2445.0332">Request to retrieve batch of Transfers (if it exists)</text><polygon fill="#A80036" points="1632,2475.0859,1642,2479.0859,1632,2483.0859,1636,2479.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="1638" y1="2479.0859" y2="2479.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1262.5" y="2474.3438">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1284.5" y="2474.3438">Request batch of Transfers</text><polygon fill="#A80036" points="1266.5,2504.3965,1256.5,2508.3965,1266.5,2512.3965,1262.5,2508.3965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1260.5" x2="1648" y1="2508.3965" y2="2508.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1272.5" y="2503.6543">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="1294.5" y="2503.6543">Return batch of Transfers (if it exists)</text><polygon fill="#A80036" points="512,2533.707,502,2537.707,512,2541.707,508,2537.707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1249.5" y1="2537.707" y2="2537.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="2532.9648">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="540" y="2532.9648">Return batch of Transfer (if it exists)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2567.0176" y2="2567.0176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2567.0176" y2="2580.0176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2580.0176" y2="2580.0176"/><polygon fill="#A80036" points="512,2576.0176,502,2580.0176,512,2584.0176,508,2580.0176" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2562.2754">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="530" y="2562.2754">store result set in var: $LIST_TRANSFERS</text><path d="M387,2602.0176 L461,2602.0176 L461,2609.0176 L451,2619.0176 L387,2619.0176 L387,2602.0176 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="996.4219" style="stroke: #000000; stroke-width: 2.0;" width="1330" x="387" y="2602.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="402" y="2615.5859">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="476" y="2614.6523">[for each message in batch]</text><path d="M397,2626.3281 L616,2626.3281 L616,2633.3281 L606,2643.3281 L397,2643.3281 L397,2626.3281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="631" x="397" y="2626.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="412" y="2639.8965">Validate Prepare Transfer</text><path d="M407,2650.6387 L549,2650.6387 L549,2657.6387 L539,2667.6387 L407,2667.6387 L407,2650.6387 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="610" x="407" y="2650.6387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="422" y="2664.207">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2689.2598" y2="2689.2598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2689.2598" y2="2702.2598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2702.2598" y2="2702.2598"/><polygon fill="#A80036" points="512,2698.2598,502,2702.2598,512,2706.2598,508,2702.2598" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2684.5176">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="475" x="530" y="2684.5176">Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M407,2724.2598 L551,2724.2598 L551,2731.2598 L541,2741.2598 L407,2741.2598 L407,2724.2598 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="611" x="407" y="2724.2598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="422" y="2737.8281">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2762.8809" y2="2762.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2762.8809" y2="2775.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2775.8809" y2="2775.8809"/><polygon fill="#A80036" points="512,2771.8809,502,2775.8809,512,2779.8809,508,2775.8809" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2758.1387">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="476" x="530" y="2758.1387">Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M407,2797.8809 L559,2797.8809 L559,2804.8809 L549,2814.8809 L407,2814.8809 L407,2797.8809 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="554" x="407" y="2797.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="422" y="2811.4492">Duplicate check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2836.502" y2="2836.502"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2836.502" y2="2849.502"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2849.502" y2="2849.502"/><polygon fill="#A80036" points="512,2845.502,502,2849.502,512,2853.502,508,2849.502" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2831.7598">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="419" x="530" y="2831.7598">Validate duplicate Check against in-memory var $LIST_TRANSFERS</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2885.8125" y2="2885.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2885.8125" y2="2898.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2898.8125" y2="2898.8125"/><polygon fill="#A80036" points="512,2894.8125,502,2898.8125,512,2902.8125,508,2898.8125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2881.0703">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="530" y="2881.0703">Validate amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2928.123" y2="2928.123"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2928.123" y2="2941.123"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2941.123" y2="2941.123"/><polygon fill="#A80036" points="512,2937.123,502,2941.123,512,2945.123,508,2941.123" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2923.3809">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="530" y="2923.3809">Validate crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="543" y1="2970.4336" y2="2970.4336"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="543" y1="2970.4336" y2="2983.4336"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502" x2="543" y1="2983.4336" y2="2983.4336"/><polygon fill="#A80036" points="512,2979.4336,502,2983.4336,512,2987.4336,508,2983.4336" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="2965.6914">53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="530" y="2965.6914">Validate message signature (to be confirmed in future requirement)</text><path d="M407,3005.4336 L938,3005.4336 L938,3012.4336 L928,3022.4336 L407,3022.4336 L407,3005.4336 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="1300" x="407" y="3005.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="486" x="422" y="3019.002">Persist Transfer State (with transferState='RECEIVED' on validation pass)</text><polygon fill="#A80036" points="1233.5,3040.0547,1243.5,3044.0547,1233.5,3048.0547,1237.5,3044.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1239.5" y1="3044.0547" y2="3044.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3039.3125">54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="530" y="3039.3125">Request to persist transfer</text><polygon fill="#A80036" points="1632,3069.3652,1642,3073.3652,1632,3077.3652,1636,3073.3652" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="1638" y1="3073.3652" y2="3073.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1262.5" y="3068.623">55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1284.5" y="3068.623">Persist transfer</text><polygon fill="#A80036" points="512,3128.6758,502,3132.6758,512,3136.6758,508,3132.6758" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506" x2="1249.5" y1="3132.6758" y2="3132.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="518" y="3127.9336">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="540" y="3127.9336">Return success</text><path d="M506,3152.6758 L506,3529.6758 L768,3529.6758 L768,3162.6758 L758,3152.6758 L506,3152.6758 " fill="#FFFF00" filter="url(#f87mi57bbncmr)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M758,3152.6758 L758,3162.6758 L768,3162.6758 L758,3152.6758 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="512" y="3170.2441">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="3185.5547">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="528" y="3200.8652">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="528" y="3216.1758">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="528" y="3231.4863">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="528" y="3246.7969">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="528" y="3262.1074">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="544" y="3277.418">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="544" y="3292.7285">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="528" y="3308.0391">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="528" y="3323.3496">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="544" y="3338.6602">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="560" y="3353.9707">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="560" y="3369.2813">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="560" y="3384.5918">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="560" y="3399.9023">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="560" y="3415.2129">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="560" y="3430.5234">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="576" y="3445.834">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="576" y="3461.1445">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="560" y="3476.4551">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="544" y="3491.7656">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="528" y="3507.0762">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="512" y="3522.3867">}</text><polygon fill="#A80036" points="1001,3556.4395,1011,3560.4395,1001,3564.4395,1005,3560.4395" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501" x2="1007" y1="3560.4395" y2="3560.4395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="508" y="3555.6973">57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="530" y="3555.6973">Route &amp; Publish Position event for Payer</text><!--
@startuml
title 1.1.1. Prepare Handler Consume

autonumber


collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant EVENT_DAO
    participant TRANS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate PREP_HANDLER
group Prepare Handler Consume
    alt Consume Single Message
        TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume Prepare event message for Payer
        activate TOPIC_PREPARE_DFSP1
        deactivate TOPIC_PREPARE_DFSP1
        group Persist Event Information
            PREP_HANDLER -> EVENT_DAO: Request to persist event information
            activate EVENT_DAO
            EVENT_DAO -> DB: Persist event information
            activate DB
            deactivate DB
            EVENT_DAO - -> PREP_HANDLER: Return success
            deactivate EVENT_DAO
        end

        group Validate Prepare Transfer
            group Validate Payer
                PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
                activate PARTICIPANT_DAO
                PARTICIPANT_DAO -> DB: Request Participant details
                activate DB
                PARTICIPANT_DAO <- - DB: Return Participant details if it exists
                deactivate DB
                PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
                deactivate PARTICIPANT_DAO
                PREP_HANDLER <-> PREP_HANDLER: Validate Payer
            end
            group Validate Payee
                PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
                activate PARTICIPANT_DAO
                PARTICIPANT_DAO -> DB: Request Participant details
                activate DB
                PARTICIPANT_DAO <- - DB: Return Participant details if it exists
                deactivate DB
                PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
                deactivate PARTICIPANT_DAO
                PREP_HANDLER <-> PREP_HANDLER: Validate Payee
            end
            group Duplicate check
                PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer (if it exists)
                activate TRANS_DAO
                TRANS_DAO -> DB: Request Transfer
                activate DB
                TRANS_DAO <- - DB: Return Transfer if it exists
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return Transfer if it exists
                deactivate TRANS_DAO
                PREP_HANDLER <-> PREP_HANDLER: Validate duplicate Check
            end
            PREP_HANDLER <-> PREP_HANDLER: Validate amount
            PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition
            PREP_HANDLER <-> PREP_HANDLER: Validate message signature (to be confirmed in future requirement)
        end

        group Persist Transfer State (with transferState='RECEIVED' on validation pass)
            PREP_HANDLER -> TRANS_DAO: Request to persist transfer
            activate TRANS_DAO
            TRANS_DAO -> DB: Persist transfer
            activate DB
            deactivate DB
            TRANS_DAO - -> PREP_HANDLER: Return success
            deactivate TRANS_DAO
        end

        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: position,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event for Payer
        activate TOPIC_POSITION_DFSP1
        deactivate TOPIC_POSITION_DFSP1

    else Consume Batch Messages
        TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume Prepare event batch of messages for Payer
        activate TOPIC_PREPARE_DFSP1
        deactivate TOPIC_PREPARE_DFSP1
        group Persist batch Event Information
            PREP_HANDLER -> EVENT_DAO: Request to persist event information for batch of messages
            activate EVENT_DAO
            EVENT_DAO -> DB: Persist event batch information
            activate DB
            deactivate DB
            EVENT_DAO - - -> PREP_HANDLER: Return success
            deactivate EVENT_DAO
        end

        group Fetch batch Payer information
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payer Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payer
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER
        end

        group Fetch batch Payee information
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payee Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payee
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE
        end

        group Fetch batch of transfers
            PREP_HANDLER -> TRANS_DAO: Request to retrieve batch of Transfers (if it exists)
            activate TRANS_DAO
            TRANS_DAO -> DB: Request batch of Transfers
            activate DB
            TRANS_DAO <- - DB: Return batch of Transfers (if it exists)
            deactivate DB
            TRANS_DAO - -> PREP_HANDLER: Return batch of Transfer (if it exists)
            deactivate TRANS_DAO
            PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_TRANSFERS
        end

        loop for each message in batch

            group Validate Prepare Transfer
                group Validate Payer
                    PREP_HANDLER <-> PREP_HANDLER: Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER
                end
                group Validate Payee
                    PREP_HANDLER <-> PREP_HANDLER: Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE
                end
                group Duplicate check
                    PREP_HANDLER <-> PREP_HANDLER: Validate duplicate Check against in-memory var $LIST_TRANSFERS
                end
                PREP_HANDLER <-> PREP_HANDLER: Validate amount
                PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition
                PREP_HANDLER <-> PREP_HANDLER: Validate message signature (to be confirmed in future requirement)
            end

            group Persist Transfer State (with transferState='RECEIVED' on validation pass)
                PREP_HANDLER -> TRANS_DAO: Request to persist transfer
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer
                activate DB
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return success
                deactivate TRANS_DAO
            end

            note right of PREP_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: position,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            PREP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event for Payer
            activate TOPIC_POSITION_DFSP1
            deactivate TOPIC_POSITION_DFSP1
        end
    end
end
deactivate PREP_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>