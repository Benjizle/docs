<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2541px" preserveAspectRatio="none" style="width:1216px;height:2541px;" version="1.1" viewBox="0 0 1216 2541" width="1216px" zoomAndPan="magnify"><defs><filter height="300%" id="f335o43fn2gal" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="491.5" y="23.5352">1.1.3. Transfer Handler Consume</text><rect fill="#FFFFE0" height="2496.334" style="stroke: #A80036; stroke-width: 1.0;" width="1150" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="553.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91" y="1321.2539"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="2329.0469" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="467" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="796.2246"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="1246.9883"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="1945.5703"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="2396.334"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="883" y="279.8398"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="883" y="1404.875"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1122" y="309.1504"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1122" y="1434.1855"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="2315.0469" style="stroke: #000000; stroke-width: 2.0;" width="1192" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="2283.7363" style="stroke: #000000; stroke-width: 2.0;" width="1172" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="804.5" x="380.5" y="241.2188"/><rect fill="#FFFFFF" height="1156.3457" style="stroke: none; stroke-width: 1.0;" width="1172" x="23" y="1284.9883"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="804.5" x="380.5" y="1366.2539"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="918.8379" style="stroke: #000000; stroke-width: 2.0;" width="457" x="380.5" y="1515.4961"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="96" x2="96" y1="116.2871" y2="2465.334"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="471.5" x2="471.5" y1="116.2871" y2="2465.334"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="753.5" x2="753.5" y1="116.2871" y2="2465.334"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="888" x2="888" y1="116.2871" y2="2465.334"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1127" x2="1127" y1="116.2871" y2="2465.334"/><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="37" y="76.7988"/><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="33" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="40" y="101.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="37" y="2464.334"/><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="33" y="2468.334"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="40" y="2488.8691">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="390.5" y="113.334">Transfer Event Handler</text><ellipse cx="472" cy="83.7988" fill="#FEFECE" filter="url(#f335o43fn2gal)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="468,71.7988,474,66.7988,472,71.7988,474,76.7988,468,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="390.5" y="2477.8691">Transfer Event Handler</text><ellipse cx="472" cy="2496.8223" fill="#FEFECE" filter="url(#f335o43fn2gal)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="468,2484.8223,474,2479.8223,472,2484.8223,474,2489.8223,468,2484.8223" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="684.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="680.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="687.5" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="684.5" y="2464.334"/><rect fill="#FEFECE" filter="url(#f335o43fn2gal)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="680.5" y="2468.334"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="687.5" y="2488.8691">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="849" y="113.334">Event DAO</text><ellipse cx="888" cy="83.7988" fill="#FEFECE" filter="url(#f335o43fn2gal)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="876" x2="900" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="849" y="2477.8691">Event DAO</text><ellipse cx="888" cy="2496.8223" fill="#FEFECE" filter="url(#f335o43fn2gal)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="876" x2="900" y1="2510.8223" y2="2510.8223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1079" y="113.334">Central Store</text><path d="M1109,63.7988 C1109,53.7988 1127,53.7988 1127,53.7988 C1127,53.7988 1145,53.7988 1145,63.7988 L1145,89.7988 C1145,99.7988 1127,99.7988 1127,99.7988 C1127,99.7988 1109,99.7988 1109,89.7988 L1109,63.7988 " fill="#FEFECE" filter="url(#f335o43fn2gal)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1109,63.7988 C1109,73.7988 1127,73.7988 1127,73.7988 C1127,73.7988 1145,73.7988 1145,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1079" y="2477.8691">Central Store</text><path d="M1109,2490.8223 C1109,2480.8223 1127,2480.8223 1127,2480.8223 C1127,2480.8223 1145,2480.8223 1145,2490.8223 L1145,2516.8223 C1145,2526.8223 1127,2526.8223 1127,2526.8223 C1127,2526.8223 1109,2526.8223 1109,2516.8223 L1109,2490.8223 " fill="#FEFECE" filter="url(#f335o43fn2gal)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1109,2490.8223 C1109,2500.8223 1127,2500.8223 1127,2500.8223 C1127,2500.8223 1145,2500.8223 1145,2490.8223 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91" y="1321.2539"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="2329.0469" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="467" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="796.2246"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="1246.9883"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="1945.5703"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="749" y="2396.334"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="883" y="279.8398"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="88.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="883" y="1404.875"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1122" y="309.1504"/><rect fill="#FFFFFF" filter="url(#f335o43fn2gal)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1122" y="1434.1855"/><path d="M13,133.2871 L241,133.2871 L241,140.2871 L231,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2315.0469" style="stroke: #000000; stroke-width: 2.0;" width="1192" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="28" y="146.8555">Transfer Handler Consume</text><path d="M23,157.5977 L85,157.5977 L85,164.5977 L75,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2283.7363" style="stroke: #000000; stroke-width: 2.0;" width="1172" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="170.2324">[Consume Single Message]</text><polygon fill="#A80036" points="112,192.2188,102,196.2188,112,200.2188,108,196.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106" x2="466" y1="196.2188" y2="196.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="131" y="191.4766">Consume Transfer event</text><path d="M380.5,241.2188 L595.5,241.2188 L595.5,248.2188 L585.5,258.2188 L380.5,258.2188 L380.5,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="804.5" x="380.5" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="395.5" y="254.7871">Persist Event Information</text><polygon fill="#A80036" points="871,275.8398,881,279.8398,871,283.8398,875,279.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477" x2="877" y1="279.8398" y2="279.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="484" y="275.0977">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="497" y="275.0977">Request to persist event information</text><polygon fill="#A80036" points="1110,305.1504,1120,309.1504,1110,313.1504,1114,309.1504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="893" x2="1116" y1="309.1504" y2="309.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="900" y="304.4082">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="913" y="304.4082">Persist event information</text><polygon fill="#A80036" points="488,364.4609,478,368.4609,488,372.4609,484,368.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="482" x2="887" y1="368.4609" y2="368.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="494" y="363.7188">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="507" y="363.7188">Return success</text><path d="M482,388.4609 L482,765.4609 L744,765.4609 L744,398.4609 L734,388.4609 L482,388.4609 " fill="#FFFF00" filter="url(#f335o43fn2gal)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M734,388.4609 L734,398.4609 L744,398.4609 L734,388.4609 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="488" y="406.0293">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="421.3398">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="504" y="436.6504">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="504" y="451.9609">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="504" y="467.2715">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="504" y="482.582">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="504" y="497.8926">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="520" y="513.2031">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="520" y="528.5137">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="504" y="543.8242">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="504" y="559.1348">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="520" y="574.4453">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="536" y="589.7559">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="536" y="605.0664">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="536" y="620.377">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="536" y="635.6875">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="536" y="650.998">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="536" y="666.3086">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="552" y="681.6191">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="552" y="696.9297">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="536" y="712.2402">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="520" y="727.5508">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="504" y="742.8613">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="758.1719">}</text><polygon fill="#A80036" points="737,792.2246,747,796.2246,737,800.2246,741,796.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477" x2="743" y1="796.2246" y2="796.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="484" y="791.4824">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="497" y="791.4824">Publish Notifications event for Payer</text><path d="M482,839.2246 L482,1216.2246 L744,1216.2246 L744,849.2246 L734,839.2246 L482,839.2246 " fill="#FFFF00" filter="url(#f335o43fn2gal)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M734,839.2246 L734,849.2246 L744,849.2246 L734,839.2246 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="488" y="856.793">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="872.1035">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="504" y="887.4141">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="504" y="902.7246">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="504" y="918.0352">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="504" y="933.3457">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="504" y="948.6563">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="520" y="963.9668">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="520" y="979.2773">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="504" y="994.5879">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="504" y="1009.8984">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="520" y="1025.209">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="536" y="1040.5195">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="536" y="1055.8301">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="536" y="1071.1406">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="536" y="1086.4512">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="536" y="1101.7617">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="536" y="1117.0723">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="552" y="1132.3828">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="552" y="1147.6934">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="536" y="1163.0039">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="520" y="1178.3145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="504" y="1193.625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="1208.9355">}</text><polygon fill="#A80036" points="737,1242.9883,747,1246.9883,737,1250.9883,741,1246.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477" x2="743" y1="1246.9883" y2="1246.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="484" y="1242.2461">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="497" y="1242.2461">Publish Notifications event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1195" y1="1285.9883" y2="1285.9883"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="1296.623">[Consume Batch Messages]</text><polygon fill="#A80036" points="112,1317.2539,102,1321.2539,112,1325.2539,108,1321.2539" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106" x2="466" y1="1321.2539" y2="1321.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="1316.5117">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="131" y="1316.5117">Consume Transfer event batch of messages for Payer</text><path d="M380.5,1366.2539 L637.5,1366.2539 L637.5,1373.2539 L627.5,1383.2539 L380.5,1383.2539 L380.5,1366.2539 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.2422" style="stroke: #000000; stroke-width: 2.0;" width="804.5" x="380.5" y="1366.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="395.5" y="1379.8223">Persist batch Event Information</text><polygon fill="#A80036" points="871,1400.875,881,1404.875,871,1408.875,875,1404.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477" x2="877" y1="1404.875" y2="1404.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="484" y="1400.1328">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="497" y="1400.1328">Request to persist event information for batch of messages</text><polygon fill="#A80036" points="1110,1430.1855,1120,1434.1855,1110,1438.1855,1114,1434.1855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="893" x2="1116" y1="1434.1855" y2="1434.1855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="900" y="1429.4434">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="913" y="1429.4434">Persist event batch information</text><polygon fill="#A80036" points="488,1489.4961,478,1493.4961,488,1497.4961,484,1493.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="482" x2="887" y1="1493.4961" y2="1493.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="494" y="1488.7539">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="516" y="1488.7539">Return success</text><path d="M380.5,1515.4961 L454.5,1515.4961 L454.5,1522.4961 L444.5,1532.4961 L380.5,1532.4961 L380.5,1515.4961 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="918.8379" style="stroke: #000000; stroke-width: 2.0;" width="457" x="380.5" y="1515.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="395.5" y="1529.0645">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="469.5" y="1528.1309">[for each message in batch]</text><path d="M482,1537.8066 L482,1914.8066 L744,1914.8066 L744,1547.8066 L734,1537.8066 L482,1537.8066 " fill="#FFFF00" filter="url(#f335o43fn2gal)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M734,1537.8066 L734,1547.8066 L744,1547.8066 L734,1537.8066 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="488" y="1555.375">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="1570.6855">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="504" y="1585.9961">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="504" y="1601.3066">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="504" y="1616.6172">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="504" y="1631.9277">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="504" y="1647.2383">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="520" y="1662.5488">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="520" y="1677.8594">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="504" y="1693.1699">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="504" y="1708.4805">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="520" y="1723.791">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="536" y="1739.1016">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="536" y="1754.4121">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="536" y="1769.7227">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="536" y="1785.0332">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="536" y="1800.3438">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="536" y="1815.6543">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="552" y="1830.9648">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="552" y="1846.2754">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="536" y="1861.5859">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="520" y="1876.8965">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="504" y="1892.207">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="1907.5176">}</text><polygon fill="#A80036" points="737,1941.5703,747,1945.5703,737,1949.5703,741,1945.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477" x2="743" y1="1945.5703" y2="1945.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="484" y="1940.8281">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="506" y="1940.8281">Publish Notifications event for Payer</text><path d="M482,1988.5703 L482,2365.5703 L744,2365.5703 L744,1998.5703 L734,1988.5703 L482,1988.5703 " fill="#FFFF00" filter="url(#f335o43fn2gal)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M734,1988.5703 L734,1998.5703 L744,1998.5703 L734,1988.5703 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="488" y="2006.1387">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="2021.4492">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="504" y="2036.7598">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="504" y="2052.0703">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="504" y="2067.3809">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="504" y="2082.6914">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="504" y="2098.002">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="520" y="2113.3125">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="520" y="2128.623">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="504" y="2143.9336">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="504" y="2159.2441">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="520" y="2174.5547">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="536" y="2189.8652">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="536" y="2205.1758">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="536" y="2220.4863">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="536" y="2235.7969">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="536" y="2251.1074">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="536" y="2266.418">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="552" y="2281.7285">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="552" y="2297.0391">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="536" y="2312.3496">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="520" y="2327.6602">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="504" y="2342.9707">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="2358.2813">}</text><polygon fill="#A80036" points="737,2392.334,747,2396.334,737,2400.334,741,2396.334" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477" x2="743" y1="2396.334" y2="2396.334"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="484" y="2391.5918">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="506" y="2391.5918">Publish Notifications event for Payee</text><!--
@startuml
title 1.1.3. Transfer Handler Consume

autonumber


collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Event DAO" as EVENT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant EVENT_DAO
    participant DB
end box

activate TRANS_HANDLER
group Transfer Handler Consume
    alt Consume Single Message
        TOPIC_TRANSFERS <- TRANS_HANDLER: Consume Transfer event

        activate TOPIC_TRANSFERS
        deactivate TOPIC_TRANSFERS

        group Persist Event Information
            TRANS_HANDLER -> EVENT_DAO: Request to persist event information
            activate EVENT_DAO
            EVENT_DAO -> DB: Persist event information
            activate DB
            deactivate DB
            EVENT_DAO - -> TRANS_HANDLER: Return success
            deactivate EVENT_DAO
        end

        
        note right of TRANS_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: notification,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notifications event for Payer
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS

        note right of TRANS_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: notification,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notifications event for Payee
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS

    else Consume Batch Messages
        TOPIC_TRANSFERS <- TRANS_HANDLER: Consume Transfer event batch of messages for Payer
        activate TOPIC_TRANSFERS
        deactivate TOPIC_TRANSFERS
        
        group Persist batch Event Information
            TRANS_HANDLER -> EVENT_DAO: Request to persist event information for batch of messages
            activate EVENT_DAO
            EVENT_DAO -> DB: Persist event batch information
            activate DB
            deactivate DB
            EVENT_DAO - -> TRANS_HANDLER: Return success
            deactivate EVENT_DAO
        end


        loop for each message in batch
            note right of TRANS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payerFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notifications event for Payer
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS

            note right of TRANS_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notifications event for Payee
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        end
    end
end
deactivate TRANS_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>