<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1385px" preserveAspectRatio="none" style="width:3094px;height:1385px;" version="1.1" viewBox="0 0 3094 1385" width="3094px" zoomAndPan="magnify"><defs><filter height="300%" id="f6nm1j8cvtdgo" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="591" x="1248" y="23.5352">1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure</text><rect fill="#ADD8E6" height="1340.125" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="1340.125" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1340.125" style="stroke: #A80036; stroke-width: 1.0;" width="2096" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1984.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f6nm1j8cvtdgo)" height="459.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f6nm1j8cvtdgo)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="1116.2617"/><rect fill="#FFFFFF" filter="url(#f6nm1j8cvtdgo)" height="509.1426" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="607.1191"/><rect fill="#FFFFFF" filter="url(#f6nm1j8cvtdgo)" height="1116.8379" style="stroke: #000000; stroke-width: 2.0;" width="2950" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1219" x2="1219" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1603" x2="1603" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1819" x2="1819" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1994" x2="1994" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2147" x2="2147" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2301" x2="2301" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2466" x2="2466" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2598" x2="2598" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2695" x2="2695" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2793" x2="2793" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2913" x2="2913" y1="137.2871" y2="1288.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3031" x2="3031" y1="137.2871" y2="1288.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="1300.6602">DFSP1</text><ellipse cx="67.5" cy="1313.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,1321.6133 L67.5,1348.6133 M54.5,1329.6133 L80.5,1329.6133 M67.5,1348.6133 L54.5,1363.6133 M67.5,1348.6133 L80.5,1363.6133 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="1300.6602">DFSP2</text><ellipse cx="126.5" cy="1313.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,1321.6133 L126.5,1348.6133 M113.5,1329.6133 L139.5,1329.6133 M126.5,1348.6133 L113.5,1363.6133 M126.5,1348.6133 L139.5,1363.6133 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="1300.6602">ML API Adapter</text><path d="M325,1307.6133 L325,1331.6133 M325,1319.6133 L342,1319.6133 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="1300.6602">ML API Notification Event Handler</text><ellipse cx="527" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,1307.6133,529,1302.6133,527,1307.6133,529,1312.6133,523,1307.6133" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="1300.6602">Central Service API</text><path d="M1037.5,1307.6133 L1037.5,1331.6133 M1037.5,1319.6133 L1054.5,1319.6133 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="1287.125"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="1291.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="1311.6602">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="134.334">Prepare Event Handler</text><ellipse cx="1603" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,92.7988,1605,87.7988,1603,92.7988,1605,97.7988,1599,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="1300.6602">Prepare Event Handler</text><ellipse cx="1603" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,1307.6133,1605,1302.6133,1603,1307.6133,1605,1312.6133,1599,1307.6133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1738" y="97.7988"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1734" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1741" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1738" y="1287.125"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1734" y="1291.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1741" y="1311.6602">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1914" y="134.334">Position Event Handler</text><ellipse cx="1994" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1990,92.7988,1996,87.7988,1994,92.7988,1996,97.7988,1990,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1914" y="1300.6602">Position Event Handler</text><ellipse cx="1994" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1990,1307.6133,1996,1302.6133,1994,1307.6133,1996,1312.6133,1990,1307.6133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2088" y="97.7988"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2084" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2091" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2088" y="1287.125"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2084" y="1291.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2091" y="1311.6602">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2220" y="134.334">Transfer Event Handler</text><ellipse cx="2301.5" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2297.5,92.7988,2303.5,87.7988,2301.5,92.7988,2303.5,97.7988,2297.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2220" y="1300.6602">Transfer Event Handler</text><ellipse cx="2301.5" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2297.5,1307.6133,2303.5,1302.6133,2301.5,1307.6133,2303.5,1312.6133,2297.5,1307.6133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2397" y="97.7988"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2393" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2400" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2397" y="1287.125"/><rect fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2393" y="1291.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2400" y="1311.6602">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2550" y="134.334">Position DAO</text><ellipse cx="2598" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2586" x2="2610" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2550" y="1300.6602">Position DAO</text><ellipse cx="2598" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2586" x2="2610" y1="1333.6133" y2="1333.6133"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2656" y="134.334">Event DAO</text><ellipse cx="2695" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2683" x2="2707" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2656" y="1300.6602">Event DAO</text><ellipse cx="2695" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2683" x2="2707" y1="1333.6133" y2="1333.6133"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="2744" y="134.334">Transfer DAO</text><ellipse cx="2793.5" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2781.5" x2="2805.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="2744" y="1300.6602">Transfer DAO</text><ellipse cx="2793.5" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2781.5" x2="2805.5" y1="1333.6133" y2="1333.6133"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="2853" y="134.334">Notification DAO</text><ellipse cx="2913" cy="104.7988" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2901" x2="2925" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="2853" y="1300.6602">Notification DAO</text><ellipse cx="2913" cy="1319.6133" fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2901" x2="2925" y1="1333.6133" y2="1333.6133"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2983" y="134.334">Central Store</text><path d="M3013,84.7988 C3013,74.7988 3031,74.7988 3031,74.7988 C3031,74.7988 3049,74.7988 3049,84.7988 L3049,110.7988 C3049,120.7988 3031,120.7988 3031,120.7988 C3031,120.7988 3013,120.7988 3013,110.7988 L3013,84.7988 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3013,84.7988 C3013,94.7988 3031,94.7988 3031,94.7988 C3031,94.7988 3049,94.7988 3049,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2983" y="1300.6602">Central Store</text><path d="M3013,1313.6133 C3013,1303.6133 3031,1303.6133 3031,1303.6133 C3031,1303.6133 3049,1303.6133 3049,1313.6133 L3049,1339.6133 C3049,1349.6133 3031,1349.6133 3031,1349.6133 C3031,1349.6133 3013,1349.6133 3013,1339.6133 L3013,1313.6133 " fill="#FEFECE" filter="url(#f6nm1j8cvtdgo)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3013,1313.6133 C3013,1323.6133 3031,1323.6133 3031,1323.6133 C3031,1323.6133 3049,1323.6133 3049,1313.6133 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f6nm1j8cvtdgo)" height="459.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f6nm1j8cvtdgo)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="1116.2617"/><rect fill="#FFFFFF" filter="url(#f6nm1j8cvtdgo)" height="509.1426" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="607.1191"/><rect fill="none" height="1116.8379" style="stroke: #000000; stroke-width: 2.0;" width="2950" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="110" y="166.9219">[Prepare Validation Failure]</text><polygon fill="#A80036" points="328.5,188.5977,338.5,192.5977,328.5,196.5977,332.5,192.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="192.5977" y2="192.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="188.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="188.166">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#f6nm1j8cvtdgo)" points="355,205.9082,355,475.9082,615,475.9082,615,215.9082,605,205.9082,355,205.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="605" x2="605" y1="205.9082" y2="215.9082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="615" x2="605" y1="215.9082" y2="215.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="223.4766">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="238.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="254.0977">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="377" y="269.4082">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="377" y="284.7188">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="300.0293">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="315.3398">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="330.6504">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="345.9609">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="361.2715">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="409" y="376.582">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="391.8926">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="407.2031">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="409" y="422.5137">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="437.8242">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="453.1348">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="468.4453">}</text><polygon fill="#A80036" points="1207,502.1875,1217,506.1875,1207,510.1875,1211,506.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1213" y1="506.1875" y2="506.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="501.7559">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="501.7559">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1261" y1="535.8086" y2="535.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1261" x2="1261" y1="535.8086" y2="548.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1220" x2="1261" y1="548.8086" y2="548.8086"/><polygon fill="#A80036" points="1230,544.8086,1220,548.8086,1230,552.8086,1226,548.8086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="531.0664">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1239" y="531.0664">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,573.8086,351.5,577.8086,361.5,581.8086,357.5,577.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1218" y1="577.8086" y2="577.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="573.377">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="573.377">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,603.1191,68.5,607.1191,78.5,611.1191,74.5,607.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="607.1191" y2="607.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="602.6875">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="602.6875">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1586,632.4297,1596,636.4297,1586,640.4297,1590,636.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1592" y1="636.4297" y2="636.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="631.998">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1239" y="631.998">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="666.0508" y2="666.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="666.0508" y2="679.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="679.0508" y2="679.0508"/><polygon fill="#A80036" points="1619,675.0508,1609,679.0508,1619,683.0508,1615,679.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="661.3086">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1628" y="661.3086">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="708.3613" y2="708.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="708.3613" y2="721.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="721.3613" y2="721.3613"/><polygon fill="#A80036" points="1619,717.3613,1609,721.3613,1619,725.3613,1615,721.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="703.6191">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1628" y="703.6191">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="750.6719" y2="750.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="750.6719" y2="763.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="763.6719" y2="763.6719"/><polygon fill="#A80036" points="1619,759.6719,1609,763.6719,1619,767.6719,1615,763.6719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="745.9297">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1628" y="745.9297">Validates message signature</text><polygon fill="#FF0000" filter="url(#f6nm1j8cvtdgo)" points="1613,776.6719,1613,801.6719,1745,801.6719,1745,786.6719,1735,776.6719,1613,776.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1735" x2="1735" y1="776.6719" y2="786.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1745" x2="1735" y1="786.6719" y2="786.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1619" y="794.2402">Validation failure!</text><polygon fill="#FFFF00" filter="url(#f6nm1j8cvtdgo)" points="1613,815.9824,1613,1085.9824,1893,1085.9824,1893,825.9824,1883,815.9824,1613,815.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1883" x2="1883" y1="815.9824" y2="825.9824"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1893" x2="1883" y1="825.9824" y2="825.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1619" y="833.5508">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="848.8613">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1635" y="864.1719">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1635" y="879.4824">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1635" y="894.793">to: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1635" y="910.1035">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1635" y="925.4141">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1635" y="940.7246">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1651" y="956.0352">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1667" y="971.3457">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1667" y="986.6563">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1667" y="1001.9668">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1667" y="1017.2773">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="1667" y="1032.5879">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1651" y="1047.8984">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1635" y="1063.209">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="1078.5195">}</text><polygon fill="#A80036" points="2454.5,1112.2617,2464.5,1116.2617,2454.5,1120.2617,2458.5,1116.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="2460.5" y1="1116.2617" y2="1116.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1610" y="1111.8301">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1632" y="1111.8301">Publishes Notification (failure) event for DFSP1</text><polygon fill="#A80036" points="543,1141.5723,533,1145.5723,543,1149.5723,539,1145.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="2465.5" y1="1145.5723" y2="1145.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="1141.1406">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="1141.1406">Consumes Notifications event</text><polygon fill="#A80036" points="1046,1170.8828,1056,1174.8828,1046,1178.8828,1050,1174.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="1174.8828" y2="1174.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="1170.4512">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="1170.4512">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="1069,1200.1934,1059,1204.1934,1069,1208.1934,1065,1204.1934" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2901,1200.1934,2911,1204.1934,2901,1208.1934,2905,1204.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="2907" y1="1204.1934" y2="1204.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="1199.7617">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="1199.7617">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="543,1229.5039,533,1233.5039,543,1237.5039,539,1233.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="1233.5039" y2="1233.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="1229.0723">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="1229.0723">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,1258.8145,68.5,1262.8145,78.5,1266.8145,74.5,1262.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="526" y1="1262.8145" y2="1262.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="1258.3828">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="1258.3828">HTTP Callback with Prepare result to DFSP1</text><!--
@startuml
' declate title
title 1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt Prepare Validation Failure
    activate MLAPI
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: prepare,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    note right of PREP_HANDLER #red: Validation failure!
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp1,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notification (failure) event for DFSP1
    deactivate PREP_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    deactivate NOTIFY_HANDLER
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>