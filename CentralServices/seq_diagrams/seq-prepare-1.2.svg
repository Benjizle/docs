<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1689px" preserveAspectRatio="none" style="width:3532px;height:1689px;" version="1.1" viewBox="0 0 3532 1689" width="3532px" zoomAndPan="magnify"><defs><filter height="300%" id="fq0x3349syhzy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="591" x="1471.5" y="23.5352">1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure</text><rect fill="#ADD8E6" height="1643.9199" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="1643.9199" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1643.9199" style="stroke: #A80036; stroke-width: 1.0;" width="2528" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2200.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fq0x3349syhzy)" height="444.5215" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fq0x3349syhzy)" height="205.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="1361.4355"/><rect fill="#FFFFFF" filter="url(#fq0x3349syhzy)" height="769.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="591.8086"/><rect fill="#FFFFFF" filter="url(#fq0x3349syhzy)" height="1420.6328" style="stroke: #000000; stroke-width: 2.0;" width="3488" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1219" x2="1219" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1603" x2="1603" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2078" x2="2078" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2253" x2="2253" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2406" x2="2406" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2560" x2="2560" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2725" x2="2725" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2857" x2="2857" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2954" x2="2954" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3052" x2="3052" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3172" x2="3172" y1="137.2871" y2="1591.9199"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3463" x2="3463" y1="137.2871" y2="1591.9199"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="1604.4551">DFSP1</text><ellipse cx="67.5" cy="1617.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,1625.4082 L67.5,1652.4082 M54.5,1633.4082 L80.5,1633.4082 M67.5,1652.4082 L54.5,1667.4082 M67.5,1652.4082 L80.5,1667.4082 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="1604.4551">DFSP2</text><ellipse cx="126.5" cy="1617.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,1625.4082 L126.5,1652.4082 M113.5,1633.4082 L139.5,1633.4082 M126.5,1652.4082 L113.5,1667.4082 M126.5,1652.4082 L139.5,1667.4082 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="1604.4551">ML API Adapter</text><path d="M325,1611.4082 L325,1635.4082 M325,1623.4082 L342,1623.4082 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="1604.4551">ML API Notification Event Handler</text><ellipse cx="527" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,1611.4082,529,1606.4082,527,1611.4082,529,1616.4082,523,1611.4082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="1604.4551">Central Service API</text><path d="M1037.5,1611.4082 L1037.5,1635.4082 M1037.5,1623.4082 L1054.5,1623.4082 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="1590.9199"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="1594.9199"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="1615.4551">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="134.334">Prepare Event Handler</text><ellipse cx="1603" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,92.7988,1605,87.7988,1603,92.7988,1605,97.7988,1599,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="1604.4551">Prepare Event Handler</text><ellipse cx="1603" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,1611.4082,1605,1606.4082,1603,1611.4082,1605,1616.4082,1599,1611.4082" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1997" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1993" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2000" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1997" y="1590.9199"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1993" y="1594.9199"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2000" y="1615.4551">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2173" y="134.334">Position Event Handler</text><ellipse cx="2253" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2249,92.7988,2255,87.7988,2253,92.7988,2255,97.7988,2249,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2173" y="1604.4551">Position Event Handler</text><ellipse cx="2253" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2249,1611.4082,2255,1606.4082,2253,1611.4082,2255,1616.4082,2249,1611.4082" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2347" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2343" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2350" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2347" y="1590.9199"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2343" y="1594.9199"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2350" y="1615.4551">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2479" y="134.334">Transfer Event Handler</text><ellipse cx="2560.5" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2556.5,92.7988,2562.5,87.7988,2560.5,92.7988,2562.5,97.7988,2556.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2479" y="1604.4551">Transfer Event Handler</text><ellipse cx="2560.5" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2556.5,1611.4082,2562.5,1606.4082,2560.5,1611.4082,2562.5,1616.4082,2556.5,1611.4082" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2656" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2652" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2659" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2656" y="1590.9199"/><rect fill="#FEFECE" filter="url(#fq0x3349syhzy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2652" y="1594.9199"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2659" y="1615.4551">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2809" y="134.334">Position DAO</text><ellipse cx="2857" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2845" x2="2869" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2809" y="1604.4551">Position DAO</text><ellipse cx="2857" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2845" x2="2869" y1="1637.4082" y2="1637.4082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2915" y="134.334">Event DAO</text><ellipse cx="2954" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2942" x2="2966" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2915" y="1604.4551">Event DAO</text><ellipse cx="2954" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2942" x2="2966" y1="1637.4082" y2="1637.4082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3003" y="134.334">Transfer DAO</text><ellipse cx="3052.5" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3040.5" x2="3064.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3003" y="1604.4551">Transfer DAO</text><ellipse cx="3052.5" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3040.5" x2="3064.5" y1="1637.4082" y2="1637.4082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3112" y="134.334">Notification DAO</text><ellipse cx="3172" cy="104.7988" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3160" x2="3184" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3112" y="1604.4551">Notification DAO</text><ellipse cx="3172" cy="1623.4082" fill="#FEFECE" filter="url(#fq0x3349syhzy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3160" x2="3184" y1="1637.4082" y2="1637.4082"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3415" y="134.334">Central Store</text><path d="M3445,84.7988 C3445,74.7988 3463,74.7988 3463,74.7988 C3463,74.7988 3481,74.7988 3481,84.7988 L3481,110.7988 C3481,120.7988 3463,120.7988 3463,120.7988 C3463,120.7988 3445,120.7988 3445,110.7988 L3445,84.7988 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3445,84.7988 C3445,94.7988 3463,94.7988 3463,94.7988 C3463,94.7988 3481,94.7988 3481,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3415" y="1604.4551">Central Store</text><path d="M3445,1617.4082 C3445,1607.4082 3463,1607.4082 3463,1607.4082 C3463,1607.4082 3481,1607.4082 3481,1617.4082 L3481,1643.4082 C3481,1653.4082 3463,1653.4082 3463,1653.4082 C3463,1653.4082 3445,1653.4082 3445,1643.4082 L3445,1617.4082 " fill="#FEFECE" filter="url(#fq0x3349syhzy)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3445,1617.4082 C3445,1627.4082 3463,1627.4082 3463,1627.4082 C3463,1627.4082 3481,1627.4082 3481,1617.4082 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fq0x3349syhzy)" height="444.5215" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#fq0x3349syhzy)" height="205.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="1361.4355"/><rect fill="#FFFFFF" filter="url(#fq0x3349syhzy)" height="769.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="591.8086"/><rect fill="none" height="1420.6328" style="stroke: #000000; stroke-width: 2.0;" width="3488" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="110" y="166.9219">[Prepare Validation Failure]</text><polygon fill="#A80036" points="328.5,188.5977,338.5,192.5977,328.5,196.5977,332.5,192.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="192.5977" y2="192.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="188.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="188.166">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#fq0x3349syhzy)" points="355,205.9082,355,459.9082,579,459.9082,579,215.9082,569,205.9082,355,205.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="569" x2="569" y1="205.9082" y2="215.9082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="579" x2="569" y1="215.9082" y2="215.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="223.4766">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="238.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="254.0977">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="377" y="269.4082">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="377" y="284.7188">to: dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="300.0293">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="315.3398">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="330.6504">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="345.9609">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="361.2715">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="376.582">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="391.8926">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="409" y="407.2031">createdAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="422.5137">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="437.8242">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="453.1348">}</text><polygon fill="#A80036" points="1207,486.877,1217,490.877,1207,494.877,1211,490.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1213" y1="490.877" y2="490.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="486.4453">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="486.4453">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1261" y1="520.498" y2="520.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1261" x2="1261" y1="520.498" y2="533.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1220" x2="1261" y1="533.498" y2="533.498"/><polygon fill="#A80036" points="1230,529.498,1220,533.498,1230,537.498,1226,533.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="515.7559">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1239" y="515.7559">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,558.498,351.5,562.498,361.5,566.498,357.5,562.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1218" y1="562.498" y2="562.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="558.0664">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="558.0664">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,587.8086,68.5,591.8086,78.5,595.8086,74.5,591.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="591.8086" y2="591.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="587.377">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="587.377">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1586,617.1191,1596,621.1191,1586,625.1191,1590,621.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1592" y1="621.1191" y2="621.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="616.6875">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1239" y="616.6875">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="650.7402" y2="650.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="650.7402" y2="663.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="663.7402" y2="663.7402"/><polygon fill="#A80036" points="1619,659.7402,1609,663.7402,1619,667.7402,1615,663.7402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="645.998">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1628" y="645.998">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="693.0508" y2="693.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="693.0508" y2="706.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="706.0508" y2="706.0508"/><polygon fill="#A80036" points="1619,702.0508,1609,706.0508,1619,710.0508,1615,706.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="688.3086">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1628" y="688.3086">Validates to - DFSP2</text><polygon fill="#A80036" points="3040.5,731.0508,3050.5,735.0508,3040.5,739.0508,3044.5,735.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="3046.5" y1="735.0508" y2="735.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="730.6191">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1628" y="730.6191">Request to retrieve Transfer (if it exists)</text><polygon fill="#A80036" points="3063.5,760.3613,3053.5,764.3613,3063.5,768.3613,3059.5,764.3613" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3451,760.3613,3461,764.3613,3451,768.3613,3455,764.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3057.5" x2="3457" y1="764.3613" y2="764.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3069.5" y="759.9297">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="3091.5" y="759.9297">return Transfer if it exists</text><polygon fill="#A80036" points="1619,789.6719,1609,793.6719,1619,797.6719,1615,793.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1613" x2="3051.5" y1="793.6719" y2="793.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1625" y="789.2402">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1647" y="789.2402">return Transfer if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="823.293" y2="823.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="823.293" y2="836.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="836.293" y2="836.293"/><polygon fill="#A80036" points="1619,832.293,1609,836.293,1619,840.293,1615,836.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="818.5508">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1637" y="818.5508">Validates duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="865.6035" y2="865.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="865.6035" y2="878.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="878.6035" y2="878.6035"/><polygon fill="#A80036" points="1619,874.6035,1609,878.6035,1619,882.6035,1615,878.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="860.8613">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1637" y="860.8613">Validates crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="907.9141" y2="907.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="907.9141" y2="920.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="920.9141" y2="920.9141"/><polygon fill="#A80036" points="1619,916.9141,1609,920.9141,1619,924.9141,1615,920.9141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="903.1719">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1637" y="903.1719">Validates message signature (to be confirmed in future requirement)</text><polygon fill="#FF0000" filter="url(#fq0x3349syhzy)" points="1613,933.9141,1613,958.9141,1745,958.9141,1745,943.9141,1735,933.9141,1613,933.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1735" x2="1735" y1="933.9141" y2="943.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1745" x2="1735" y1="943.9141" y2="943.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1619" y="951.4824">Validation failure!</text><polygon fill="#A80036" points="2942,985.2246,2952,989.2246,2942,993.2246,2946,989.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="2948" y1="989.2246" y2="989.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="984.793">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1637" y="984.793">Request to persist event information</text><polygon fill="#A80036" points="2965,1014.5352,2955,1018.5352,2965,1022.5352,2961,1018.5352" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3451,1014.5352,3461,1018.5352,3451,1022.5352,3455,1018.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2959" x2="3457" y1="1018.5352" y2="1018.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2971" y="1014.1035">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="2993" y="1014.1035">Persist event information</text><polygon fill="#A80036" points="1619,1043.8457,1609,1047.8457,1619,1051.8457,1615,1047.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1613" x2="2953" y1="1047.8457" y2="1047.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1625" y="1043.4141">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1647" y="1043.4141">return success</text><polygon fill="#FFFF00" filter="url(#fq0x3349syhzy)" points="1613,1061.1563,1613,1331.1563,1893,1331.1563,1893,1071.1563,1883,1061.1563,1613,1061.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1883" x2="1883" y1="1061.1563" y2="1071.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1893" x2="1883" y1="1071.1563" y2="1071.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1619" y="1078.7246">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="1094.0352">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1635" y="1109.3457">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1635" y="1124.6563">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1635" y="1139.9668">to: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1635" y="1155.2773">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1635" y="1170.5879">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1635" y="1185.8984">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1651" y="1201.209">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1667" y="1216.5195">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1667" y="1231.8301">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1667" y="1247.1406">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1667" y="1262.4512">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="1667" y="1277.7617">createdAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1651" y="1293.0723">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1635" y="1308.3828">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="1323.6934">}</text><polygon fill="#A80036" points="2713.5,1357.4355,2723.5,1361.4355,2713.5,1365.4355,2717.5,1361.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="2719.5" y1="1361.4355" y2="1361.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1610" y="1357.0039">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1632" y="1357.0039">Publishes Notification (failure) event for DFSP1</text><polygon fill="#A80036" points="543,1386.7461,533,1390.7461,543,1394.7461,539,1390.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="2724.5" y1="1390.7461" y2="1390.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="1386.3145">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="1386.3145">Consumes Notifications event</text><polygon fill="#A80036" points="1046,1416.0566,1056,1420.0566,1046,1424.0566,1050,1420.0566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="1420.0566" y2="1420.0566"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="1415.625">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="1415.625">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="3160,1445.3672,3170,1449.3672,3160,1453.3672,3164,1449.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1058" x2="3166" y1="1449.3672" y2="1449.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1065" y="1444.9355">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1087" y="1444.9355">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="3183,1474.6777,3173,1478.6777,3183,1482.6777,3179,1478.6777" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3451,1474.6777,3461,1478.6777,3451,1482.6777,3455,1478.6777" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3177" x2="3457" y1="1478.6777" y2="1478.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3189" y="1474.2461">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="3211" y="1474.2461">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="1069,1503.9883,1059,1507.9883,1069,1511.9883,1065,1507.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3171" y1="1507.9883" y2="1507.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="1503.5566">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="1503.5566">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="543,1533.2988,533,1537.2988,543,1541.2988,539,1537.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="1537.2988" y2="1537.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="1532.8672">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="1532.8672">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,1562.6094,68.5,1566.6094,78.5,1570.6094,74.5,1566.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="526" y1="1566.6094" y2="1566.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="1562.1777">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="1562.1777">HTTP Callback with Prepare result to DFSP1</text><!--
@startuml
' declate title
title 1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt Prepare Validation Failure
    activate MLAPI
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer (if it exists)
    TRANS_DAO <-> DB: return Transfer if it exists
    TRANS_DAO -> PREP_HANDLER: return Transfer if it exists
    PREP_HANDLER <-> PREP_HANDLER: Validates duplicate Check
    PREP_HANDLER <-> PREP_HANDLER: Validates crypto-condition
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature (to be confirmed in future requirement)
    note right of PREP_HANDLER #red: Validation failure!
    PREP_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> PREP_HANDLER: return success
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp1,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createdAt: <timestamp>
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notification (failure) event for DFSP1
    deactivate PREP_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI -> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_DAO <-> DB: Fetches Notifications details for DFSP1
    NOTIFY_DAO -> CSAPI: Returns Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    deactivate NOTIFY_HANDLER
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>