<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1009px" preserveAspectRatio="none" style="width:3277px;height:1009px;" version="1.1" viewBox="0 0 3277 1009" width="3277px" zoomAndPan="magnify"><defs><filter height="300%" id="f3f3e4f65rn1b" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="591" x="1339.5" y="23.5352">1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure</text><rect fill="#ADD8E6" height="963.9824" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="963.9824" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="963.9824" style="stroke: #A80036; stroke-width: 1.0;" width="2279" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2076" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f3f3e4f65rn1b)" height="367.9688" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f3f3e4f65rn1b)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="740.1191"/><rect fill="#FFFFFF" filter="url(#f3f3e4f65rn1b)" height="224.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1628.5" y="515.2559"/><rect fill="#FFFFFF" filter="url(#f3f3e4f65rn1b)" height="740.6953" style="stroke: #000000; stroke-width: 2.0;" width="3133" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1249" x2="1249" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1633.5" x2="1633.5" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1849" x2="1849" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2055" x2="2055" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2238" x2="2238" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2423" x2="2423" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2619" x2="2619" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2781" x2="2781" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2878" x2="2878" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2976" x2="2976" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3096" x2="3096" y1="137.2871" y2="911.9824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3214" x2="3214" y1="137.2871" y2="911.9824"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="924.5176">DFSP1</text><ellipse cx="67.5" cy="937.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,945.4707 L67.5,972.4707 M54.5,953.4707 L80.5,953.4707 M67.5,972.4707 L54.5,987.4707 M67.5,972.4707 L80.5,987.4707 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="924.5176">DFSP2</text><ellipse cx="126.5" cy="937.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,945.4707 L126.5,972.4707 M113.5,953.4707 L139.5,953.4707 M126.5,972.4707 L113.5,987.4707 M126.5,972.4707 L139.5,987.4707 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="924.5176">ML API Adapter</text><path d="M325,931.4707 L325,955.4707 M325,943.4707 L342,943.4707 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="924.5176">ML API Notification Event Handler</text><ellipse cx="527" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,931.4707,529,926.4707,527,931.4707,529,936.4707,523,931.4707" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="924.5176">Central Service API</text><path d="M1037.5,931.4707 L1037.5,955.4707 M1037.5,943.4707 L1054.5,943.4707 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="1142" y="122.334">Prepare-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1139" y="910.9824"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1135" y="914.9824"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="1142" y="935.5176">Prepare-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1554.5" y="134.334">Prepare Event Handler</text><ellipse cx="1633.5" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1629.5,92.7988,1635.5,87.7988,1633.5,92.7988,1635.5,97.7988,1629.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1554.5" y="924.5176">Prepare Event Handler</text><ellipse cx="1633.5" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1629.5,931.4707,1635.5,926.4707,1633.5,931.4707,1635.5,936.4707,1629.5,931.4707" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1738" y="97.7988"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1734" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="1741" y="122.334">Position-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1738" y="910.9824"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1734" y="914.9824"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="1741" y="935.5176">Position-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1975" y="134.334">Position Event Handler</text><ellipse cx="2055" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2051,92.7988,2057,87.7988,2055,92.7988,2057,97.7988,2051,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1975" y="924.5176">Position Event Handler</text><ellipse cx="2055" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2051,931.4707,2057,926.4707,2055,931.4707,2057,936.4707,2051,931.4707" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2149" y="97.7988"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2145" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="2152" y="122.334">Transfer-Topic-handler</text><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2149" y="910.9824"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2145" y="914.9824"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="2152" y="935.5176">Transfer-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2342" y="134.334">Transfer Event Handler</text><ellipse cx="2423.5" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2419.5,92.7988,2425.5,87.7988,2423.5,92.7988,2425.5,97.7988,2419.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2342" y="924.5176">Transfer Event Handler</text><ellipse cx="2423.5" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2419.5,931.4707,2425.5,926.4707,2423.5,931.4707,2425.5,936.4707,2419.5,931.4707" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2519" y="97.7988"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2515" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="2522" y="122.334">Notification-Topic-handler</text><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2519" y="910.9824"/><rect fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2515" y="914.9824"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="2522" y="935.5176">Notification-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2733" y="134.334">Position DAO</text><ellipse cx="2781" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2769" x2="2793" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2733" y="924.5176">Position DAO</text><ellipse cx="2781" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2769" x2="2793" y1="957.4707" y2="957.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2839" y="134.334">Event DAO</text><ellipse cx="2878" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2866" x2="2890" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2839" y="924.5176">Event DAO</text><ellipse cx="2878" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2866" x2="2890" y1="957.4707" y2="957.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="2927" y="134.334">Transfer DAO</text><ellipse cx="2976.5" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2964.5" x2="2988.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="2927" y="924.5176">Transfer DAO</text><ellipse cx="2976.5" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2964.5" x2="2988.5" y1="957.4707" y2="957.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3036" y="134.334">Notification DAO</text><ellipse cx="3096" cy="104.7988" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3084" x2="3108" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3036" y="924.5176">Notification DAO</text><ellipse cx="3096" cy="943.4707" fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3084" x2="3108" y1="957.4707" y2="957.4707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3166" y="134.334">Central Store</text><path d="M3196,84.7988 C3196,74.7988 3214,74.7988 3214,74.7988 C3214,74.7988 3232,74.7988 3232,84.7988 L3232,110.7988 C3232,120.7988 3214,120.7988 3214,120.7988 C3214,120.7988 3196,120.7988 3196,110.7988 L3196,84.7988 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3196,84.7988 C3196,94.7988 3214,94.7988 3214,94.7988 C3214,94.7988 3232,94.7988 3232,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3166" y="924.5176">Central Store</text><path d="M3196,937.4707 C3196,927.4707 3214,927.4707 3214,927.4707 C3214,927.4707 3232,927.4707 3232,937.4707 L3232,963.4707 C3232,973.4707 3214,973.4707 3214,973.4707 C3214,973.4707 3196,973.4707 3196,963.4707 L3196,937.4707 " fill="#FEFECE" filter="url(#f3f3e4f65rn1b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3196,937.4707 C3196,947.4707 3214,947.4707 3214,947.4707 C3214,947.4707 3232,947.4707 3232,937.4707 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f3f3e4f65rn1b)" height="367.9688" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f3f3e4f65rn1b)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="740.1191"/><rect fill="#FFFFFF" filter="url(#f3f3e4f65rn1b)" height="224.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1628.5" y="515.2559"/><rect fill="none" height="740.6953" style="stroke: #000000; stroke-width: 2.0;" width="3133" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="110" y="166.9219">[Prepare Validation Failure]</text><polygon fill="#A80036" points="328.5,188.5977,338.5,192.5977,328.5,196.5977,332.5,192.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="192.5977" y2="192.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="188.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="188.166">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#f3f3e4f65rn1b)" points="355,205.9082,355,383.9082,575,383.9082,575,215.9082,565,205.9082,355,205.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="565" y1="205.9082" y2="215.9082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="575" x2="565" y1="215.9082" y2="215.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="223.4766">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="238.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="254.0977">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="377" y="269.4082">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="377" y="284.7188">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="300.0293">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="315.3398">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="393" y="330.6504">eventType: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="393" y="345.9609">eventAction: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="361.2715">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="376.582">}</text><polygon fill="#A80036" points="1237.5,410.3242,1247.5,414.3242,1237.5,418.3242,1241.5,414.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1243.5" y1="414.3242" y2="414.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="409.8926">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="409.8926">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1249.5" x2="1291.5" y1="443.9453" y2="443.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1291.5" x2="1291.5" y1="443.9453" y2="456.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.5" x2="1291.5" y1="456.9453" y2="456.9453"/><polygon fill="#A80036" points="1260.5,452.9453,1250.5,456.9453,1260.5,460.9453,1256.5,456.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1256.5" y="439.2031">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1269.5" y="439.2031">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,481.9453,351.5,485.9453,361.5,489.9453,357.5,485.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1248.5" y1="485.9453" y2="485.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="481.5137">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="481.5137">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,511.2559,68.5,515.2559,78.5,519.2559,74.5,515.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="515.2559" y2="515.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="510.8242">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="510.8242">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1616.5,540.5664,1626.5,544.5664,1616.5,548.5664,1620.5,544.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1249.5" x2="1622.5" y1="544.5664" y2="544.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1256.5" y="540.1348">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1269.5" y="540.1348">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1638.5" x2="1680.5" y1="574.1875" y2="574.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680.5" x2="1680.5" y1="574.1875" y2="587.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639.5" x2="1680.5" y1="587.1875" y2="587.1875"/><polygon fill="#A80036" points="1649.5,583.1875,1639.5,587.1875,1649.5,591.1875,1645.5,587.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1645.5" y="569.4453">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1658.5" y="569.4453">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1638.5" x2="1680.5" y1="616.498" y2="616.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680.5" x2="1680.5" y1="616.498" y2="629.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639.5" x2="1680.5" y1="629.498" y2="629.498"/><polygon fill="#A80036" points="1649.5,625.498,1639.5,629.498,1649.5,633.498,1645.5,629.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1645.5" y="611.7559">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1658.5" y="611.7559">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1638.5" x2="1680.5" y1="658.8086" y2="658.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680.5" x2="1680.5" y1="658.8086" y2="671.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639.5" x2="1680.5" y1="671.8086" y2="671.8086"/><polygon fill="#A80036" points="1649.5,667.8086,1639.5,671.8086,1649.5,675.8086,1645.5,671.8086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1645.5" y="654.0664">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1658.5" y="654.0664">Validates message signature</text><polygon fill="#FF0000" filter="url(#f3f3e4f65rn1b)" points="1643,684.8086,1643,709.8086,1775,709.8086,1775,694.8086,1765,684.8086,1643,684.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1765" x2="1765" y1="684.8086" y2="694.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1775" x2="1765" y1="694.8086" y2="694.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1649" y="702.377">Validation failure!</text><polygon fill="#A80036" points="2607,736.1191,2617,740.1191,2607,744.1191,2611,740.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1633.5" x2="2613" y1="740.1191" y2="740.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1640.5" y="735.6875">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1662.5" y="735.6875">Publishes Notification (failure) event for DFSP1</text><polygon fill="#A80036" points="543,765.4297,533,769.4297,543,773.4297,539,769.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="2618" y1="769.4297" y2="769.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="764.998">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="764.998">Consumes Notifications event</text><polygon fill="#A80036" points="1046,794.7402,1056,798.7402,1046,802.7402,1050,798.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="798.7402" y2="798.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="794.3086">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="794.3086">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="1069,824.0508,1059,828.0508,1069,832.0508,1065,828.0508" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3084,824.0508,3094,828.0508,3084,832.0508,3088,828.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3090" y1="828.0508" y2="828.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="823.6191">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="823.6191">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="543,853.3613,533,857.3613,543,861.3613,539,857.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="857.3613" y2="857.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="852.9297">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="852.9297">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,882.6719,68.5,886.6719,78.5,890.6719,74.5,886.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="526" y1="886.6719" y2="886.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="882.2402">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="882.2402">HTTP Callback with Prepare result to DFSP1</text><!--
@startuml
' declate title
title 1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-handler-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-handler-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic-handler" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic-handler" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt Prepare Validation Failure
    activate MLAPI
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            content: <transferMessage>,
            metadata: {
                eventType: prepare,
                eventAction: prepare,
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    note right of PREP_HANDLER #red: Validation failure!
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notification (failure) event for DFSP1
    deactivate PREP_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    deactivate NOTIFY_HANDLER
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>