<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2478px" preserveAspectRatio="none" style="width:3532px;height:2478px;" version="1.1" viewBox="0 0 3532 2478" width="3532px" zoomAndPan="magnify"><defs><filter height="300%" id="flpy45m52ovba" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="591" x="1471.5" y="23.5352">1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure</text><rect fill="#ADD8E6" height="2433.4473" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="2433.4473" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2433.4473" style="stroke: #A80036; stroke-width: 1.0;" width="2528" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2200.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#flpy45m52ovba)" height="1050.3223" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#flpy45m52ovba)" height="205.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2150.9629"/><rect fill="#FFFFFF" filter="url(#flpy45m52ovba)" height="953.3535" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="1197.6094"/><rect fill="#FFFFFF" filter="url(#flpy45m52ovba)" height="2210.1602" style="stroke: #000000; stroke-width: 2.0;" width="3488" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1219" x2="1219" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1603" x2="1603" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2078" x2="2078" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2253" x2="2253" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2406" x2="2406" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2560" x2="2560" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2725" x2="2725" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2857" x2="2857" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2954" x2="2954" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3052" x2="3052" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3172" x2="3172" y1="137.2871" y2="2381.4473"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3463" x2="3463" y1="137.2871" y2="2381.4473"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2393.9824">DFSP1</text><ellipse cx="67.5" cy="2406.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2414.9355 L67.5,2441.9355 M54.5,2422.9355 L80.5,2422.9355 M67.5,2441.9355 L54.5,2456.9355 M67.5,2441.9355 L80.5,2456.9355 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2393.9824">DFSP2</text><ellipse cx="126.5" cy="2406.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2414.9355 L126.5,2441.9355 M113.5,2422.9355 L139.5,2422.9355 M126.5,2441.9355 L113.5,2456.9355 M126.5,2441.9355 L139.5,2456.9355 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2393.9824">ML API Adapter</text><path d="M325,2400.9355 L325,2424.9355 M325,2412.9355 L342,2412.9355 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="2393.9824">ML API Notification Event Handler</text><ellipse cx="527" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,2400.9355,529,2395.9355,527,2400.9355,529,2405.9355,523,2400.9355" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="2393.9824">Central Service API</text><path d="M1037.5,2400.9355 L1037.5,2424.9355 M1037.5,2412.9355 L1054.5,2412.9355 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="2380.4473"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="2384.4473"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="2404.9824">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="134.334">Prepare Event Handler</text><ellipse cx="1603" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,92.7988,1605,87.7988,1603,92.7988,1605,97.7988,1599,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="2393.9824">Prepare Event Handler</text><ellipse cx="1603" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,2400.9355,1605,2395.9355,1603,2400.9355,1605,2405.9355,1599,2400.9355" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1997" y="97.7988"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1993" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2000" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1997" y="2380.4473"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1993" y="2384.4473"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2000" y="2404.9824">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2173" y="134.334">Position Event Handler</text><ellipse cx="2253" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2249,92.7988,2255,87.7988,2253,92.7988,2255,97.7988,2249,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2173" y="2393.9824">Position Event Handler</text><ellipse cx="2253" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2249,2400.9355,2255,2395.9355,2253,2400.9355,2255,2405.9355,2249,2400.9355" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2347" y="97.7988"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2343" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2350" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2347" y="2380.4473"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2343" y="2384.4473"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2350" y="2404.9824">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2479" y="134.334">Transfer Event Handler</text><ellipse cx="2560.5" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2556.5,92.7988,2562.5,87.7988,2560.5,92.7988,2562.5,97.7988,2556.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2479" y="2393.9824">Transfer Event Handler</text><ellipse cx="2560.5" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2556.5,2400.9355,2562.5,2395.9355,2560.5,2400.9355,2562.5,2405.9355,2556.5,2400.9355" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2656" y="97.7988"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2652" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2659" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2656" y="2380.4473"/><rect fill="#FEFECE" filter="url(#flpy45m52ovba)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2652" y="2384.4473"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2659" y="2404.9824">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2809" y="134.334">Position DAO</text><ellipse cx="2857" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2845" x2="2869" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2809" y="2393.9824">Position DAO</text><ellipse cx="2857" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2845" x2="2869" y1="2426.9355" y2="2426.9355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2915" y="134.334">Event DAO</text><ellipse cx="2954" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2942" x2="2966" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2915" y="2393.9824">Event DAO</text><ellipse cx="2954" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2942" x2="2966" y1="2426.9355" y2="2426.9355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3003" y="134.334">Transfer DAO</text><ellipse cx="3052.5" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3040.5" x2="3064.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3003" y="2393.9824">Transfer DAO</text><ellipse cx="3052.5" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3040.5" x2="3064.5" y1="2426.9355" y2="2426.9355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3112" y="134.334">Notification DAO</text><ellipse cx="3172" cy="104.7988" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3160" x2="3184" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3112" y="2393.9824">Notification DAO</text><ellipse cx="3172" cy="2412.9355" fill="#FEFECE" filter="url(#flpy45m52ovba)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3160" x2="3184" y1="2426.9355" y2="2426.9355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3415" y="134.334">Central Store</text><path d="M3445,84.7988 C3445,74.7988 3463,74.7988 3463,74.7988 C3463,74.7988 3481,74.7988 3481,84.7988 L3481,110.7988 C3481,120.7988 3463,120.7988 3463,120.7988 C3463,120.7988 3445,120.7988 3445,110.7988 L3445,84.7988 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3445,84.7988 C3445,94.7988 3463,94.7988 3463,94.7988 C3463,94.7988 3481,94.7988 3481,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3415" y="2393.9824">Central Store</text><path d="M3445,2406.9355 C3445,2396.9355 3463,2396.9355 3463,2396.9355 C3463,2396.9355 3481,2396.9355 3481,2406.9355 L3481,2432.9355 C3481,2442.9355 3463,2442.9355 3463,2442.9355 C3463,2442.9355 3445,2442.9355 3445,2432.9355 L3445,2406.9355 " fill="#FEFECE" filter="url(#flpy45m52ovba)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3445,2406.9355 C3445,2416.9355 3463,2416.9355 3463,2416.9355 C3463,2416.9355 3481,2416.9355 3481,2406.9355 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#flpy45m52ovba)" height="1050.3223" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#flpy45m52ovba)" height="205.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2150.9629"/><rect fill="#FFFFFF" filter="url(#flpy45m52ovba)" height="953.3535" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="1197.6094"/><rect fill="none" height="2210.1602" style="stroke: #000000; stroke-width: 2.0;" width="3488" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="110" y="166.9219">[Prepare Validation Failure]</text><polygon fill="#FFFF00" filter="url(#flpy45m52ovba)" points="72,176.5977,72,706.5977,413,706.5977,413,186.5977,403,176.5977,72,176.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403" x2="403" y1="176.5977" y2="186.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="413" x2="403" y1="186.5977" y2="186.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="78" y="194.166">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="209.4766">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="224.7871">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="240.0977">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="255.4082">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="270.7188">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="286.0293">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="301.3398">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="316.6504">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="331.9609">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="347.2715">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="362.582">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="377.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="78" y="393.2031">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="408.5137">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="94" y="423.8242">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="94" y="439.1348">"payeeFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="94" y="454.4453">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="94" y="469.7559">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="110" y="485.0664">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="110" y="500.377">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="515.6875">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="94" y="530.998">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="94" y="546.3086">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="94" y="561.6191">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="576.9297">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="592.2402">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="607.5508">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="126" y="622.8613">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="126" y="638.1719">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="653.4824">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="668.793">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="684.1035">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="699.4141">}</text><polygon fill="#A80036" points="328.5,733.1563,338.5,737.1563,328.5,741.1563,332.5,737.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="737.1563" y2="737.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="732.7246">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="732.7246">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#flpy45m52ovba)" points="355,750.4668,355,1066.4668,617,1066.4668,617,760.4668,607,750.4668,355,750.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="607" x2="607" y1="750.4668" y2="760.4668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="617" x2="607" y1="760.4668" y2="760.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="768.0352">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="783.3457">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="377" y="798.6563">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="377" y="813.9668">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="377" y="829.2773">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="844.5879">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="859.8984">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="393" y="875.209">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="393" y="890.5195">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="905.8301">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="921.1406">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="936.4512">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="951.7617">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="967.0723">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="982.3828">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="997.6934">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="409" y="1013.0039">status: ?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1028.3145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1043.625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1058.9355">}</text><polygon fill="#A80036" points="1207,1092.6777,1217,1096.6777,1207,1100.6777,1211,1096.6777" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1213" y1="1096.6777" y2="1096.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1092.2461">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="1092.2461">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1261" y1="1126.2988" y2="1126.2988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1261" x2="1261" y1="1126.2988" y2="1139.2988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1220" x2="1261" y1="1139.2988" y2="1139.2988"/><polygon fill="#A80036" points="1230,1135.2988,1220,1139.2988,1230,1143.2988,1226,1139.2988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="1121.5566">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1239" y="1121.5566">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,1164.2988,351.5,1168.2988,361.5,1172.2988,357.5,1168.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1218" y1="1168.2988" y2="1168.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1163.8672">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="1163.8672">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,1193.6094,68.5,1197.6094,78.5,1201.6094,74.5,1197.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="1197.6094" y2="1197.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1193.1777">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1193.1777">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1586,1222.9199,1596,1226.9199,1586,1230.9199,1590,1226.9199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1592" y1="1226.9199" y2="1226.9199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="1222.4883">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1239" y="1222.4883">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="1256.541" y2="1256.541"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="1256.541" y2="1269.541"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="1269.541" y2="1269.541"/><polygon fill="#A80036" points="1619,1265.541,1609,1269.541,1619,1273.541,1615,1269.541" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="1251.7988">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1628" y="1251.7988">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="1298.8516" y2="1298.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="1298.8516" y2="1311.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="1311.8516" y2="1311.8516"/><polygon fill="#A80036" points="1619,1307.8516,1609,1311.8516,1619,1315.8516,1615,1311.8516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="1294.1094">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1628" y="1294.1094">Validates to - DFSP2</text><polygon fill="#A80036" points="3040.5,1336.8516,3050.5,1340.8516,3040.5,1344.8516,3044.5,1340.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="3046.5" y1="1340.8516" y2="1340.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="1336.4199">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1628" y="1336.4199">Request to retrieve Transfer (if it exists)</text><polygon fill="#A80036" points="3063.5,1366.1621,3053.5,1370.1621,3063.5,1374.1621,3059.5,1370.1621" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3451,1366.1621,3461,1370.1621,3451,1374.1621,3455,1370.1621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3057.5" x2="3457" y1="1370.1621" y2="1370.1621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3069.5" y="1365.7305">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="3091.5" y="1365.7305">return Transfer if it exists</text><polygon fill="#A80036" points="1619,1395.4727,1609,1399.4727,1619,1403.4727,1615,1399.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1613" x2="3051.5" y1="1399.4727" y2="1399.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1625" y="1395.041">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1647" y="1395.041">return Transfer if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="1429.0938" y2="1429.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="1429.0938" y2="1442.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="1442.0938" y2="1442.0938"/><polygon fill="#A80036" points="1619,1438.0938,1609,1442.0938,1619,1446.0938,1615,1442.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="1424.3516">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1637" y="1424.3516">Validates duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="1471.4043" y2="1471.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="1471.4043" y2="1484.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="1484.4043" y2="1484.4043"/><polygon fill="#A80036" points="1619,1480.4043,1609,1484.4043,1619,1488.4043,1615,1484.4043" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="1466.6621">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1637" y="1466.6621">Validates crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="1513.7148" y2="1513.7148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="1513.7148" y2="1526.7148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="1526.7148" y2="1526.7148"/><polygon fill="#A80036" points="1619,1522.7148,1609,1526.7148,1619,1530.7148,1615,1526.7148" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="1508.9727">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1637" y="1508.9727">Validates message signature (to be confirmed in future requirement)</text><polygon fill="#FF0000" filter="url(#flpy45m52ovba)" points="1613,1539.7148,1613,1564.7148,1745,1564.7148,1745,1549.7148,1735,1539.7148,1613,1539.7148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1735" x2="1735" y1="1539.7148" y2="1549.7148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1745" x2="1735" y1="1549.7148" y2="1549.7148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1619" y="1557.2832">Validation failure!</text><polygon fill="#A80036" points="2942,1591.0254,2952,1595.0254,2942,1599.0254,2946,1595.0254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="2948" y1="1595.0254" y2="1595.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="1590.5938">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1637" y="1590.5938">Request to persist event information</text><polygon fill="#A80036" points="2965,1620.3359,2955,1624.3359,2965,1628.3359,2961,1624.3359" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3451,1620.3359,3461,1624.3359,3451,1628.3359,3455,1624.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2959" x2="3457" y1="1624.3359" y2="1624.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2971" y="1619.9043">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="2993" y="1619.9043">Persist event information</text><polygon fill="#A80036" points="1619,1649.6465,1609,1653.6465,1619,1657.6465,1615,1653.6465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1613" x2="2953" y1="1653.6465" y2="1653.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1625" y="1649.2148">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1647" y="1649.2148">return success</text><polygon fill="#FFFF00" filter="url(#flpy45m52ovba)" points="1613,1666.957,1613,2120.957,2013,2120.957,2013,1676.957,2003,1666.957,1613,1666.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2003" x2="2003" y1="1666.957" y2="1676.957"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2013" x2="2003" y1="1676.957" y2="1676.957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1619" y="1684.5254">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="1699.8359">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1635" y="1715.1465">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="1635" y="1730.457">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1635" y="1745.7676">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1635" y="1761.0781">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1635" y="1776.3887">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1651" y="1791.6992">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1651" y="1807.0098">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1667" y="1822.3203">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1683" y="1837.6309">"errorCode": &lt;error-codes&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="1683" y="1852.9414">"errorDescription": &lt;error-description&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="1683" y="1868.252">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1651" y="1883.5625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1635" y="1898.873">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1635" y="1914.1836">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1651" y="1929.4941">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1667" y="1944.8047">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1667" y="1960.1152">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1667" y="1975.4258">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1667" y="1990.7363">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1667" y="2006.0469">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="1667" y="2021.3574">status: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1683" y="2036.668">type: functional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1683" y="2051.9785">code: failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1667" y="2067.2891">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1651" y="2082.5996">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1635" y="2097.9102">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="2113.2207">}</text><polygon fill="#A80036" points="2713.5,2146.9629,2723.5,2150.9629,2713.5,2154.9629,2717.5,2150.9629" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="2719.5" y1="2150.9629" y2="2150.9629"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1610" y="2146.5313">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1632" y="2146.5313">Publishes Notification (failure) event for DFSP1</text><polygon fill="#A80036" points="543,2176.2734,533,2180.2734,543,2184.2734,539,2180.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="2724.5" y1="2180.2734" y2="2180.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2175.8418">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="2175.8418">Consumes Notifications event</text><polygon fill="#A80036" points="1046,2205.584,1056,2209.584,1046,2213.584,1050,2209.584" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="2209.584" y2="2209.584"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2205.1523">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="2205.1523">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="3160,2234.8945,3170,2238.8945,3160,2242.8945,3164,2238.8945" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1058" x2="3166" y1="2238.8945" y2="2238.8945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1065" y="2234.4629">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1087" y="2234.4629">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="3183,2264.2051,3173,2268.2051,3183,2272.2051,3179,2268.2051" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3451,2264.2051,3461,2268.2051,3451,2272.2051,3455,2268.2051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3177" x2="3457" y1="2268.2051" y2="2268.2051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3189" y="2263.7734">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="3211" y="2263.7734">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="1069,2293.5156,1059,2297.5156,1069,2301.5156,1065,2297.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3171" y1="2297.5156" y2="2297.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2293.084">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2293.084">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="543,2322.8262,533,2326.8262,543,2330.8262,539,2326.8262" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="2326.8262" y2="2326.8262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2322.3945">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="2322.3945">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,2352.1367,68.5,2356.1367,78.5,2360.1367,74.5,2356.1367" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="526" y1="2356.1367" y2="2356.1367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="2351.7051">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="2351.7051">HTTP Callback with Prepare result to DFSP1</text><!--
@startuml
' declate title
title 1.2 DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Validation Failure

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt Prepare Validation Failure
    activate MLAPI
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp1,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                {
                    "key": "string",
                    "value": "string"
                }
                ]
            }
        }
    end note
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <transferMessage.payerFsp>,
            to: <transferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    status: ?
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer (if it exists)
    TRANS_DAO <-> DB: return Transfer if it exists
    TRANS_DAO -> PREP_HANDLER: return Transfer if it exists
    PREP_HANDLER <-> PREP_HANDLER: Validates duplicate Check
    PREP_HANDLER <-> PREP_HANDLER: Validates crypto-condition
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature (to be confirmed in future requirement)
    note right of PREP_HANDLER #red: Validation failure!
    PREP_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> PREP_HANDLER: return success
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <ledgerName>,
            to: <transferMessage.payerFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: {
                    "errorInformation": {
                        "errorCode": <error-codes>,
                        "errorDescription": <error-description>,
                        "extensionList": <transferMessage.extensionList>
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createdAt: <timestamp>,
                    status: {
                        type: functional
                        code: failure
                    }
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notification (failure) event for DFSP1
    deactivate PREP_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI -> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_DAO <-> DB: Fetches Notifications details for DFSP1
    NOTIFY_DAO -> CSAPI: Returns Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    deactivate NOTIFY_HANDLER
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>