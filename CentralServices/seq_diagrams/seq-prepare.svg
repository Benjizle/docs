<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2480px" preserveAspectRatio="none" style="width:3150px;height:2480px;" version="1.1" viewBox="0 0 3150 2480" width="3150px" zoomAndPan="magnify"><defs><filter height="300%" id="fajgwi8daoqac" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="359" x="1396.25" y="23.5352">DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="621.5" y="302.5293"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="224.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="621.5" y="1291.1113"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="621.5" y="1837.0352"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="306.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1240.5" y="488.082"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="257.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1240.5" y="2022.5879"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2348" y="970.0508"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2348" y="1515.9746"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="104.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2348" y="2280.0723"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="175.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2529.5" y="126.9766"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2529.5" y="1116.6035"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2529.5" y="1662.5273"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="2242.3379" style="stroke: #000000; stroke-width: 2.0;" width="3125.5" x="13" y="133.9766"/><rect fill="#FFFFFF" height="545.9238" style="stroke: none; stroke-width: 1.0;" width="3125.5" x="13" y="1124.9141"/><rect fill="#FFFFFF" height="705.4766" style="stroke: none; stroke-width: 1.0;" width="3125.5" x="13" y="1670.8379"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="47" x2="47" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="106" x2="106" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="255" x2="255" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="626.5" x2="626.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="933" x2="933" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1245.5" x2="1245.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1664" x2="1664" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1849" x2="1849" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2122.5" x2="2122.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2352.5" x2="2352.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2534.5" x2="2534.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2647.5" x2="2647.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2744.5" x2="2744.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2842.5" x2="2842.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2962.5" x2="2962.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3080.5" x2="3080.5" y1="116.9766" y2="2393.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="23" y="114.0234">DFSP1</text><ellipse cx="47.5" cy="43.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M47.5,51.4883 L47.5,78.4883 M34.5,59.4883 L60.5,59.4883 M47.5,78.4883 L34.5,93.4883 M47.5,78.4883 L60.5,93.4883 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="23" y="2405.8496">DFSP1</text><ellipse cx="47.5" cy="2418.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M47.5,2426.8027 L47.5,2453.8027 M34.5,2434.8027 L60.5,2434.8027 M47.5,2453.8027 L34.5,2468.8027 M47.5,2453.8027 L60.5,2468.8027 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="82" y="114.0234">DFSP2</text><ellipse cx="106.5" cy="43.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M106.5,51.4883 L106.5,78.4883 M93.5,59.4883 L119.5,59.4883 M106.5,78.4883 L93.5,93.4883 M106.5,78.4883 L119.5,93.4883 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="82" y="2405.8496">DFSP2</text><ellipse cx="106.5" cy="2418.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M106.5,2426.8027 L106.5,2453.8027 M93.5,2434.8027 L119.5,2434.8027 M106.5,2453.8027 L93.5,2468.8027 M106.5,2453.8027 L119.5,2468.8027 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="145" y="77.4883"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="141" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="148" y="102.0234">Prepare-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="145" y="2392.3145"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="141" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="148" y="2416.8496">Prepare-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="547.5" y="114.0234">Prepare Event Handler</text><ellipse cx="626.5" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="622.5,72.4883,628.5,67.4883,626.5,72.4883,628.5,77.4883,622.5,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="547.5" y="2405.8496">Prepare Event Handler</text><ellipse cx="626.5" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="622.5,2412.8027,628.5,2407.8027,626.5,2412.8027,628.5,2417.8027,622.5,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="822" y="77.4883"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="818" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="825" y="102.0234">Position-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="822" y="2392.3145"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="818" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="825" y="2416.8496">Position-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1165.5" y="114.0234">Position Event Handler</text><ellipse cx="1245.5" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1241.5,72.4883,1247.5,67.4883,1245.5,72.4883,1247.5,77.4883,1241.5,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1165.5" y="2405.8496">Position Event Handler</text><ellipse cx="1245.5" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1241.5,2412.8027,1247.5,2407.8027,1245.5,2412.8027,1247.5,2417.8027,1241.5,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1575" y="77.4883"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1571" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="1578" y="102.0234">Transfer-Topic-handler</text><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1575" y="2392.3145"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1571" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="1578" y="2416.8496">Transfer-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1768" y="114.0234">Transfer Event Handler</text><ellipse cx="1849.5" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1845.5,72.4883,1851.5,67.4883,1849.5,72.4883,1851.5,77.4883,1845.5,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1768" y="2405.8496">Transfer Event Handler</text><ellipse cx="1849.5" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1845.5,2412.8027,1851.5,2407.8027,1849.5,2412.8027,1851.5,2417.8027,1845.5,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2022.5" y="77.4883"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2018.5" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="2025.5" y="102.0234">Notification-Topic-handler</text><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2022.5" y="2392.3145"/><rect fill="#FEFECE" filter="url(#fajgwi8daoqac)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2018.5" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="2025.5" y="2416.8496">Notification-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="2236.5" y="114.0234">ML API Notification Event Handler</text><ellipse cx="2353" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2349,72.4883,2355,67.4883,2353,72.4883,2355,77.4883,2349,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="2236.5" y="2405.8496">ML API Notification Event Handler</text><ellipse cx="2353" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2349,2412.8027,2355,2407.8027,2353,2412.8027,2355,2417.8027,2349,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2479.5" y="114.0234">ML API Adapter</text><path d="M2514,72.4883 L2514,96.4883 M2514,84.4883 L2531,84.4883 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="2543" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2479.5" y="2405.8496">ML API Adapter</text><path d="M2514,2412.8027 L2514,2436.8027 M2514,2424.8027 L2531,2424.8027 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="2543" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2599.5" y="114.0234">Position DAO</text><ellipse cx="2647.5" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2635.5" x2="2659.5" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2599.5" y="2405.8496">Position DAO</text><ellipse cx="2647.5" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2635.5" x2="2659.5" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2705.5" y="114.0234">Event DAO</text><ellipse cx="2744.5" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2732.5" x2="2756.5" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2705.5" y="2405.8496">Event DAO</text><ellipse cx="2744.5" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2732.5" x2="2756.5" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="2793.5" y="114.0234">Transfer DAO</text><ellipse cx="2843" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2831" x2="2855" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="2793.5" y="2405.8496">Transfer DAO</text><ellipse cx="2843" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2831" x2="2855" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="2902.5" y="114.0234">Notification DAO</text><ellipse cx="2962.5" cy="84.4883" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2950.5" x2="2974.5" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="2902.5" y="2405.8496">Notification DAO</text><ellipse cx="2962.5" cy="2424.8027" fill="#FEFECE" filter="url(#fajgwi8daoqac)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2950.5" x2="2974.5" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3032.5" y="114.0234">Central Store</text><path d="M3062.5,64.4883 C3062.5,54.4883 3080.5,54.4883 3080.5,54.4883 C3080.5,54.4883 3098.5,54.4883 3098.5,64.4883 L3098.5,90.4883 C3098.5,100.4883 3080.5,100.4883 3080.5,100.4883 C3080.5,100.4883 3062.5,100.4883 3062.5,90.4883 L3062.5,64.4883 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3062.5,64.4883 C3062.5,74.4883 3080.5,74.4883 3080.5,74.4883 C3080.5,74.4883 3098.5,74.4883 3098.5,64.4883 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3032.5" y="2405.8496">Central Store</text><path d="M3062.5,2418.8027 C3062.5,2408.8027 3080.5,2408.8027 3080.5,2408.8027 C3080.5,2408.8027 3098.5,2408.8027 3098.5,2418.8027 L3098.5,2444.8027 C3098.5,2454.8027 3080.5,2454.8027 3080.5,2454.8027 C3080.5,2454.8027 3062.5,2454.8027 3062.5,2444.8027 L3062.5,2418.8027 " fill="#FEFECE" filter="url(#fajgwi8daoqac)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3062.5,2418.8027 C3062.5,2428.8027 3080.5,2428.8027 3080.5,2428.8027 C3080.5,2428.8027 3098.5,2428.8027 3098.5,2418.8027 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="621.5" y="302.5293"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="224.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="621.5" y="1291.1113"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="621.5" y="1837.0352"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="306.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1240.5" y="488.082"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="257.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1240.5" y="2022.5879"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2348" y="970.0508"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2348" y="1515.9746"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="104.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2348" y="2280.0723"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="175.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2529.5" y="126.9766"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2529.5" y="1116.6035"/><rect fill="#FFFFFF" filter="url(#fajgwi8daoqac)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2529.5" y="1662.5273"/><rect fill="none" height="2242.3379" style="stroke: #000000; stroke-width: 2.0;" width="3125.5" x="13" y="133.9766"/><polygon fill="#EEEEEE" points="13,133.9766,75,133.9766,75,140.9766,65,150.9766,13,150.9766,13,133.9766" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="28" y="147.5449">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="90" y="146.6113">[DFSP1 sends a Prepare Transfer request to DFSP2]</text><polygon fill="#A80036" points="2517.5,168.2871,2527.5,172.2871,2517.5,176.2871,2521.5,172.2871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="2523.5" y1="172.2871" y2="172.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="54.5" y="167.8555">POST - http://transfers</text><polygon fill="#A80036" points="266.5,197.5977,256.5,201.5977,266.5,205.5977,262.5,201.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="2528.5" y1="201.5977" y2="201.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="272.5" y="197.166">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="297.5" y1="231.2188" y2="231.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="297.5" x2="297.5" y1="231.2188" y2="244.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="256.5" x2="297.5" y1="244.2188" y2="244.2188"/><polygon fill="#A80036" points="266.5,240.2188,256.5,244.2188,266.5,248.2188,262.5,244.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="262.5" y="226.4766">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="2517.5,269.2188,2527.5,273.2188,2517.5,277.2188,2521.5,273.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="2523.5" y1="273.2188" y2="273.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="262.5" y="268.7871">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="58.5,298.5293,48.5,302.5293,58.5,306.5293,54.5,302.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2533.5" y1="302.5293" y2="302.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="64.5" y="298.0977">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="609.5,327.8398,619.5,331.8398,609.5,335.8398,613.5,331.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="615.5" y1="331.8398" y2="331.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="262.5" y="327.4082">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="361.4609" y2="361.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="361.4609" y2="374.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="374.4609" y2="374.4609"/><polygon fill="#A80036" points="642.5,370.4609,632.5,374.4609,642.5,378.4609,638.5,374.4609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="638.5" y="356.7188">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="403.7715" y2="403.7715"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="403.7715" y2="416.7715"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="416.7715" y2="416.7715"/><polygon fill="#A80036" points="642.5,412.7715,632.5,416.7715,642.5,420.7715,638.5,416.7715" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="638.5" y="399.0293">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="446.082" y2="446.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="446.082" y2="459.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="459.082" y2="459.082"/><polygon fill="#A80036" points="642.5,455.082,632.5,459.082,642.5,463.082,638.5,459.082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="638.5" y="441.3398">Validates message signature</text><polygon fill="#A80036" points="921.5,484.082,931.5,488.082,921.5,492.082,925.5,488.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="626.5" x2="927.5" y1="488.082" y2="488.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="633.5" y="483.6504">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="1228.5,513.3926,1238.5,517.3926,1228.5,521.3926,1232.5,517.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="933.5" x2="1234.5" y1="517.3926" y2="517.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="940.5" y="512.9609">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="2732.5,542.7031,2742.5,546.7031,2732.5,550.7031,2736.5,546.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.5" x2="2738.5" y1="546.7031" y2="546.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1257.5" y="542.2715">Request to persist event information</text><polygon fill="#A80036" points="2755.5,572.0137,2745.5,576.0137,2755.5,580.0137,2751.5,576.0137" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3068.5,572.0137,3078.5,576.0137,3068.5,580.0137,3072.5,576.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2749.5" x2="3074.5" y1="576.0137" y2="576.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="2761.5" y="571.582">Persist event information</text><polygon fill="#A80036" points="1261.5,601.3242,1251.5,605.3242,1261.5,609.3242,1257.5,605.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="2743.5" y1="605.3242" y2="605.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1267.5" y="600.8926">return success</text><polygon fill="#A80036" points="1261.5,630.6348,1251.5,634.6348,1261.5,638.6348,1257.5,634.6348" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3068.5,630.6348,3078.5,634.6348,3068.5,638.6348,3072.5,634.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="3074.5" y1="634.6348" y2="634.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1267.5" y="630.2031">Retrieves latest position from DB for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.5" x2="1292.5" y1="664.2559" y2="664.2559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1292.5" x2="1292.5" y1="664.2559" y2="677.2559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1251.5" x2="1292.5" y1="677.2559" y2="677.2559"/><polygon fill="#A80036" points="1261.5,673.2559,1251.5,677.2559,1261.5,681.2559,1257.5,677.2559" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="1257.5" y="659.5137">Calculates latest position by decrementing transfer for prepare</text><polygon fill="#A80036" points="2635.5,702.2559,2645.5,706.2559,2635.5,710.2559,2639.5,706.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.5" x2="2641.5" y1="706.2559" y2="706.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="1257.5" y="701.8242">Request to persist latest position for DFSP1</text><polygon fill="#A80036" points="2658.5,731.5664,2648.5,735.5664,2658.5,739.5664,2654.5,735.5664" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3068.5,731.5664,3078.5,735.5664,3068.5,739.5664,3072.5,735.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2652.5" x2="3074.5" y1="735.5664" y2="735.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="2664.5" y="731.1348">Persists latest position to DB for DFSP1</text><polygon fill="#A80036" points="1261.5,760.877,1251.5,764.877,1261.5,768.877,1257.5,764.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="2646.5" y1="764.877" y2="764.877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1267.5" y="760.4453">return success</text><polygon fill="#A80036" points="1652.5,790.1875,1662.5,794.1875,1652.5,798.1875,1656.5,794.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245.5" x2="1658.5" y1="794.1875" y2="794.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1252.5" y="789.7559">Publishes Transfer event</text><polygon fill="#A80036" points="1837.5,819.498,1847.5,823.498,1837.5,827.498,1841.5,823.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664.5" x2="1843.5" y1="823.498" y2="823.498"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1671.5" y="819.0664">Consumes Transfer event</text><polygon fill="#A80036" points="2831,848.8086,2841,852.8086,2831,856.8086,2835,852.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1849.5" x2="2837" y1="852.8086" y2="852.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="1856.5" y="848.377">Request to Transfer status to DB</text><polygon fill="#A80036" points="2854,878.1191,2844,882.1191,2854,886.1191,2850,882.1191" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3068.5,878.1191,3078.5,882.1191,3068.5,886.1191,3072.5,882.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2848" x2="3074.5" y1="882.1191" y2="882.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2860" y="877.6875">return success</text><polygon fill="#A80036" points="1860.5,907.4297,1850.5,911.4297,1860.5,915.4297,1856.5,911.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1854.5" x2="2842" y1="911.4297" y2="911.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="1866.5" y="906.998">Persists Transfer status to DB</text><polygon fill="#A80036" points="2110.5,936.7402,2120.5,940.7402,2110.5,944.7402,2114.5,940.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1849.5" x2="2116.5" y1="940.7402" y2="940.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="1856.5" y="936.3086">Publishes Notifications event for DFSP1</text><polygon fill="#A80036" points="2110.5,966.0508,2120.5,970.0508,2110.5,974.0508,2114.5,970.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1849.5" x2="2116.5" y1="970.0508" y2="970.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="1856.5" y="965.6191">Publishes Notifications event for DFSP2</text><polygon fill="#A80036" points="2336,995.3613,2346,999.3613,2336,1003.3613,2340,999.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2122.5" x2="2342" y1="999.3613" y2="999.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="2129.5" y="994.9297">Consumes Notifications event</text><polygon fill="#A80036" points="2369,1024.6719,2359,1028.6719,2369,1032.6719,2365,1028.6719" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2950.5,1024.6719,2960.5,1028.6719,2950.5,1032.6719,2954.5,1028.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2363" x2="2956.5" y1="1028.6719" y2="1028.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2375" y="1024.2402">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="58.5,1053.9824,48.5,1057.9824,58.5,1061.9824,54.5,1057.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2347" y1="1057.9824" y2="1057.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="64.5" y="1053.5508">HTTP Callback with Prepare result to DFSP1</text><polygon fill="#A80036" points="2369,1083.293,2359,1087.293,2369,1091.293,2365,1087.293" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2950.5,1083.293,2960.5,1087.293,2950.5,1091.293,2954.5,1087.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2363" x2="2956.5" y1="1087.293" y2="1087.293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2375" y="1082.8613">Fetches Notifications details for DFSP2</text><polygon fill="#A80036" points="117.5,1112.6035,107.5,1116.6035,117.5,1120.6035,113.5,1116.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111.5" x2="2352" y1="1116.6035" y2="1116.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="123.5" y="1112.1719">HTTP Callback with Prepare result to DFSP2</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="3138.5" y1="1125.9141" y2="1125.9141"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="18" y="1136.5488">[Prepare Validation Failure]</text><polygon fill="#A80036" points="2517.5,1156.8691,2527.5,1160.8691,2517.5,1164.8691,2521.5,1160.8691" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="2523.5" y1="1160.8691" y2="1160.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="54.5" y="1156.4375">POST - http://transfers</text><polygon fill="#A80036" points="266.5,1186.1797,256.5,1190.1797,266.5,1194.1797,262.5,1190.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="2528.5" y1="1190.1797" y2="1190.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="272.5" y="1185.748">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="297.5" y1="1219.8008" y2="1219.8008"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="297.5" x2="297.5" y1="1219.8008" y2="1232.8008"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="256.5" x2="297.5" y1="1232.8008" y2="1232.8008"/><polygon fill="#A80036" points="266.5,1228.8008,256.5,1232.8008,266.5,1236.8008,262.5,1232.8008" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="262.5" y="1215.0586">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="2517.5,1257.8008,2527.5,1261.8008,2517.5,1265.8008,2521.5,1261.8008" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="2523.5" y1="1261.8008" y2="1261.8008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="262.5" y="1257.3691">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="58.5,1287.1113,48.5,1291.1113,58.5,1295.1113,54.5,1291.1113" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2533.5" y1="1291.1113" y2="1291.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="64.5" y="1286.6797">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="609.5,1316.4219,619.5,1320.4219,609.5,1324.4219,613.5,1320.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="615.5" y1="1320.4219" y2="1320.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="262.5" y="1315.9902">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="1350.043" y2="1350.043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="1350.043" y2="1363.043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="1363.043" y2="1363.043"/><polygon fill="#A80036" points="642.5,1359.043,632.5,1363.043,642.5,1367.043,638.5,1363.043" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="638.5" y="1345.3008">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="1392.3535" y2="1392.3535"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="1392.3535" y2="1405.3535"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="1405.3535" y2="1405.3535"/><polygon fill="#A80036" points="642.5,1401.3535,632.5,1405.3535,642.5,1409.3535,638.5,1405.3535" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="638.5" y="1387.6113">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="1434.6641" y2="1434.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="1434.6641" y2="1447.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="1447.6641" y2="1447.6641"/><polygon fill="#A80036" points="642.5,1443.6641,632.5,1447.6641,642.5,1451.6641,638.5,1447.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="638.5" y="1429.9219">Validates message signature</text><polygon fill="#FF0000" filter="url(#fajgwi8daoqac)" points="636,1460.6641,636,1485.6641,768,1485.6641,768,1470.6641,758,1460.6641,636,1460.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="758" x2="758" y1="1460.6641" y2="1470.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768" x2="758" y1="1470.6641" y2="1470.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="642" y="1478.2324">Validation failure!</text><polygon fill="#A80036" points="2110.5,1511.9746,2120.5,1515.9746,2110.5,1519.9746,2114.5,1515.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="626.5" x2="2116.5" y1="1515.9746" y2="1515.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="633.5" y="1511.543">Publishes Notification (failure) event for DFSP1</text><polygon fill="#A80036" points="2336,1541.2852,2346,1545.2852,2336,1549.2852,2340,1545.2852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2122.5" x2="2342" y1="1545.2852" y2="1545.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="2129.5" y="1540.8535">Consumes Notifications event</text><polygon fill="#A80036" points="2369,1570.5957,2359,1574.5957,2369,1578.5957,2365,1574.5957" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2950.5,1570.5957,2960.5,1574.5957,2950.5,1578.5957,2954.5,1574.5957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2363" x2="2956.5" y1="1574.5957" y2="1574.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2375" y="1570.1641">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="58.5,1599.9063,48.5,1603.9063,58.5,1607.9063,54.5,1603.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2347" y1="1603.9063" y2="1603.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="64.5" y="1599.4746">HTTP Callback with Prepare result to DFSP1</text><polygon fill="#A80036" points="2369,1629.2168,2359,1633.2168,2369,1637.2168,2365,1633.2168" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2950.5,1629.2168,2960.5,1633.2168,2950.5,1637.2168,2954.5,1633.2168" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2363" x2="2956.5" y1="1633.2168" y2="1633.2168"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2375" y="1628.7852">Fetches Notifications details for DFSP2</text><polygon fill="#A80036" points="117.5,1658.5273,107.5,1662.5273,117.5,1666.5273,113.5,1662.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111.5" x2="2352" y1="1662.5273" y2="1662.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="123.5" y="1658.0957">HTTP Callback with Prepare result to DFSP2</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="3138.5" y1="1671.8379" y2="1671.8379"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="18" y="1682.4727">[Prepare Position Failure]</text><polygon fill="#A80036" points="2517.5,1702.793,2527.5,1706.793,2517.5,1710.793,2521.5,1706.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="2523.5" y1="1706.793" y2="1706.793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="54.5" y="1702.3613">POST - http://transfers</text><polygon fill="#A80036" points="266.5,1732.1035,256.5,1736.1035,266.5,1740.1035,262.5,1736.1035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260.5" x2="2528.5" y1="1736.1035" y2="1736.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="272.5" y="1731.6719">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="297.5" y1="1765.7246" y2="1765.7246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="297.5" x2="297.5" y1="1765.7246" y2="1778.7246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="256.5" x2="297.5" y1="1778.7246" y2="1778.7246"/><polygon fill="#A80036" points="266.5,1774.7246,256.5,1778.7246,266.5,1782.7246,262.5,1778.7246" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="262.5" y="1760.9824">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="2517.5,1803.7246,2527.5,1807.7246,2517.5,1811.7246,2521.5,1807.7246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="2523.5" y1="1807.7246" y2="1807.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="262.5" y="1803.293">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="58.5,1833.0352,48.5,1837.0352,58.5,1841.0352,54.5,1837.0352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2533.5" y1="1837.0352" y2="1837.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="64.5" y="1832.6035">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="609.5,1862.3457,619.5,1866.3457,609.5,1870.3457,613.5,1866.3457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="255.5" x2="615.5" y1="1866.3457" y2="1866.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="262.5" y="1861.9141">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="1895.9668" y2="1895.9668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="1895.9668" y2="1908.9668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="1908.9668" y2="1908.9668"/><polygon fill="#A80036" points="642.5,1904.9668,632.5,1908.9668,642.5,1912.9668,638.5,1908.9668" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="638.5" y="1891.2246">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="1938.2773" y2="1938.2773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="1938.2773" y2="1951.2773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="1951.2773" y2="1951.2773"/><polygon fill="#A80036" points="642.5,1947.2773,632.5,1951.2773,642.5,1955.2773,638.5,1951.2773" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="638.5" y="1933.5352">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="673.5" y1="1980.5879" y2="1980.5879"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="673.5" x2="673.5" y1="1980.5879" y2="1993.5879"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="632.5" x2="673.5" y1="1993.5879" y2="1993.5879"/><polygon fill="#A80036" points="642.5,1989.5879,632.5,1993.5879,642.5,1997.5879,638.5,1993.5879" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="638.5" y="1975.8457">Validates message signature</text><polygon fill="#A80036" points="921.5,2018.5879,931.5,2022.5879,921.5,2026.5879,925.5,2022.5879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="626.5" x2="927.5" y1="2022.5879" y2="2022.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="633.5" y="2018.1563">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="1228.5,2047.8984,1238.5,2051.8984,1228.5,2055.8984,1232.5,2051.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="933.5" x2="1234.5" y1="2051.8984" y2="2051.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="940.5" y="2047.4668">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="2732.5,2077.209,2742.5,2081.209,2732.5,2085.209,2736.5,2081.209" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.5" x2="2738.5" y1="2081.209" y2="2081.209"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1257.5" y="2076.7773">Request to persist event information</text><polygon fill="#A80036" points="2755.5,2106.5195,2745.5,2110.5195,2755.5,2114.5195,2751.5,2110.5195" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3068.5,2106.5195,3078.5,2110.5195,3068.5,2114.5195,3072.5,2110.5195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2749.5" x2="3074.5" y1="2110.5195" y2="2110.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="2761.5" y="2106.0879">Persist event information</text><polygon fill="#A80036" points="1261.5,2135.8301,1251.5,2139.8301,1261.5,2143.8301,1257.5,2139.8301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="2743.5" y1="2139.8301" y2="2139.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1267.5" y="2135.3984">return success</text><polygon fill="#A80036" points="1261.5,2165.1406,1251.5,2169.1406,1261.5,2173.1406,1257.5,2169.1406" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3068.5,2165.1406,3078.5,2169.1406,3068.5,2173.1406,3072.5,2169.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255.5" x2="3074.5" y1="2169.1406" y2="2169.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1267.5" y="2164.709">Retrieves latest position from DB for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.5" x2="1292.5" y1="2198.7617" y2="2198.7617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1292.5" x2="1292.5" y1="2198.7617" y2="2211.7617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1251.5" x2="1292.5" y1="2211.7617" y2="2211.7617"/><polygon fill="#A80036" points="1261.5,2207.7617,1251.5,2211.7617,1261.5,2215.7617,1257.5,2211.7617" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="1257.5" y="2194.0195">Calculates latest position by decrementing transfer for prepare</text><polygon fill="#FF0000" filter="url(#fajgwi8daoqac)" points="1255,2224.7617,1255,2249.7617,1387,2249.7617,1387,2234.7617,1377,2224.7617,1255,2224.7617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1377" x2="1377" y1="2224.7617" y2="2234.7617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1387" x2="1377" y1="2234.7617" y2="2234.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1261" y="2242.3301">Validation failure!</text><polygon fill="#A80036" points="2110.5,2276.0723,2120.5,2280.0723,2110.5,2284.0723,2114.5,2280.0723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245.5" x2="2116.5" y1="2280.0723" y2="2280.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="1252.5" y="2275.6406">Publishes Notifications (Failure) event for DFSP2</text><polygon fill="#A80036" points="2336,2305.3828,2346,2309.3828,2336,2313.3828,2340,2309.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2122.5" x2="2342" y1="2309.3828" y2="2309.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="2129.5" y="2304.9512">Consumes Notifications event</text><polygon fill="#A80036" points="2369,2334.6934,2359,2338.6934,2369,2342.6934,2365,2338.6934" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2950.5,2334.6934,2960.5,2338.6934,2950.5,2342.6934,2954.5,2338.6934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2363" x2="2956.5" y1="2338.6934" y2="2338.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2375" y="2334.2617">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="58.5,2364.0039,48.5,2368.0039,58.5,2372.0039,54.5,2368.0039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2347" y1="2368.0039" y2="2368.0039"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="64.5" y="2363.5723">HTTP Callback with Prepare result to DFSP1</text><!--
@startuml
' declate title
title DFSP1 sends a Prepare Transfer request to DFSP2

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as API
collections "Prepare-Topic-handler-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-handler-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic-handler" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic-handler" as TOPIC_NOTIFICATIONS
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "ML API Adapter" as API
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

' start flow
alt DFSP1 sends a Prepare Transfer request to DFSP2
    activate API
    DFSP1 -> API: POST - http://transfers
    API -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> API: Responds replication acknoledgements have been received
    API -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate API
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    POS_HANDLER <-> DB: Retrieves latest position from DB for DFSP1
    POS_HANDLER <-> POS_HANDLER: Calculates latest position by decrementing transfer for prepare
    POS_HANDLER -> POS_DAO: Request to persist latest position for DFSP1
    POS_DAO <-> DB: Persists latest position to DB for DFSP1
    POS_DAO -> POS_HANDLER: return success
    POS_HANDLER -> TOPIC_TRANSFERS: Publishes Transfer event
    deactivate POS_HANDLER
    deactivate TRANS_HANDLER
    TOPIC_TRANSFERS -> TRANS_HANDLER: Consumes Transfer event
    TRANS_HANDLER -> TRANS_DAO: Request to Transfer status to DB
    TRANS_DAO <-> DB: return success
    TRANS_DAO -> TRANS_HANDLER: Persists Transfer status to DB
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP1
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP2
    deactivate TRANS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP2
    NOTIFY_HANDLER -> DFSP2: HTTP Callback with Prepare result to DFSP2
    deactivate NOTIFY_HANDLER
else Prepare Validation Failure
    activate API
    DFSP1 -> API: POST - http://transfers
    API -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> API: Responds replication acknoledgements have been received
    API -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate API
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    note right of PREP_HANDLER #red: Validation failure!
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notification (failure) event for DFSP1
    deactivate PREP_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP2
    NOTIFY_HANDLER -> DFSP2: HTTP Callback with Prepare result to DFSP2
    deactivate NOTIFY_HANDLER
else Prepare Position Failure
    activate API
    DFSP1 -> API: POST - http://transfers
    API -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> API: Responds replication acknoledgements have been received
    API -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate API
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    POS_HANDLER <-> DB: Retrieves latest position from DB for DFSP1
    POS_HANDLER <-> POS_HANDLER: Calculates latest position by decrementing transfer for prepare
    note right of POS_HANDLER #red: Validation failure!
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications (Failure) event for DFSP2
    deactivate POS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>