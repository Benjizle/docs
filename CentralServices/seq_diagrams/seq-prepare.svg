<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2480px" preserveAspectRatio="none" style="width:3451px;height:2480px;" version="1.1" viewBox="0 0 3451 2480" width="3451px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jhbefr75fu9a" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="359" x="1546.75" y="23.5352">DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="175.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="272.5" y="126.9766"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="272.5" y="1116.6035"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="272.5" y="1662.5273"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1042.5" y="302.5293"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="224.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1042.5" y="1291.1113"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1042.5" y="1837.0352"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="306.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1661.5" y="488.082"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="257.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1661.5" y="2022.5879"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2769" y="970.0508"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2769" y="1515.9746"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="104.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2769" y="2280.0723"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="2242.3379" style="stroke: #000000; stroke-width: 2.0;" width="3426.5" x="13" y="133.9766"/><rect fill="#FFFFFF" height="545.9238" style="stroke: none; stroke-width: 1.0;" width="3426.5" x="13" y="1124.9141"/><rect fill="#FFFFFF" height="705.4766" style="stroke: none; stroke-width: 1.0;" width="3426.5" x="13" y="1670.8379"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="47" x2="47" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="106" x2="106" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="277.5" x2="277.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="676" x2="676" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1047.5" x2="1047.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1354" x2="1354" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1666.5" x2="1666.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2085" x2="2085" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2270" x2="2270" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2543.5" x2="2543.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2773.5" x2="2773.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2948.5" x2="2948.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3045.5" x2="3045.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3143.5" x2="3143.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3263.5" x2="3263.5" y1="116.9766" y2="2393.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3381.5" x2="3381.5" y1="116.9766" y2="2393.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="23" y="114.0234">DFSP1</text><ellipse cx="47.5" cy="43.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M47.5,51.4883 L47.5,78.4883 M34.5,59.4883 L60.5,59.4883 M47.5,78.4883 L34.5,93.4883 M47.5,78.4883 L60.5,93.4883 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="23" y="2405.8496">DFSP1</text><ellipse cx="47.5" cy="2418.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M47.5,2426.8027 L47.5,2453.8027 M34.5,2434.8027 L60.5,2434.8027 M47.5,2453.8027 L34.5,2468.8027 M47.5,2453.8027 L60.5,2468.8027 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="82" y="114.0234">DFSP2</text><ellipse cx="106.5" cy="43.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M106.5,51.4883 L106.5,78.4883 M93.5,59.4883 L119.5,59.4883 M106.5,78.4883 L93.5,93.4883 M106.5,78.4883 L119.5,93.4883 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="82" y="2405.8496">DFSP2</text><ellipse cx="106.5" cy="2418.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M106.5,2426.8027 L106.5,2453.8027 M93.5,2434.8027 L119.5,2434.8027 M106.5,2453.8027 L93.5,2468.8027 M106.5,2453.8027 L119.5,2468.8027 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="222.5" y="114.0234">ML API Adapter</text><path d="M257,72.4883 L257,96.4883 M257,84.4883 L274,84.4883 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="286" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="222.5" y="2405.8496">ML API Adapter</text><path d="M257,2412.8027 L257,2436.8027 M257,2424.8027 L274,2424.8027 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="286" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="566" y="77.4883"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="562" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="569" y="102.0234">Prepare-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="566" y="2392.3145"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="562" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="569" y="2416.8496">Prepare-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="968.5" y="114.0234">Prepare Event Handler</text><ellipse cx="1047.5" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1043.5,72.4883,1049.5,67.4883,1047.5,72.4883,1049.5,77.4883,1043.5,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="968.5" y="2405.8496">Prepare Event Handler</text><ellipse cx="1047.5" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1043.5,2412.8027,1049.5,2407.8027,1047.5,2412.8027,1049.5,2417.8027,1043.5,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1243" y="77.4883"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1239" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="1246" y="102.0234">Position-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1243" y="2392.3145"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1239" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="1246" y="2416.8496">Position-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1586.5" y="114.0234">Position Event Handler</text><ellipse cx="1666.5" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1662.5,72.4883,1668.5,67.4883,1666.5,72.4883,1668.5,77.4883,1662.5,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1586.5" y="2405.8496">Position Event Handler</text><ellipse cx="1666.5" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1662.5,2412.8027,1668.5,2407.8027,1666.5,2412.8027,1668.5,2417.8027,1662.5,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1996" y="77.4883"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1992" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="1999" y="102.0234">Transfer-Topic-handler</text><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1996" y="2392.3145"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="1992" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="1999" y="2416.8496">Transfer-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2189" y="114.0234">Transfer Event Handler</text><ellipse cx="2270.5" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2266.5,72.4883,2272.5,67.4883,2270.5,72.4883,2272.5,77.4883,2266.5,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2189" y="2405.8496">Transfer Event Handler</text><ellipse cx="2270.5" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2266.5,2412.8027,2272.5,2407.8027,2270.5,2412.8027,2272.5,2417.8027,2266.5,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2443.5" y="77.4883"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2439.5" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="2446.5" y="102.0234">Notification-Topic-handler</text><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2443.5" y="2392.3145"/><rect fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="2439.5" y="2396.3145"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="2446.5" y="2416.8496">Notification-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="2657.5" y="114.0234">ML API Notification Event Handler</text><ellipse cx="2774" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2770,72.4883,2776,67.4883,2774,72.4883,2776,77.4883,2770,72.4883" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="2657.5" y="2405.8496">ML API Notification Event Handler</text><ellipse cx="2774" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2770,2412.8027,2776,2407.8027,2774,2412.8027,2776,2417.8027,2770,2412.8027" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2900.5" y="114.0234">Position DAO</text><ellipse cx="2948.5" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2936.5" x2="2960.5" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2900.5" y="2405.8496">Position DAO</text><ellipse cx="2948.5" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2936.5" x2="2960.5" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3006.5" y="114.0234">Event DAO</text><ellipse cx="3045.5" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3033.5" x2="3057.5" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3006.5" y="2405.8496">Event DAO</text><ellipse cx="3045.5" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3033.5" x2="3057.5" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3094.5" y="114.0234">Transfer DAO</text><ellipse cx="3144" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3132" x2="3156" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3094.5" y="2405.8496">Transfer DAO</text><ellipse cx="3144" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3132" x2="3156" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3203.5" y="114.0234">Notification DAO</text><ellipse cx="3263.5" cy="84.4883" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3251.5" x2="3275.5" y1="98.4883" y2="98.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3203.5" y="2405.8496">Notification DAO</text><ellipse cx="3263.5" cy="2424.8027" fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3251.5" x2="3275.5" y1="2438.8027" y2="2438.8027"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3333.5" y="114.0234">Central Store</text><path d="M3363.5,64.4883 C3363.5,54.4883 3381.5,54.4883 3381.5,54.4883 C3381.5,54.4883 3399.5,54.4883 3399.5,64.4883 L3399.5,90.4883 C3399.5,100.4883 3381.5,100.4883 3381.5,100.4883 C3381.5,100.4883 3363.5,100.4883 3363.5,90.4883 L3363.5,64.4883 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3363.5,64.4883 C3363.5,74.4883 3381.5,74.4883 3381.5,74.4883 C3381.5,74.4883 3399.5,74.4883 3399.5,64.4883 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3333.5" y="2405.8496">Central Store</text><path d="M3363.5,2418.8027 C3363.5,2408.8027 3381.5,2408.8027 3381.5,2408.8027 C3381.5,2408.8027 3399.5,2408.8027 3399.5,2418.8027 L3399.5,2444.8027 C3399.5,2454.8027 3381.5,2454.8027 3381.5,2454.8027 C3381.5,2454.8027 3363.5,2454.8027 3363.5,2444.8027 L3363.5,2418.8027 " fill="#FEFECE" filter="url(#f1jhbefr75fu9a)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3363.5,2418.8027 C3363.5,2428.8027 3381.5,2428.8027 3381.5,2428.8027 C3381.5,2428.8027 3399.5,2428.8027 3399.5,2418.8027 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="175.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="272.5" y="126.9766"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="272.5" y="1116.6035"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="174.5078" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="272.5" y="1662.5273"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1042.5" y="302.5293"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="224.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1042.5" y="1291.1113"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="185.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1042.5" y="1837.0352"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="306.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1661.5" y="488.082"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="257.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1661.5" y="2022.5879"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2769" y="970.0508"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2769" y="1515.9746"/><rect fill="#FFFFFF" filter="url(#f1jhbefr75fu9a)" height="104.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2769" y="2280.0723"/><rect fill="none" height="2242.3379" style="stroke: #000000; stroke-width: 2.0;" width="3426.5" x="13" y="133.9766"/><polygon fill="#EEEEEE" points="13,133.9766,75,133.9766,75,140.9766,65,150.9766,13,150.9766,13,133.9766" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="28" y="147.5449">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="90" y="146.6113">[DFSP1 sends a Prepare Transfer request to DFSP2]</text><polygon fill="#A80036" points="260.5,168.2871,270.5,172.2871,260.5,176.2871,264.5,172.2871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="266.5" y1="172.2871" y2="172.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="54.5" y="167.8555">POST - http://transfers</text><polygon fill="#A80036" points="664.5,197.5977,674.5,201.5977,664.5,205.5977,668.5,201.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282.5" x2="670.5" y1="201.5977" y2="201.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="289.5" y="197.166">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="676.5" x2="718.5" y1="231.2188" y2="231.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="718.5" x2="718.5" y1="231.2188" y2="244.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="677.5" x2="718.5" y1="244.2188" y2="244.2188"/><polygon fill="#A80036" points="687.5,240.2188,677.5,244.2188,687.5,248.2188,683.5,244.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="683.5" y="226.4766">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="293.5,269.2188,283.5,273.2188,293.5,277.2188,289.5,273.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287.5" x2="675.5" y1="273.2188" y2="273.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="299.5" y="268.7871">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="58.5,298.5293,48.5,302.5293,58.5,306.5293,54.5,302.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="276.5" y1="302.5293" y2="302.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="64.5" y="298.0977">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1030.5,327.8398,1040.5,331.8398,1030.5,335.8398,1034.5,331.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="676.5" x2="1036.5" y1="331.8398" y2="331.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="683.5" y="327.4082">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="361.4609" y2="361.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="361.4609" y2="374.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="374.4609" y2="374.4609"/><polygon fill="#A80036" points="1063.5,370.4609,1053.5,374.4609,1063.5,378.4609,1059.5,374.4609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1059.5" y="356.7188">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="403.7715" y2="403.7715"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="403.7715" y2="416.7715"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="416.7715" y2="416.7715"/><polygon fill="#A80036" points="1063.5,412.7715,1053.5,416.7715,1063.5,420.7715,1059.5,416.7715" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1059.5" y="399.0293">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="446.082" y2="446.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="446.082" y2="459.082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="459.082" y2="459.082"/><polygon fill="#A80036" points="1063.5,455.082,1053.5,459.082,1063.5,463.082,1059.5,459.082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1059.5" y="441.3398">Validates message signature</text><polygon fill="#A80036" points="1342.5,484.082,1352.5,488.082,1342.5,492.082,1346.5,488.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1047.5" x2="1348.5" y1="488.082" y2="488.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1054.5" y="483.6504">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="1649.5,513.3926,1659.5,517.3926,1649.5,521.3926,1653.5,517.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354.5" x2="1655.5" y1="517.3926" y2="517.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1361.5" y="512.9609">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="3033.5,542.7031,3043.5,546.7031,3033.5,550.7031,3037.5,546.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1671.5" x2="3039.5" y1="546.7031" y2="546.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1678.5" y="542.2715">Request to persist event information</text><polygon fill="#A80036" points="3056.5,572.0137,3046.5,576.0137,3056.5,580.0137,3052.5,576.0137" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3369.5,572.0137,3379.5,576.0137,3369.5,580.0137,3373.5,576.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3050.5" x2="3375.5" y1="576.0137" y2="576.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3062.5" y="571.582">Persist event information</text><polygon fill="#A80036" points="1682.5,601.3242,1672.5,605.3242,1682.5,609.3242,1678.5,605.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1676.5" x2="3044.5" y1="605.3242" y2="605.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1688.5" y="600.8926">return success</text><polygon fill="#A80036" points="1682.5,630.6348,1672.5,634.6348,1682.5,638.6348,1678.5,634.6348" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3369.5,630.6348,3379.5,634.6348,3369.5,638.6348,3373.5,634.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1676.5" x2="3375.5" y1="634.6348" y2="634.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1688.5" y="630.2031">Retrieves latest position from DB for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1671.5" x2="1713.5" y1="664.2559" y2="664.2559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1713.5" x2="1713.5" y1="664.2559" y2="677.2559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1672.5" x2="1713.5" y1="677.2559" y2="677.2559"/><polygon fill="#A80036" points="1682.5,673.2559,1672.5,677.2559,1682.5,681.2559,1678.5,677.2559" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="1678.5" y="659.5137">Calculates latest position by decrementing transfer for prepare</text><polygon fill="#A80036" points="2936.5,702.2559,2946.5,706.2559,2936.5,710.2559,2940.5,706.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1671.5" x2="2942.5" y1="706.2559" y2="706.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="1678.5" y="701.8242">Request to persist latest position for DFSP1</text><polygon fill="#A80036" points="2959.5,731.5664,2949.5,735.5664,2959.5,739.5664,2955.5,735.5664" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3369.5,731.5664,3379.5,735.5664,3369.5,739.5664,3373.5,735.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2953.5" x2="3375.5" y1="735.5664" y2="735.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="2965.5" y="731.1348">Persists latest position to DB for DFSP1</text><polygon fill="#A80036" points="1682.5,760.877,1672.5,764.877,1682.5,768.877,1678.5,764.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1676.5" x2="2947.5" y1="764.877" y2="764.877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1688.5" y="760.4453">return success</text><polygon fill="#A80036" points="2073.5,790.1875,2083.5,794.1875,2073.5,798.1875,2077.5,794.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1666.5" x2="2079.5" y1="794.1875" y2="794.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1673.5" y="789.7559">Publishes Transfer event</text><polygon fill="#A80036" points="2258.5,819.498,2268.5,823.498,2258.5,827.498,2262.5,823.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2085.5" x2="2264.5" y1="823.498" y2="823.498"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="2092.5" y="819.0664">Consumes Transfer event</text><polygon fill="#A80036" points="3132,848.8086,3142,852.8086,3132,856.8086,3136,852.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2270.5" x2="3138" y1="852.8086" y2="852.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="2277.5" y="848.377">Request to Transfer status to DB</text><polygon fill="#A80036" points="3155,878.1191,3145,882.1191,3155,886.1191,3151,882.1191" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3369.5,878.1191,3379.5,882.1191,3369.5,886.1191,3373.5,882.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3149" x2="3375.5" y1="882.1191" y2="882.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="3161" y="877.6875">return success</text><polygon fill="#A80036" points="2281.5,907.4297,2271.5,911.4297,2281.5,915.4297,2277.5,911.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2275.5" x2="3143" y1="911.4297" y2="911.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="2287.5" y="906.998">Persists Transfer status to DB</text><polygon fill="#A80036" points="2531.5,936.7402,2541.5,940.7402,2531.5,944.7402,2535.5,940.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2270.5" x2="2537.5" y1="940.7402" y2="940.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="2277.5" y="936.3086">Publishes Notifications event for DFSP1</text><polygon fill="#A80036" points="2531.5,966.0508,2541.5,970.0508,2531.5,974.0508,2535.5,970.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2270.5" x2="2537.5" y1="970.0508" y2="970.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="2277.5" y="965.6191">Publishes Notifications event for DFSP2</text><polygon fill="#A80036" points="2757,995.3613,2767,999.3613,2757,1003.3613,2761,999.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2543.5" x2="2763" y1="999.3613" y2="999.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="2550.5" y="994.9297">Consumes Notifications event</text><polygon fill="#A80036" points="2790,1024.6719,2780,1028.6719,2790,1032.6719,2786,1028.6719" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3251.5,1024.6719,3261.5,1028.6719,3251.5,1032.6719,3255.5,1028.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2784" x2="3257.5" y1="1028.6719" y2="1028.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2796" y="1024.2402">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="58.5,1053.9824,48.5,1057.9824,58.5,1061.9824,54.5,1057.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2768" y1="1057.9824" y2="1057.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="64.5" y="1053.5508">HTTP Callback with Prepare result to DFSP1</text><polygon fill="#A80036" points="2790,1083.293,2780,1087.293,2790,1091.293,2786,1087.293" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3251.5,1083.293,3261.5,1087.293,3251.5,1091.293,3255.5,1087.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2784" x2="3257.5" y1="1087.293" y2="1087.293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2796" y="1082.8613">Fetches Notifications details for DFSP2</text><polygon fill="#A80036" points="117.5,1112.6035,107.5,1116.6035,117.5,1120.6035,113.5,1116.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111.5" x2="2773" y1="1116.6035" y2="1116.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="123.5" y="1112.1719">HTTP Callback with Prepare result to DFSP2</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="3439.5" y1="1125.9141" y2="1125.9141"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="153" x="18" y="1136.5488">[Prepare Validation Failure]</text><polygon fill="#A80036" points="260.5,1156.8691,270.5,1160.8691,260.5,1164.8691,264.5,1160.8691" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="266.5" y1="1160.8691" y2="1160.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="54.5" y="1156.4375">POST - http://transfers</text><polygon fill="#A80036" points="664.5,1186.1797,674.5,1190.1797,664.5,1194.1797,668.5,1190.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282.5" x2="670.5" y1="1190.1797" y2="1190.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="289.5" y="1185.748">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="676.5" x2="718.5" y1="1219.8008" y2="1219.8008"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="718.5" x2="718.5" y1="1219.8008" y2="1232.8008"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="677.5" x2="718.5" y1="1232.8008" y2="1232.8008"/><polygon fill="#A80036" points="687.5,1228.8008,677.5,1232.8008,687.5,1236.8008,683.5,1232.8008" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="683.5" y="1215.0586">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="293.5,1257.8008,283.5,1261.8008,293.5,1265.8008,289.5,1261.8008" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287.5" x2="675.5" y1="1261.8008" y2="1261.8008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="299.5" y="1257.3691">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="58.5,1287.1113,48.5,1291.1113,58.5,1295.1113,54.5,1291.1113" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="276.5" y1="1291.1113" y2="1291.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="64.5" y="1286.6797">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1030.5,1316.4219,1040.5,1320.4219,1030.5,1324.4219,1034.5,1320.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="676.5" x2="1036.5" y1="1320.4219" y2="1320.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="683.5" y="1315.9902">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="1350.043" y2="1350.043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="1350.043" y2="1363.043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="1363.043" y2="1363.043"/><polygon fill="#A80036" points="1063.5,1359.043,1053.5,1363.043,1063.5,1367.043,1059.5,1363.043" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1059.5" y="1345.3008">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="1392.3535" y2="1392.3535"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="1392.3535" y2="1405.3535"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="1405.3535" y2="1405.3535"/><polygon fill="#A80036" points="1063.5,1401.3535,1053.5,1405.3535,1063.5,1409.3535,1059.5,1405.3535" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1059.5" y="1387.6113">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="1434.6641" y2="1434.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="1434.6641" y2="1447.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="1447.6641" y2="1447.6641"/><polygon fill="#A80036" points="1063.5,1443.6641,1053.5,1447.6641,1063.5,1451.6641,1059.5,1447.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1059.5" y="1429.9219">Validates message signature</text><polygon fill="#FF0000" filter="url(#f1jhbefr75fu9a)" points="1057,1460.6641,1057,1485.6641,1189,1485.6641,1189,1470.6641,1179,1460.6641,1057,1460.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1179" x2="1179" y1="1460.6641" y2="1470.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1189" x2="1179" y1="1470.6641" y2="1470.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1063" y="1478.2324">Validation failure!</text><polygon fill="#A80036" points="2531.5,1511.9746,2541.5,1515.9746,2531.5,1519.9746,2535.5,1515.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1047.5" x2="2537.5" y1="1515.9746" y2="1515.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1054.5" y="1511.543">Publishes Notification (failure) event for DFSP1</text><polygon fill="#A80036" points="2757,1541.2852,2767,1545.2852,2757,1549.2852,2761,1545.2852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2543.5" x2="2763" y1="1545.2852" y2="1545.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="2550.5" y="1540.8535">Consumes Notifications event</text><polygon fill="#A80036" points="2790,1570.5957,2780,1574.5957,2790,1578.5957,2786,1574.5957" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3251.5,1570.5957,3261.5,1574.5957,3251.5,1578.5957,3255.5,1574.5957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2784" x2="3257.5" y1="1574.5957" y2="1574.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2796" y="1570.1641">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="58.5,1599.9063,48.5,1603.9063,58.5,1607.9063,54.5,1603.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2768" y1="1603.9063" y2="1603.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="64.5" y="1599.4746">HTTP Callback with Prepare result to DFSP1</text><polygon fill="#A80036" points="2790,1629.2168,2780,1633.2168,2790,1637.2168,2786,1633.2168" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3251.5,1629.2168,3261.5,1633.2168,3251.5,1637.2168,3255.5,1633.2168" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2784" x2="3257.5" y1="1633.2168" y2="1633.2168"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2796" y="1628.7852">Fetches Notifications details for DFSP2</text><polygon fill="#A80036" points="117.5,1658.5273,107.5,1662.5273,117.5,1666.5273,113.5,1662.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111.5" x2="2773" y1="1662.5273" y2="1662.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="123.5" y="1658.0957">HTTP Callback with Prepare result to DFSP2</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="3439.5" y1="1671.8379" y2="1671.8379"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="18" y="1682.4727">[Prepare Position Failure]</text><polygon fill="#A80036" points="260.5,1702.793,270.5,1706.793,260.5,1710.793,264.5,1706.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="266.5" y1="1706.793" y2="1706.793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="54.5" y="1702.3613">POST - http://transfers</text><polygon fill="#A80036" points="664.5,1732.1035,674.5,1736.1035,664.5,1740.1035,668.5,1736.1035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282.5" x2="670.5" y1="1736.1035" y2="1736.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="289.5" y="1731.6719">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="676.5" x2="718.5" y1="1765.7246" y2="1765.7246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="718.5" x2="718.5" y1="1765.7246" y2="1778.7246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="677.5" x2="718.5" y1="1778.7246" y2="1778.7246"/><polygon fill="#A80036" points="687.5,1774.7246,677.5,1778.7246,687.5,1782.7246,683.5,1778.7246" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="683.5" y="1760.9824">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="293.5,1803.7246,283.5,1807.7246,293.5,1811.7246,289.5,1807.7246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287.5" x2="675.5" y1="1807.7246" y2="1807.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="299.5" y="1803.293">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="58.5,1833.0352,48.5,1837.0352,58.5,1841.0352,54.5,1837.0352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="276.5" y1="1837.0352" y2="1837.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="64.5" y="1832.6035">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1030.5,1862.3457,1040.5,1866.3457,1030.5,1870.3457,1034.5,1866.3457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="676.5" x2="1036.5" y1="1866.3457" y2="1866.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="683.5" y="1861.9141">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="1895.9668" y2="1895.9668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="1895.9668" y2="1908.9668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="1908.9668" y2="1908.9668"/><polygon fill="#A80036" points="1063.5,1904.9668,1053.5,1908.9668,1063.5,1912.9668,1059.5,1908.9668" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1059.5" y="1891.2246">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="1938.2773" y2="1938.2773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="1938.2773" y2="1951.2773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="1951.2773" y2="1951.2773"/><polygon fill="#A80036" points="1063.5,1947.2773,1053.5,1951.2773,1063.5,1955.2773,1059.5,1951.2773" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1059.5" y="1933.5352">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052.5" x2="1094.5" y1="1980.5879" y2="1980.5879"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094.5" x2="1094.5" y1="1980.5879" y2="1993.5879"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1053.5" x2="1094.5" y1="1993.5879" y2="1993.5879"/><polygon fill="#A80036" points="1063.5,1989.5879,1053.5,1993.5879,1063.5,1997.5879,1059.5,1993.5879" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1059.5" y="1975.8457">Validates message signature</text><polygon fill="#A80036" points="1342.5,2018.5879,1352.5,2022.5879,1342.5,2026.5879,1346.5,2022.5879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1047.5" x2="1348.5" y1="2022.5879" y2="2022.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1054.5" y="2018.1563">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="1649.5,2047.8984,1659.5,2051.8984,1649.5,2055.8984,1653.5,2051.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354.5" x2="1655.5" y1="2051.8984" y2="2051.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1361.5" y="2047.4668">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="3033.5,2077.209,3043.5,2081.209,3033.5,2085.209,3037.5,2081.209" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1671.5" x2="3039.5" y1="2081.209" y2="2081.209"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1678.5" y="2076.7773">Request to persist event information</text><polygon fill="#A80036" points="3056.5,2106.5195,3046.5,2110.5195,3056.5,2114.5195,3052.5,2110.5195" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3369.5,2106.5195,3379.5,2110.5195,3369.5,2114.5195,3373.5,2110.5195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3050.5" x2="3375.5" y1="2110.5195" y2="2110.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3062.5" y="2106.0879">Persist event information</text><polygon fill="#A80036" points="1682.5,2135.8301,1672.5,2139.8301,1682.5,2143.8301,1678.5,2139.8301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1676.5" x2="3044.5" y1="2139.8301" y2="2139.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1688.5" y="2135.3984">return success</text><polygon fill="#A80036" points="1682.5,2165.1406,1672.5,2169.1406,1682.5,2173.1406,1678.5,2169.1406" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3369.5,2165.1406,3379.5,2169.1406,3369.5,2173.1406,3373.5,2169.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1676.5" x2="3375.5" y1="2169.1406" y2="2169.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1688.5" y="2164.709">Retrieves latest position from DB for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1671.5" x2="1713.5" y1="2198.7617" y2="2198.7617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1713.5" x2="1713.5" y1="2198.7617" y2="2211.7617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1672.5" x2="1713.5" y1="2211.7617" y2="2211.7617"/><polygon fill="#A80036" points="1682.5,2207.7617,1672.5,2211.7617,1682.5,2215.7617,1678.5,2211.7617" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="1678.5" y="2194.0195">Calculates latest position by decrementing transfer for prepare</text><polygon fill="#FF0000" filter="url(#f1jhbefr75fu9a)" points="1676,2224.7617,1676,2249.7617,1808,2249.7617,1808,2234.7617,1798,2224.7617,1676,2224.7617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1798" x2="1798" y1="2224.7617" y2="2234.7617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1808" x2="1798" y1="2234.7617" y2="2234.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1682" y="2242.3301">Validation failure!</text><polygon fill="#A80036" points="2531.5,2276.0723,2541.5,2280.0723,2531.5,2284.0723,2535.5,2280.0723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1666.5" x2="2537.5" y1="2280.0723" y2="2280.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="1673.5" y="2275.6406">Publishes Notifications (Failure) event for DFSP2</text><polygon fill="#A80036" points="2757,2305.3828,2767,2309.3828,2757,2313.3828,2761,2309.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2543.5" x2="2763" y1="2309.3828" y2="2309.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="2550.5" y="2304.9512">Consumes Notifications event</text><polygon fill="#A80036" points="2790,2334.6934,2780,2338.6934,2790,2342.6934,2786,2338.6934" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3251.5,2334.6934,3261.5,2338.6934,3251.5,2342.6934,3255.5,2338.6934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2784" x2="3257.5" y1="2338.6934" y2="2338.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="2796" y="2334.2617">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="58.5,2364.0039,48.5,2368.0039,58.5,2372.0039,54.5,2368.0039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="2768" y1="2368.0039" y2="2368.0039"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="64.5" y="2363.5723">HTTP Callback with Prepare result to DFSP1</text><!--
@startuml
' declate title
title DFSP1 sends a Prepare Transfer request to DFSP2

' keys:
' boundary - APIs
' collections - Kafka Topics
' control - Kafka Consumers
' entity - Database Access Objects

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as API
collections "Prepare-Topic-handler-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-handler-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic-handler" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic-handler" as TOPIC_NOTIFICATIONS
control "ML API Notification Event Handler" as NOTIFY_HANDLER
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

' start flow
alt DFSP1 sends a Prepare Transfer request to DFSP2
    activate API
    DFSP1 -> API: POST - http://transfers
    API -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> API: Responds replication acknoledgements have been received
    API -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate API
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    POS_HANDLER <-> DB: Retrieves latest position from DB for DFSP1
    POS_HANDLER <-> POS_HANDLER: Calculates latest position by decrementing transfer for prepare
    POS_HANDLER -> POS_DAO: Request to persist latest position for DFSP1
    POS_DAO <-> DB: Persists latest position to DB for DFSP1
    POS_DAO -> POS_HANDLER: return success
    POS_HANDLER -> TOPIC_TRANSFERS: Publishes Transfer event
    deactivate POS_HANDLER
    deactivate TRANS_HANDLER
    TOPIC_TRANSFERS -> TRANS_HANDLER: Consumes Transfer event
    TRANS_HANDLER -> TRANS_DAO: Request to Transfer status to DB
    TRANS_DAO <-> DB: return success
    TRANS_DAO -> TRANS_HANDLER: Persists Transfer status to DB
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP1
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP2
    deactivate TRANS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP2
    NOTIFY_HANDLER -> DFSP2: HTTP Callback with Prepare result to DFSP2
    deactivate NOTIFY_HANDLER
else Prepare Validation Failure
    activate API
    DFSP1 -> API: POST - http://transfers
    API -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> API: Responds replication acknoledgements have been received
    API -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate API
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    note right of PREP_HANDLER #red: Validation failure!
    PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notification (failure) event for DFSP1
    deactivate PREP_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP2
    NOTIFY_HANDLER -> DFSP2: HTTP Callback with Prepare result to DFSP2
    deactivate NOTIFY_HANDLER
else Prepare Position Failure
    activate API
    DFSP1 -> API: POST - http://transfers
    API -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> API: Responds replication acknoledgements have been received
    API -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate API
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    POS_HANDLER <-> DB: Retrieves latest position from DB for DFSP1
    POS_HANDLER <-> POS_HANDLER: Calculates latest position by decrementing transfer for prepare
    note right of POS_HANDLER #red: Validation failure!
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications (Failure) event for DFSP2
    deactivate POS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>