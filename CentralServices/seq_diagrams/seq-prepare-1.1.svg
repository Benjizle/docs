<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3173px" preserveAspectRatio="none" style="width:4336px;height:3173px;" version="1.1" viewBox="0 0 4336 3173" width="4336px" zoomAndPan="magnify"><defs><filter height="300%" id="f1udloexclnjy9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="385" x="1976.75" y="23.5352">1.1 DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#ADD8E6" height="3128.2793" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="3128.2793" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="3128.2793" style="stroke: #A80036; stroke-width: 1.0;" width="3332.5" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2602.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="444.5215" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="381.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2669.9316"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="642.3848" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="591.8086"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="691.3164" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2407" y="1234.1934"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="2904.9922" style="stroke: #000000; stroke-width: 2.0;" width="4292.5" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1219" x2="1219" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1603" x2="1603" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2078" x2="2078" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2412" x2="2412" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3029" x2="3029" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3234.5" x2="3234.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3529.5" x2="3529.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3661.5" x2="3661.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3758.5" x2="3758.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3856.5" x2="3856.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3976.5" x2="3976.5" y1="137.2871" y2="3076.2793"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4267.5" x2="4267.5" y1="137.2871" y2="3076.2793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="3088.8145">DFSP1</text><ellipse cx="67.5" cy="3101.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,3109.7676 L67.5,3136.7676 M54.5,3117.7676 L80.5,3117.7676 M67.5,3136.7676 L54.5,3151.7676 M67.5,3136.7676 L80.5,3151.7676 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="3088.8145">DFSP2</text><ellipse cx="126.5" cy="3101.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,3109.7676 L126.5,3136.7676 M113.5,3117.7676 L139.5,3117.7676 M126.5,3136.7676 L113.5,3151.7676 M126.5,3136.7676 L139.5,3151.7676 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="3088.8145">ML API Adapter</text><path d="M325,3095.7676 L325,3119.7676 M325,3107.7676 L342,3107.7676 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="3088.8145">ML API Notification Event Handler</text><ellipse cx="527" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,3095.7676,529,3090.7676,527,3095.7676,529,3100.7676,523,3095.7676" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="3088.8145">Central Service API</text><path d="M1037.5,3095.7676 L1037.5,3119.7676 M1037.5,3107.7676 L1054.5,3107.7676 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="3075.2793"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="3079.2793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="3099.8145">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="134.334">Prepare Event Handler</text><ellipse cx="1603" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,92.7988,1605,87.7988,1603,92.7988,1605,97.7988,1599,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="3088.8145">Prepare Event Handler</text><ellipse cx="1603" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,3095.7676,1605,3090.7676,1603,3095.7676,1605,3100.7676,1599,3095.7676" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1997" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1993" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2000" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1997" y="3075.2793"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1993" y="3079.2793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2000" y="3099.8145">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2332" y="134.334">Position Event Handler</text><ellipse cx="2412" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2408,92.7988,2414,87.7988,2412,92.7988,2414,97.7988,2408,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2332" y="3088.8145">Position Event Handler</text><ellipse cx="2412" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2408,3095.7676,2414,3090.7676,2412,3095.7676,2414,3100.7676,2408,3095.7676" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2970" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2966" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2973" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2970" y="3075.2793"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2966" y="3079.2793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2973" y="3099.8145">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="3153.5" y="134.334">Transfer Event Handler</text><ellipse cx="3235" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="3231,92.7988,3237,87.7988,3235,92.7988,3237,97.7988,3231,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="3153.5" y="3088.8145">Transfer Event Handler</text><ellipse cx="3235" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="3231,3095.7676,3237,3090.7676,3235,3095.7676,3237,3100.7676,3231,3095.7676" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3460.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3456.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3463.5" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3460.5" y="3075.2793"/><rect fill="#FEFECE" filter="url(#f1udloexclnjy9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3456.5" y="3079.2793"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3463.5" y="3099.8145">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3613.5" y="134.334">Position DAO</text><ellipse cx="3661.5" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3649.5" x2="3673.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3613.5" y="3088.8145">Position DAO</text><ellipse cx="3661.5" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3649.5" x2="3673.5" y1="3121.7676" y2="3121.7676"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3719.5" y="134.334">Event DAO</text><ellipse cx="3758.5" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3746.5" x2="3770.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3719.5" y="3088.8145">Event DAO</text><ellipse cx="3758.5" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3746.5" x2="3770.5" y1="3121.7676" y2="3121.7676"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3807.5" y="134.334">Transfer DAO</text><ellipse cx="3857" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3845" x2="3869" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3807.5" y="3088.8145">Transfer DAO</text><ellipse cx="3857" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3845" x2="3869" y1="3121.7676" y2="3121.7676"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3916.5" y="134.334">Notification DAO</text><ellipse cx="3976.5" cy="104.7988" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3964.5" x2="3988.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3916.5" y="3088.8145">Notification DAO</text><ellipse cx="3976.5" cy="3107.7676" fill="#FEFECE" filter="url(#f1udloexclnjy9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3964.5" x2="3988.5" y1="3121.7676" y2="3121.7676"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4219.5" y="134.334">Central Store</text><path d="M4249.5,84.7988 C4249.5,74.7988 4267.5,74.7988 4267.5,74.7988 C4267.5,74.7988 4285.5,74.7988 4285.5,84.7988 L4285.5,110.7988 C4285.5,120.7988 4267.5,120.7988 4267.5,120.7988 C4267.5,120.7988 4249.5,120.7988 4249.5,110.7988 L4249.5,84.7988 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M4249.5,84.7988 C4249.5,94.7988 4267.5,94.7988 4267.5,94.7988 C4267.5,94.7988 4285.5,94.7988 4285.5,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4219.5" y="3088.8145">Central Store</text><path d="M4249.5,3101.7676 C4249.5,3091.7676 4267.5,3091.7676 4267.5,3091.7676 C4267.5,3091.7676 4285.5,3091.7676 4285.5,3101.7676 L4285.5,3127.7676 C4285.5,3137.7676 4267.5,3137.7676 4267.5,3137.7676 C4267.5,3137.7676 4249.5,3137.7676 4249.5,3127.7676 L4249.5,3101.7676 " fill="#FEFECE" filter="url(#f1udloexclnjy9)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M4249.5,3101.7676 C4249.5,3111.7676 4267.5,3111.7676 4267.5,3111.7676 C4267.5,3111.7676 4285.5,3111.7676 4285.5,3101.7676 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="444.5215" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="381.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2669.9316"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="642.3848" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="591.8086"/><rect fill="#FFFFFF" filter="url(#f1udloexclnjy9)" height="691.3164" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2407" y="1234.1934"/><rect fill="none" height="2904.9922" style="stroke: #000000; stroke-width: 2.0;" width="4292.5" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="110" y="166.9219">[DFSP1 sends a Prepare Transfer request to DFSP2]</text><polygon fill="#A80036" points="328.5,188.5977,338.5,192.5977,328.5,196.5977,332.5,192.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="192.5977" y2="192.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="188.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="188.166">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#f1udloexclnjy9)" points="355,205.9082,355,459.9082,579,459.9082,579,215.9082,569,205.9082,355,205.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="569" x2="569" y1="205.9082" y2="215.9082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="579" x2="569" y1="215.9082" y2="215.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="223.4766">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="238.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="254.0977">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="377" y="269.4082">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="377" y="284.7188">to: dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="300.0293">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="315.3398">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="330.6504">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="345.9609">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="361.2715">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="376.582">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="391.8926">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="409" y="407.2031">createdAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="422.5137">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="437.8242">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="453.1348">}</text><polygon fill="#A80036" points="1207,486.877,1217,490.877,1207,494.877,1211,490.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1213" y1="490.877" y2="490.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="486.4453">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="486.4453">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1261" y1="520.498" y2="520.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1261" x2="1261" y1="520.498" y2="533.498"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1220" x2="1261" y1="533.498" y2="533.498"/><polygon fill="#A80036" points="1230,529.498,1220,533.498,1230,537.498,1226,533.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="515.7559">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1239" y="515.7559">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,558.498,351.5,562.498,361.5,566.498,357.5,562.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1218" y1="562.498" y2="562.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="558.0664">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="558.0664">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,587.8086,68.5,591.8086,78.5,595.8086,74.5,591.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="591.8086" y2="591.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="587.377">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="587.377">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1586,617.1191,1596,621.1191,1586,625.1191,1590,621.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1592" y1="621.1191" y2="621.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="616.6875">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1239" y="616.6875">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="650.7402" y2="650.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="650.7402" y2="663.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="663.7402" y2="663.7402"/><polygon fill="#A80036" points="1619,659.7402,1609,663.7402,1619,667.7402,1615,663.7402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="645.998">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1628" y="645.998">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="693.0508" y2="693.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="693.0508" y2="706.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="706.0508" y2="706.0508"/><polygon fill="#A80036" points="1619,702.0508,1609,706.0508,1619,710.0508,1615,706.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="688.3086">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1628" y="688.3086">Validates to - DFSP2</text><polygon fill="#A80036" points="3845,731.0508,3855,735.0508,3845,739.0508,3849,735.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="3851" y1="735.0508" y2="735.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="730.6191">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1628" y="730.6191">Request to retrieve Transfer (if it exists)</text><polygon fill="#A80036" points="3868,760.3613,3858,764.3613,3868,768.3613,3864,764.3613" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4255.5,760.3613,4265.5,764.3613,4255.5,768.3613,4259.5,764.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3862" x2="4261.5" y1="764.3613" y2="764.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3874" y="759.9297">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="3896" y="759.9297">return Transfer if it exists</text><polygon fill="#A80036" points="1619,789.6719,1609,793.6719,1619,797.6719,1615,793.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1613" x2="3856" y1="793.6719" y2="793.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1625" y="789.2402">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1647" y="789.2402">return Transfer if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="823.293" y2="823.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="823.293" y2="836.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="836.293" y2="836.293"/><polygon fill="#A80036" points="1619,832.293,1609,836.293,1619,840.293,1615,836.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="818.5508">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1637" y="818.5508">Validates duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="865.6035" y2="865.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="865.6035" y2="878.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="878.6035" y2="878.6035"/><polygon fill="#A80036" points="1619,874.6035,1609,878.6035,1619,882.6035,1615,878.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="860.8613">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1637" y="860.8613">Validates crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="907.9141" y2="907.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="907.9141" y2="920.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="920.9141" y2="920.9141"/><polygon fill="#A80036" points="1619,916.9141,1609,920.9141,1619,924.9141,1615,920.9141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1615" y="903.1719">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1637" y="903.1719">Validates message signature (to be confirmed in future requirement)</text><polygon fill="#FFFF00" filter="url(#f1udloexclnjy9)" points="1613,933.9141,1613,1203.9141,1873,1203.9141,1873,943.9141,1863,933.9141,1613,933.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1863" x2="1863" y1="933.9141" y2="943.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1873" x2="1863" y1="943.9141" y2="943.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1619" y="951.4824">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="966.793">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1635" y="982.1035">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1635" y="997.4141">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1635" y="1012.7246">to: dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1635" y="1028.0352">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1635" y="1043.3457">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1635" y="1058.6563">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1651" y="1073.9668">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1667" y="1089.2773">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1667" y="1104.5879">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1667" y="1119.8984">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1667" y="1135.209">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="1667" y="1150.5195">createdAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1651" y="1165.8301">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1635" y="1181.1406">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="1196.4512">}</text><polygon fill="#A80036" points="2066,1230.1934,2076,1234.1934,2066,1238.1934,2070,1234.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="2072" y1="1234.1934" y2="1234.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1610" y="1229.7617">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1632" y="1229.7617">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="2395,1259.5039,2405,1263.5039,2395,1267.5039,2399,1263.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2078" x2="2401" y1="1263.5039" y2="1263.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2085" y="1259.0723">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="2107" y="1259.0723">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="3649.5,1288.8145,3659.5,1292.8145,3649.5,1296.8145,3653.5,1292.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2417" x2="3655.5" y1="1292.8145" y2="1292.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2424" y="1288.3828">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="2446" y="1288.3828">Request latest position from DB for DFSP1</text><polygon fill="#A80036" points="3672.5,1318.125,3662.5,1322.125,3672.5,1326.125,3668.5,1322.125" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4255.5,1318.125,4265.5,1322.125,4255.5,1326.125,4259.5,1322.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3666.5" x2="4261.5" y1="1322.125" y2="1322.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3678.5" y="1317.6934">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="3700.5" y="1317.6934">Retrieves latest position from DB for DFSP1</text><polygon fill="#A80036" points="2428,1347.4355,2418,1351.4355,2428,1355.4355,2424,1351.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2422" x2="3660.5" y1="1351.4355" y2="1351.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2434" y="1347.0039">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="2456" y="1347.0039">Return success</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2417" x2="2459" y1="1381.0566" y2="1381.0566"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2459" x2="2459" y1="1381.0566" y2="1394.0566"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2418" x2="2459" y1="1394.0566" y2="1394.0566"/><polygon fill="#A80036" points="2428,1390.0566,2418,1394.0566,2428,1398.0566,2424,1394.0566" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2424" y="1376.3145">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="2446" y="1376.3145">Calculates latest position (lpos) by incrementing transfer for prepare</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2417" x2="2459" y1="1423.3672" y2="1423.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2459" x2="2459" y1="1423.3672" y2="1436.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2418" x2="2459" y1="1436.3672" y2="1436.3672"/><polygon fill="#A80036" points="2428,1432.3672,2418,1436.3672,2428,1440.3672,2424,1436.3672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2424" y="1418.625">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="571" x="2446" y="1418.625">Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos &lt; netcap</text><polygon fill="#A80036" points="3649.5,1461.3672,3659.5,1465.3672,3649.5,1469.3672,3653.5,1465.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2417" x2="3655.5" y1="1465.3672" y2="1465.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2424" y="1460.9355">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="2446" y="1460.9355">Request to persist latest position for DFSP1</text><polygon fill="#A80036" points="3672.5,1490.6777,3662.5,1494.6777,3672.5,1498.6777,3668.5,1494.6777" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4255.5,1490.6777,4265.5,1494.6777,4255.5,1498.6777,4259.5,1494.6777" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3666.5" x2="4261.5" y1="1494.6777" y2="1494.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3678.5" y="1490.2461">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="3700.5" y="1490.2461">Persists latest position to DB for DFSP1</text><polygon fill="#A80036" points="2428,1519.9883,2418,1523.9883,2428,1527.9883,2424,1523.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2422" x2="3660.5" y1="1523.9883" y2="1523.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2434" y="1519.5566">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2456" y="1519.5566">return success</text><polygon fill="#A80036" points="3746.5,1549.2988,3756.5,1553.2988,3746.5,1557.2988,3750.5,1553.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2417" x2="3752.5" y1="1553.2988" y2="1553.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2424" y="1548.8672">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="2446" y="1548.8672">Request to persist event information</text><polygon fill="#A80036" points="3769.5,1578.6094,3759.5,1582.6094,3769.5,1586.6094,3765.5,1582.6094" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4255.5,1578.6094,4265.5,1582.6094,4255.5,1586.6094,4259.5,1582.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3763.5" x2="4261.5" y1="1582.6094" y2="1582.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3775.5" y="1578.1777">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3797.5" y="1578.1777">Persist event information</text><polygon fill="#A80036" points="2428,1607.9199,2418,1611.9199,2428,1615.9199,2424,1611.9199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2422" x2="3757.5" y1="1611.9199" y2="1611.9199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2434" y="1607.4883">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2456" y="1607.4883">return success</text><polygon fill="#FFFF00" filter="url(#f1udloexclnjy9)" points="2422,1625.2305,2422,1895.2305,2682,1895.2305,2682,1635.2305,2672,1625.2305,2422,1625.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2672" x2="2672" y1="1625.2305" y2="1635.2305"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2682" x2="2672" y1="1635.2305" y2="1635.2305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2428" y="1642.7988">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2428" y="1658.1094">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2444" y="1673.4199">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="2444" y="1688.7305">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="2444" y="1704.041">to: dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2444" y="1719.3516">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="2444" y="1734.6621">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2444" y="1749.9727">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2460" y="1765.2832">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="2476" y="1780.5938">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="2476" y="1795.9043">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="2476" y="1811.2148">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2476" y="1826.5254">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="2476" y="1841.8359">createdAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2460" y="1857.1465">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2444" y="1872.457">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2428" y="1887.7676">}</text><polygon fill="#A80036" points="3017,1921.5098,3027,1925.5098,3017,1929.5098,3021,1925.5098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2412" x2="3023" y1="1925.5098" y2="1925.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2419" y="1921.0781">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="2441" y="1921.0781">Publishes Transfer event</text><polygon fill="#A80036" points="3223,1950.8203,3233,1954.8203,3223,1958.8203,3227,1954.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3029" x2="3229" y1="1954.8203" y2="1954.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3036" y="1950.3887">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="3058" y="1950.3887">Consumes Transfer event</text><polygon fill="#A80036" points="3845,1980.1309,3855,1984.1309,3845,1988.1309,3849,1984.1309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3235" x2="3851" y1="1984.1309" y2="1984.1309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3242" y="1979.6992">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="3264" y="1979.6992">Request to Transfer status to DB</text><polygon fill="#A80036" points="3868,2009.4414,3858,2013.4414,3868,2017.4414,3864,2013.4414" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4255.5,2009.4414,4265.5,2013.4414,4255.5,2017.4414,4259.5,2013.4414" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3862" x2="4261.5" y1="2013.4414" y2="2013.4414"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3874" y="2009.0098">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="3896" y="2009.0098">return success</text><polygon fill="#A80036" points="3246,2038.752,3236,2042.752,3246,2046.752,3242,2042.752" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3240" x2="3856" y1="2042.752" y2="2042.752"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3252" y="2038.3203">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="3274" y="2038.3203">Persists Transfer status to DB</text><polygon fill="#FFFF00" filter="url(#f1udloexclnjy9)" points="3240,2056.0625,3240,2326.0625,3520,2326.0625,3520,2066.0625,3510,2056.0625,3240,2056.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3510" x2="3510" y1="2056.0625" y2="2066.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3520" x2="3510" y1="2066.0625" y2="2066.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="3246" y="2073.6309">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3246" y="2088.9414">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="3262" y="2104.252">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="3262" y="2119.5625">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="3262" y="2134.873">to: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="3262" y="2150.1836">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="3262" y="2165.4941">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="3262" y="2180.8047">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3278" y="2196.1152">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="3294" y="2211.4258">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="3294" y="2226.7363">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="3294" y="2242.0469">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="3294" y="2257.3574">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="3294" y="2272.668">createdAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3278" y="2287.9785">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3262" y="2303.2891">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3246" y="2318.5996">}</text><polygon fill="#A80036" points="3518,2352.3418,3528,2356.3418,3518,2360.3418,3522,2356.3418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3235" x2="3524" y1="2356.3418" y2="2356.3418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3242" y="2351.9102">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="3264" y="2351.9102">Publishes Notifications event for DFSP1</text><polygon fill="#FFFF00" filter="url(#f1udloexclnjy9)" points="3240,2369.6523,3240,2639.6523,3520,2639.6523,3520,2379.6523,3510,2369.6523,3240,2369.6523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3510" x2="3510" y1="2369.6523" y2="2379.6523"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3520" x2="3510" y1="2379.6523" y2="2379.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="3246" y="2387.2207">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3246" y="2402.5313">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="3262" y="2417.8418">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="3262" y="2433.1523">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="3262" y="2448.4629">to: dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="3262" y="2463.7734">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="3262" y="2479.084">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="3262" y="2494.3945">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="3278" y="2509.7051">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="3294" y="2525.0156">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="3294" y="2540.3262">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="3294" y="2555.6367">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="3294" y="2570.9473">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="3294" y="2586.2578">createdAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3278" y="2601.5684">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3262" y="2616.8789">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="3246" y="2632.1895">}</text><polygon fill="#A80036" points="3518,2665.9316,3528,2669.9316,3518,2673.9316,3522,2669.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3235" x2="3524" y1="2669.9316" y2="2669.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3242" y="2665.5">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="3264" y="2665.5">Publishes Notifications event for DFSP2</text><polygon fill="#A80036" points="543,2695.2422,533,2699.2422,543,2703.2422,539,2699.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="3529" y1="2699.2422" y2="2699.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2694.8105">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="2694.8105">Consumes Notifications event</text><polygon fill="#A80036" points="1046,2724.5527,1056,2728.5527,1046,2732.5527,1050,2728.5527" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="2728.5527" y2="2728.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2724.1211">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="2724.1211">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="3964.5,2753.8633,3974.5,2757.8633,3964.5,2761.8633,3968.5,2757.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1058" x2="3970.5" y1="2757.8633" y2="2757.8633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1065" y="2753.4316">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1087" y="2753.4316">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="3987.5,2783.1738,3977.5,2787.1738,3987.5,2791.1738,3983.5,2787.1738" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4255.5,2783.1738,4265.5,2787.1738,4255.5,2791.1738,4259.5,2787.1738" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3981.5" x2="4261.5" y1="2787.1738" y2="2787.1738"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3993.5" y="2782.7422">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="4015.5" y="2782.7422">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="1069,2812.4844,1059,2816.4844,1069,2820.4844,1065,2816.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3975.5" y1="2816.4844" y2="2816.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2812.0527">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2812.0527">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="543,2841.7949,533,2845.7949,543,2849.7949,539,2845.7949" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="2845.7949" y2="2845.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2841.3633">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="2841.3633">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,2871.1055,68.5,2875.1055,78.5,2879.1055,74.5,2875.1055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="521" y1="2875.1055" y2="2875.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="2870.6738">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="2870.6738">HTTP Callback with Prepare result to DFSP1</text><polygon fill="#A80036" points="1046,2900.416,1056,2904.416,1046,2908.416,1050,2904.416" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="2904.416" y2="2904.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2899.9844">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="2899.9844">Requests Notification details for DFSP2 - GET - HTTP://notifications/DFPS2</text><polygon fill="#A80036" points="1069,2929.7266,1059,2933.7266,1069,2937.7266,1065,2933.7266" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3964.5,2929.7266,3974.5,2933.7266,3964.5,2937.7266,3968.5,2933.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3970.5" y1="2933.7266" y2="2933.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2929.2949">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2929.2949">Fetches Notifications details for DFSP2</text><polygon fill="#A80036" points="3987.5,2959.0371,3977.5,2963.0371,3987.5,2967.0371,3983.5,2963.0371" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4255.5,2959.0371,4265.5,2963.0371,4255.5,2967.0371,4259.5,2963.0371" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3981.5" x2="4261.5" y1="2963.0371" y2="2963.0371"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3993.5" y="2958.6055">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="4015.5" y="2958.6055">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="1069,2988.3477,1059,2992.3477,1069,2996.3477,1065,2992.3477" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3975.5" y1="2992.3477" y2="2992.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2987.916">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2987.916">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="543,3017.6582,533,3021.6582,543,3025.6582,539,3021.6582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="3021.6582" y2="3021.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="3017.2266">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="3017.2266">Returns Notifications details for DFSP2</text><polygon fill="#A80036" points="137.5,3046.9688,127.5,3050.9688,137.5,3054.9688,133.5,3050.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="526" y1="3050.9688" y2="3050.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="3046.5371">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="165.5" y="3046.5371">HTTP Callback with Prepare result to DFSP2</text><!--
@startuml
' declate title
title 1.1 DFSP1 sends a Prepare Transfer request to DFSP2

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt DFSP1 sends a Prepare Transfer request to DFSP2
    activate MLAPI
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer (if it exists)
    TRANS_DAO <-> DB: return Transfer if it exists
    TRANS_DAO -> PREP_HANDLER: return Transfer if it exists
    PREP_HANDLER <-> PREP_HANDLER: Validates duplicate Check
    PREP_HANDLER <-> PREP_HANDLER: Validates crypto-condition
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature (to be confirmed in future requirement)
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: position,
                    action: prepare,
                    createdAt: <timestamp>
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> POS_DAO: Request latest position from DB for DFSP1
    POS_DAO <-> DB: Retrieves latest position from DB for DFSP1
    POS_DAO -> POS_HANDLER: Return success
    POS_HANDLER <-> POS_HANDLER: Calculates latest position (lpos) by incrementing transfer for prepare
    POS_HANDLER <-> POS_HANDLER: Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos < netcap
    POS_HANDLER -> POS_DAO: Request to persist latest position for DFSP1
    POS_DAO <-> DB: Persists latest position to DB for DFSP1
    POS_DAO -> POS_HANDLER: return success
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    note right of POS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: transfer,
                    action: prepare,
                    createdAt: <timestamp>
                }
            }
        }
    end note
    POS_HANDLER -> TOPIC_TRANSFERS: Publishes Transfer event
    deactivate POS_HANDLER
    deactivate TRANS_HANDLER
    TOPIC_TRANSFERS -> TRANS_HANDLER: Consumes Transfer event
    TRANS_HANDLER -> TRANS_DAO: Request to Transfer status to DB
    TRANS_DAO <-> DB: return success
    TRANS_DAO -> TRANS_HANDLER: Persists Transfer status to DB
    note right of TRANS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp1,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createdAt: <timestamp>
                }
            }
        }
    end note
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP1
    note right of TRANS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp2,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createdAt: <timestamp>
                }
            }
        }
    end note
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP2
    deactivate TRANS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI -> NOTIFY_DAO: Fetches Notifications details for DFSP1
    NOTIFY_DAO <-> DB: Fetches Notifications details for DFSP1
    NOTIFY_DAO -> CSAPI: Returns Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP2 - GET - HTTP://notifications/DFPS2
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP2
    NOTIFY_DAO <-> DB: Fetches Notifications details for DFSP1
    NOTIFY_DAO -> CSAPI: Returns Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP2
    NOTIFY_HANDLER -> DFSP2: HTTP Callback with Prepare result to DFSP2
    deactivate NOTIFY_HANDLER
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>