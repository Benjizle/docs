<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2645px" preserveAspectRatio="none" style="width:3841px;height:2645px;" version="1.1" viewBox="0 0 3841 2645" width="3841px" zoomAndPan="magnify"><defs><filter height="300%" id="f153v6gr5wqhyk" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="385" x="1729.25" y="23.5352">1.1 DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#ADD8E6" height="2599.7578" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="2599.7578" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2599.7578" style="stroke: #A80036; stroke-width: 1.0;" width="2837.5" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2355.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="429.2109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="263.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2258.6523"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="439.2109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="576.498"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="559.7637" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2261" y="1015.709"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="2376.4707" style="stroke: #000000; stroke-width: 2.0;" width="3797.5" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1219" x2="1219" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1603" x2="1603" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1932" x2="1932" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2266" x2="2266" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2707" x2="2707" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2912.5" x2="2912.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3207.5" x2="3207.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3339.5" x2="3339.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3436.5" x2="3436.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3534.5" x2="3534.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3654.5" x2="3654.5" y1="137.2871" y2="2547.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3772.5" x2="3772.5" y1="137.2871" y2="2547.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2560.293">DFSP1</text><ellipse cx="67.5" cy="2573.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2581.2461 L67.5,2608.2461 M54.5,2589.2461 L80.5,2589.2461 M67.5,2608.2461 L54.5,2623.2461 M67.5,2608.2461 L80.5,2623.2461 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2560.293">DFSP2</text><ellipse cx="126.5" cy="2573.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2581.2461 L126.5,2608.2461 M113.5,2589.2461 L139.5,2589.2461 M126.5,2608.2461 L113.5,2623.2461 M126.5,2608.2461 L139.5,2623.2461 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2560.293">ML API Adapter</text><path d="M325,2567.2461 L325,2591.2461 M325,2579.2461 L342,2579.2461 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="2560.293">ML API Notification Event Handler</text><ellipse cx="527" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,2567.2461,529,2562.2461,527,2567.2461,529,2572.2461,523,2567.2461" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="2560.293">Central Service API</text><path d="M1037.5,2567.2461 L1037.5,2591.2461 M1037.5,2579.2461 L1054.5,2579.2461 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="2546.7578"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="2550.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="2571.293">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="134.334">Prepare Event Handler</text><ellipse cx="1603" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,92.7988,1605,87.7988,1603,92.7988,1605,97.7988,1599,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="2560.293">Prepare Event Handler</text><ellipse cx="1603" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,2567.2461,1605,2562.2461,1603,2567.2461,1605,2572.2461,1599,2567.2461" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1851" y="97.7988"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1847" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1854" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1851" y="2546.7578"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1847" y="2550.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1854" y="2571.293">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2186" y="134.334">Position Event Handler</text><ellipse cx="2266" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2262,92.7988,2268,87.7988,2266,92.7988,2268,97.7988,2262,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2186" y="2560.293">Position Event Handler</text><ellipse cx="2266" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2262,2567.2461,2268,2562.2461,2266,2567.2461,2268,2572.2461,2262,2567.2461" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2648" y="97.7988"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2644" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2651" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2648" y="2546.7578"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2644" y="2550.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2651" y="2571.293">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2831.5" y="134.334">Transfer Event Handler</text><ellipse cx="2913" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2909,92.7988,2915,87.7988,2913,92.7988,2915,97.7988,2909,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2831.5" y="2560.293">Transfer Event Handler</text><ellipse cx="2913" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2909,2567.2461,2915,2562.2461,2913,2567.2461,2915,2572.2461,2909,2567.2461" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3138.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3134.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3141.5" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3138.5" y="2546.7578"/><rect fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3134.5" y="2550.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3141.5" y="2571.293">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3291.5" y="134.334">Position DAO</text><ellipse cx="3339.5" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3327.5" x2="3351.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3291.5" y="2560.293">Position DAO</text><ellipse cx="3339.5" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3327.5" x2="3351.5" y1="2593.2461" y2="2593.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3397.5" y="134.334">Event DAO</text><ellipse cx="3436.5" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3424.5" x2="3448.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3397.5" y="2560.293">Event DAO</text><ellipse cx="3436.5" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3424.5" x2="3448.5" y1="2593.2461" y2="2593.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3485.5" y="134.334">Transfer DAO</text><ellipse cx="3535" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3523" x2="3547" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3485.5" y="2560.293">Transfer DAO</text><ellipse cx="3535" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3523" x2="3547" y1="2593.2461" y2="2593.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3594.5" y="134.334">Notification DAO</text><ellipse cx="3654.5" cy="104.7988" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3642.5" x2="3666.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3594.5" y="2560.293">Notification DAO</text><ellipse cx="3654.5" cy="2579.2461" fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3642.5" x2="3666.5" y1="2593.2461" y2="2593.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3724.5" y="134.334">Central Store</text><path d="M3754.5,84.7988 C3754.5,74.7988 3772.5,74.7988 3772.5,74.7988 C3772.5,74.7988 3790.5,74.7988 3790.5,84.7988 L3790.5,110.7988 C3790.5,120.7988 3772.5,120.7988 3772.5,120.7988 C3772.5,120.7988 3754.5,120.7988 3754.5,110.7988 L3754.5,84.7988 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3754.5,84.7988 C3754.5,94.7988 3772.5,94.7988 3772.5,94.7988 C3772.5,94.7988 3790.5,94.7988 3790.5,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3724.5" y="2560.293">Central Store</text><path d="M3754.5,2573.2461 C3754.5,2563.2461 3772.5,2563.2461 3772.5,2563.2461 C3772.5,2563.2461 3790.5,2563.2461 3790.5,2573.2461 L3790.5,2599.2461 C3790.5,2609.2461 3772.5,2609.2461 3772.5,2609.2461 C3772.5,2609.2461 3754.5,2609.2461 3754.5,2599.2461 L3754.5,2573.2461 " fill="#FEFECE" filter="url(#f153v6gr5wqhyk)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3754.5,2573.2461 C3754.5,2583.2461 3772.5,2583.2461 3772.5,2583.2461 C3772.5,2583.2461 3790.5,2583.2461 3790.5,2573.2461 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="429.2109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="263.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2258.6523"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="439.2109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="576.498"/><rect fill="#FFFFFF" filter="url(#f153v6gr5wqhyk)" height="559.7637" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2261" y="1015.709"/><rect fill="none" height="2376.4707" style="stroke: #000000; stroke-width: 2.0;" width="3797.5" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="110" y="166.9219">[DFSP1 sends a Prepare Transfer request to DFSP2]</text><polygon fill="#A80036" points="328.5,188.5977,338.5,192.5977,328.5,196.5977,332.5,192.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="192.5977" y2="192.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="188.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="188.166">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#f153v6gr5wqhyk)" points="355,205.9082,355,444.9082,575,444.9082,575,215.9082,565,205.9082,355,205.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="565" y1="205.9082" y2="215.9082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="575" x2="565" y1="215.9082" y2="215.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="223.4766">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="238.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="254.0977">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="377" y="269.4082">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="377" y="284.7188">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="300.0293">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="315.3398">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="330.6504">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="345.9609">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="361.2715">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="376.582">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="409" y="391.8926">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="407.2031">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="422.5137">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="437.8242">}</text><polygon fill="#A80036" points="1207,471.5664,1217,475.5664,1207,479.5664,1211,475.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1213" y1="475.5664" y2="475.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="471.1348">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="471.1348">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1261" y1="505.1875" y2="505.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1261" x2="1261" y1="505.1875" y2="518.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1220" x2="1261" y1="518.1875" y2="518.1875"/><polygon fill="#A80036" points="1230,514.1875,1220,518.1875,1230,522.1875,1226,518.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="500.4453">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1239" y="500.4453">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,543.1875,351.5,547.1875,361.5,551.1875,357.5,547.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1218" y1="547.1875" y2="547.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="542.7559">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="542.7559">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,572.498,68.5,576.498,78.5,580.498,74.5,576.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="576.498" y2="576.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="572.0664">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="572.0664">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1586,601.8086,1596,605.8086,1586,609.8086,1590,605.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1592" y1="605.8086" y2="605.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="601.377">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1239" y="601.377">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="635.4297" y2="635.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="635.4297" y2="648.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="648.4297" y2="648.4297"/><polygon fill="#A80036" points="1619,644.4297,1609,648.4297,1619,652.4297,1615,648.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="630.6875">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1628" y="630.6875">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="677.7402" y2="677.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="677.7402" y2="690.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="690.7402" y2="690.7402"/><polygon fill="#A80036" points="1619,686.7402,1609,690.7402,1619,694.7402,1615,690.7402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="672.998">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1628" y="672.998">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="720.0508" y2="720.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="720.0508" y2="733.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="733.0508" y2="733.0508"/><polygon fill="#A80036" points="1619,729.0508,1609,733.0508,1619,737.0508,1615,733.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="715.3086">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1628" y="715.3086">Validates message signature</text><polygon fill="#FFFF00" filter="url(#f153v6gr5wqhyk)" points="1613,746.0508,1613,985.0508,1833,985.0508,1833,756.0508,1823,746.0508,1613,746.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1823" x2="1823" y1="746.0508" y2="756.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1833" x2="1823" y1="756.0508" y2="756.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1619" y="763.6191">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="778.9297">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1635" y="794.2402">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1635" y="809.5508">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1635" y="824.8613">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1635" y="840.1719">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1635" y="855.4824">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1635" y="870.793">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1651" y="886.1035">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1667" y="901.4141">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1667" y="916.7246">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="1667" y="932.0352">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1651" y="947.3457">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1635" y="962.6563">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="977.9668">}</text><polygon fill="#A80036" points="1920,1011.709,1930,1015.709,1920,1019.709,1924,1015.709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1926" y1="1015.709" y2="1015.709"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1610" y="1011.2773">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1632" y="1011.2773">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="2249,1041.0195,2259,1045.0195,2249,1049.0195,2253,1045.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1932" x2="2255" y1="1045.0195" y2="1045.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1939" y="1040.5879">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1961" y="1040.5879">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="3424.5,1070.3301,3434.5,1074.3301,3424.5,1078.3301,3428.5,1074.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2271" x2="3430.5" y1="1074.3301" y2="1074.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2278" y="1069.8984">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="2300" y="1069.8984">Request to persist event information</text><polygon fill="#A80036" points="3447.5,1099.6406,3437.5,1103.6406,3447.5,1107.6406,3443.5,1103.6406" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1099.6406,3770.5,1103.6406,3760.5,1107.6406,3764.5,1103.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3441.5" x2="3766.5" y1="1103.6406" y2="1103.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3453.5" y="1099.209">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3475.5" y="1099.209">Persist event information</text><polygon fill="#A80036" points="2282,1128.9512,2272,1132.9512,2282,1136.9512,2278,1132.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2276" x2="3435.5" y1="1132.9512" y2="1132.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2288" y="1128.5195">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2310" y="1128.5195">return success</text><polygon fill="#A80036" points="2282,1158.2617,2272,1162.2617,2282,1166.2617,2278,1162.2617" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1158.2617,3770.5,1162.2617,3760.5,1166.2617,3764.5,1162.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2276" x2="3766.5" y1="1162.2617" y2="1162.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2288" y="1157.8301">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="2310" y="1157.8301">Retrieves latest position from DB for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2271" x2="2313" y1="1191.8828" y2="1191.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2313" x2="2313" y1="1191.8828" y2="1204.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2272" x2="2313" y1="1204.8828" y2="1204.8828"/><polygon fill="#A80036" points="2282,1200.8828,2272,1204.8828,2282,1208.8828,2278,1204.8828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2278" y="1187.1406">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="2300" y="1187.1406">Calculates latest position by decrementing transfer for prepare</text><polygon fill="#A80036" points="3327.5,1229.8828,3337.5,1233.8828,3327.5,1237.8828,3331.5,1233.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2271" x2="3333.5" y1="1233.8828" y2="1233.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2278" y="1229.4512">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="2300" y="1229.4512">Request to persist latest position for DFSP1</text><polygon fill="#A80036" points="3350.5,1259.1934,3340.5,1263.1934,3350.5,1267.1934,3346.5,1263.1934" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1259.1934,3770.5,1263.1934,3760.5,1267.1934,3764.5,1263.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3344.5" x2="3766.5" y1="1263.1934" y2="1263.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3356.5" y="1258.7617">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="3378.5" y="1258.7617">Persists latest position to DB for DFSP1</text><polygon fill="#A80036" points="2282,1288.5039,2272,1292.5039,2282,1296.5039,2278,1292.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2276" x2="3338.5" y1="1292.5039" y2="1292.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2288" y="1288.0723">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2310" y="1288.0723">return success</text><polygon fill="#FFFF00" filter="url(#f153v6gr5wqhyk)" points="2276,1305.8145,2276,1544.8145,2496,1544.8145,2496,1315.8145,2486,1305.8145,2276,1305.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2486" x2="2486" y1="1305.8145" y2="1315.8145"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2496" x2="2486" y1="1315.8145" y2="1315.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2282" y="1323.3828">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2282" y="1338.6934">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2298" y="1354.0039">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2298" y="1369.3145">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2298" y="1384.625">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2298" y="1399.9355">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="2298" y="1415.2461">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2298" y="1430.5566">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2314" y="1445.8672">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="2330" y="1461.1777">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2330" y="1476.4883">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2330" y="1491.7988">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2314" y="1507.1094">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2298" y="1522.4199">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2282" y="1537.7305">}</text><polygon fill="#A80036" points="2695,1571.4727,2705,1575.4727,2695,1579.4727,2699,1575.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2266" x2="2701" y1="1575.4727" y2="1575.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2273" y="1571.041">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="2295" y="1571.041">Publishes Transfer event</text><polygon fill="#A80036" points="2901,1600.7832,2911,1604.7832,2901,1608.7832,2905,1604.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2707" x2="2907" y1="1604.7832" y2="1604.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2714" y="1600.3516">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="2736" y="1600.3516">Consumes Transfer event</text><polygon fill="#A80036" points="3523,1630.0938,3533,1634.0938,3523,1638.0938,3527,1634.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2913" x2="3529" y1="1634.0938" y2="1634.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2920" y="1629.6621">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="2942" y="1629.6621">Request to Transfer status to DB</text><polygon fill="#A80036" points="3546,1659.4043,3536,1663.4043,3546,1667.4043,3542,1663.4043" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1659.4043,3770.5,1663.4043,3760.5,1667.4043,3764.5,1663.4043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3540" x2="3766.5" y1="1663.4043" y2="1663.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3552" y="1658.9727">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="3574" y="1658.9727">return success</text><polygon fill="#A80036" points="2924,1688.7148,2914,1692.7148,2924,1696.7148,2920,1692.7148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2918" x2="3534" y1="1692.7148" y2="1692.7148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2930" y="1688.2832">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="2952" y="1688.2832">Persists Transfer status to DB</text><polygon fill="#FFFF00" filter="url(#f153v6gr5wqhyk)" points="2918,1706.0254,2918,1945.0254,3198,1945.0254,3198,1716.0254,3188,1706.0254,2918,1706.0254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3188" x2="3188" y1="1706.0254" y2="1716.0254"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3198" x2="3188" y1="1716.0254" y2="1716.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2924" y="1723.5938">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="1738.9043">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2940" y="1754.2148">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2940" y="1769.5254">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2940" y="1784.8359">to: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2940" y="1800.1465">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="2940" y="1815.457">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2940" y="1830.7676">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2956" y="1846.0781">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2972" y="1861.3887">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2972" y="1876.6992">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2972" y="1892.0098">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2956" y="1907.3203">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2940" y="1922.6309">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="1937.9414">}</text><polygon fill="#A80036" points="3196,1971.6836,3206,1975.6836,3196,1979.6836,3200,1975.6836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2913" x2="3202" y1="1975.6836" y2="1975.6836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2920" y="1971.252">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="2942" y="1971.252">Publishes Notifications event for DFSP1</text><polygon fill="#FFFF00" filter="url(#f153v6gr5wqhyk)" points="2918,1988.9941,2918,2227.9941,3198,2227.9941,3198,1998.9941,3188,1988.9941,2918,1988.9941" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3188" x2="3188" y1="1988.9941" y2="1998.9941"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3198" x2="3188" y1="1998.9941" y2="1998.9941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2924" y="2006.5625">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="2021.873">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2940" y="2037.1836">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2940" y="2052.4941">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2940" y="2067.8047">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2940" y="2083.1152">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="2940" y="2098.4258">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2940" y="2113.7363">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2956" y="2129.0469">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2972" y="2144.3574">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2972" y="2159.668">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2972" y="2174.9785">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2956" y="2190.2891">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2940" y="2205.5996">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="2220.9102">}</text><polygon fill="#A80036" points="3196,2254.6523,3206,2258.6523,3196,2262.6523,3200,2258.6523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2913" x2="3202" y1="2258.6523" y2="2258.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2920" y="2254.2207">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="2942" y="2254.2207">Publishes Notifications event for DFSP2</text><polygon fill="#A80036" points="543,2283.9629,533,2287.9629,543,2291.9629,539,2287.9629" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="3207" y1="2287.9629" y2="2287.9629"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2283.5313">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="2283.5313">Consumes Notifications event</text><polygon fill="#A80036" points="1046,2313.2734,1056,2317.2734,1046,2321.2734,1050,2317.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="2317.2734" y2="2317.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2312.8418">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="2312.8418">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="1069,2342.584,1059,2346.584,1069,2350.584,1065,2346.584" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3642.5,2342.584,3652.5,2346.584,3642.5,2350.584,3646.5,2346.584" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3648.5" y1="2346.584" y2="2346.584"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2342.1523">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2342.1523">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="543,2371.8945,533,2375.8945,543,2379.8945,539,2375.8945" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="2375.8945" y2="2375.8945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2371.4629">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="2371.4629">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,2401.2051,68.5,2405.2051,78.5,2409.2051,74.5,2405.2051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="521" y1="2405.2051" y2="2405.2051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="2400.7734">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="2400.7734">HTTP Callback with Prepare result to DFSP1</text><polygon fill="#A80036" points="1046,2430.5156,1056,2434.5156,1046,2438.5156,1050,2434.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="2434.5156" y2="2434.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2430.084">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="2430.084">Requests Notification details for DFSP2 - GET - HTTP://notifications/DFPS2</text><polygon fill="#A80036" points="1069,2459.8262,1059,2463.8262,1069,2467.8262,1065,2463.8262" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3642.5,2459.8262,3652.5,2463.8262,3642.5,2467.8262,3646.5,2463.8262" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3648.5" y1="2463.8262" y2="2463.8262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2459.3945">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2459.3945">Fetches Notifications details for DFSP2</text><polygon fill="#A80036" points="543,2489.1367,533,2493.1367,543,2497.1367,539,2493.1367" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="2493.1367" y2="2493.1367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2488.7051">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="2488.7051">Returns Notifications details for DFSP2</text><polygon fill="#A80036" points="137.5,2518.4473,127.5,2522.4473,137.5,2526.4473,133.5,2522.4473" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="526" y1="2522.4473" y2="2522.4473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2518.0156">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="165.5" y="2518.0156">HTTP Callback with Prepare result to DFSP2</text><!--
@startuml
' declate title
title 1.1 DFSP1 sends a Prepare Transfer request to DFSP2

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt DFSP1 sends a Prepare Transfer request to DFSP2
    activate MLAPI
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    type: prepare,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    type: position,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    POS_HANDLER <-> DB: Retrieves latest position from DB for DFSP1
    POS_HANDLER <-> POS_HANDLER: Calculates latest position by decrementing transfer for prepare
    POS_HANDLER -> POS_DAO: Request to persist latest position for DFSP1
    POS_DAO <-> DB: Persists latest position to DB for DFSP1
    POS_DAO -> POS_HANDLER: return success
    note right of POS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    type: transfer,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    POS_HANDLER -> TOPIC_TRANSFERS: Publishes Transfer event
    deactivate POS_HANDLER
    deactivate TRANS_HANDLER
    TOPIC_TRANSFERS -> TRANS_HANDLER: Consumes Transfer event
    TRANS_HANDLER -> TRANS_DAO: Request to Transfer status to DB
    TRANS_DAO <-> DB: return success
    TRANS_DAO -> TRANS_HANDLER: Persists Transfer status to DB
    note right of TRANS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp1,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    type: notification,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP1
    note right of TRANS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    type: notification,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP2
    deactivate TRANS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP2 - GET - HTTP://notifications/DFPS2
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP2
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP2
    NOTIFY_HANDLER -> DFSP2: HTTP Callback with Prepare result to DFSP2
    deactivate NOTIFY_HANDLER
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>