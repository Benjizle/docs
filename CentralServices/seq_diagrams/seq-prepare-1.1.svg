<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2856px" preserveAspectRatio="none" style="width:3841px;height:2856px;" version="1.1" viewBox="0 0 3841 2856" width="3841px" zoomAndPan="magnify"><defs><filter height="300%" id="f1d9xdvdezgbpt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="385" x="1729.25" y="23.5352">1.1 DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#ADD8E6" height="2811.4844" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="2811.4844" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2811.4844" style="stroke: #A80036; stroke-width: 1.0;" width="2837.5" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2355.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="459.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="263.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2470.3789"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="469.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="607.1191"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="649.0059" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2261" y="1076.9512"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="2588.1973" style="stroke: #000000; stroke-width: 2.0;" width="3797.5" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1219" x2="1219" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1603" x2="1603" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1932" x2="1932" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2266" x2="2266" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2707" x2="2707" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2912.5" x2="2912.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3207.5" x2="3207.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3339.5" x2="3339.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3436.5" x2="3436.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3534.5" x2="3534.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3654.5" x2="3654.5" y1="137.2871" y2="2759.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3772.5" x2="3772.5" y1="137.2871" y2="2759.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2772.0195">DFSP1</text><ellipse cx="67.5" cy="2784.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2792.9727 L67.5,2819.9727 M54.5,2800.9727 L80.5,2800.9727 M67.5,2819.9727 L54.5,2834.9727 M67.5,2819.9727 L80.5,2834.9727 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2772.0195">DFSP2</text><ellipse cx="126.5" cy="2784.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2792.9727 L126.5,2819.9727 M113.5,2800.9727 L139.5,2800.9727 M126.5,2819.9727 L113.5,2834.9727 M126.5,2819.9727 L139.5,2834.9727 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2772.0195">ML API Adapter</text><path d="M325,2778.9727 L325,2802.9727 M325,2790.9727 L342,2790.9727 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="2772.0195">ML API Notification Event Handler</text><ellipse cx="527" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,2778.9727,529,2773.9727,527,2778.9727,529,2783.9727,523,2778.9727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="2772.0195">Central Service API</text><path d="M1037.5,2778.9727 L1037.5,2802.9727 M1037.5,2790.9727 L1054.5,2790.9727 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1139" y="2758.4844"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1135" y="2762.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="2783.0195">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="134.334">Prepare Event Handler</text><ellipse cx="1603" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,92.7988,1605,87.7988,1603,92.7988,1605,97.7988,1599,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1524" y="2772.0195">Prepare Event Handler</text><ellipse cx="1603" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1599,2778.9727,1605,2773.9727,1603,2778.9727,1605,2783.9727,1599,2778.9727" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1851" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1847" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1854" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1851" y="2758.4844"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="1847" y="2762.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="1854" y="2783.0195">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2186" y="134.334">Position Event Handler</text><ellipse cx="2266" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2262,92.7988,2268,87.7988,2266,92.7988,2268,97.7988,2262,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2186" y="2772.0195">Position Event Handler</text><ellipse cx="2266" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2262,2778.9727,2268,2773.9727,2266,2778.9727,2268,2783.9727,2262,2778.9727" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2648" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2644" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2651" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2648" y="2758.4844"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="2644" y="2762.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="2651" y="2783.0195">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2831.5" y="134.334">Transfer Event Handler</text><ellipse cx="2913" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2909,92.7988,2915,87.7988,2913,92.7988,2915,97.7988,2909,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2831.5" y="2772.0195">Transfer Event Handler</text><ellipse cx="2913" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2909,2778.9727,2915,2773.9727,2913,2778.9727,2915,2783.9727,2909,2778.9727" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3138.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3134.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3141.5" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3138.5" y="2758.4844"/><rect fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3134.5" y="2762.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3141.5" y="2783.0195">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3291.5" y="134.334">Position DAO</text><ellipse cx="3339.5" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3327.5" x2="3351.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3291.5" y="2772.0195">Position DAO</text><ellipse cx="3339.5" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3327.5" x2="3351.5" y1="2804.9727" y2="2804.9727"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3397.5" y="134.334">Event DAO</text><ellipse cx="3436.5" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3424.5" x2="3448.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3397.5" y="2772.0195">Event DAO</text><ellipse cx="3436.5" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3424.5" x2="3448.5" y1="2804.9727" y2="2804.9727"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3485.5" y="134.334">Transfer DAO</text><ellipse cx="3535" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3523" x2="3547" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3485.5" y="2772.0195">Transfer DAO</text><ellipse cx="3535" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3523" x2="3547" y1="2804.9727" y2="2804.9727"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3594.5" y="134.334">Notification DAO</text><ellipse cx="3654.5" cy="104.7988" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3642.5" x2="3666.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3594.5" y="2772.0195">Notification DAO</text><ellipse cx="3654.5" cy="2790.9727" fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3642.5" x2="3666.5" y1="2804.9727" y2="2804.9727"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3724.5" y="134.334">Central Store</text><path d="M3754.5,84.7988 C3754.5,74.7988 3772.5,74.7988 3772.5,74.7988 C3772.5,74.7988 3790.5,74.7988 3790.5,84.7988 L3790.5,110.7988 C3790.5,120.7988 3772.5,120.7988 3772.5,120.7988 C3772.5,120.7988 3754.5,120.7988 3754.5,110.7988 L3754.5,84.7988 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3754.5,84.7988 C3754.5,94.7988 3772.5,94.7988 3772.5,94.7988 C3772.5,94.7988 3790.5,94.7988 3790.5,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3724.5" y="2772.0195">Central Store</text><path d="M3754.5,2784.9727 C3754.5,2774.9727 3772.5,2774.9727 3772.5,2774.9727 C3772.5,2774.9727 3790.5,2774.9727 3790.5,2784.9727 L3790.5,2810.9727 C3790.5,2820.9727 3772.5,2820.9727 3772.5,2820.9727 C3772.5,2820.9727 3754.5,2820.9727 3754.5,2810.9727 L3754.5,2784.9727 " fill="#FEFECE" filter="url(#f1d9xdvdezgbpt)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3754.5,2784.9727 C3754.5,2794.9727 3772.5,2794.9727 3772.5,2794.9727 C3772.5,2794.9727 3790.5,2794.9727 3790.5,2784.9727 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="459.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="263.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="2470.3789"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="469.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1598" y="607.1191"/><rect fill="#FFFFFF" filter="url(#f1d9xdvdezgbpt)" height="649.0059" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2261" y="1076.9512"/><rect fill="none" height="2588.1973" style="stroke: #000000; stroke-width: 2.0;" width="3797.5" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="110" y="166.9219">[DFSP1 sends a Prepare Transfer request to DFSP2]</text><polygon fill="#A80036" points="328.5,188.5977,338.5,192.5977,328.5,196.5977,332.5,192.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="192.5977" y2="192.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="188.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="188.166">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#f1d9xdvdezgbpt)" points="355,205.9082,355,475.9082,615,475.9082,615,215.9082,605,205.9082,355,205.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="605" x2="605" y1="205.9082" y2="215.9082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="615" x2="605" y1="215.9082" y2="215.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="223.4766">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="238.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="254.0977">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="377" y="269.4082">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="377" y="284.7188">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="300.0293">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="315.3398">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="330.6504">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="345.9609">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="361.2715">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="409" y="376.582">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="391.8926">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="407.2031">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="409" y="422.5137">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="437.8242">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="453.1348">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="468.4453">}</text><polygon fill="#A80036" points="1207,502.1875,1217,506.1875,1207,510.1875,1211,506.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1213" y1="506.1875" y2="506.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="501.7559">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="501.7559">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1261" y1="535.8086" y2="535.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1261" x2="1261" y1="535.8086" y2="548.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1220" x2="1261" y1="548.8086" y2="548.8086"/><polygon fill="#A80036" points="1230,544.8086,1220,548.8086,1230,552.8086,1226,548.8086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="531.0664">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1239" y="531.0664">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,573.8086,351.5,577.8086,361.5,581.8086,357.5,577.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1218" y1="577.8086" y2="577.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="573.377">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="573.377">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,603.1191,68.5,607.1191,78.5,611.1191,74.5,607.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="607.1191" y2="607.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="602.6875">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="602.6875">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1586,632.4297,1596,636.4297,1586,640.4297,1590,636.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1219" x2="1592" y1="636.4297" y2="636.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1226" y="631.998">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1239" y="631.998">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="666.0508" y2="666.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="666.0508" y2="679.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="679.0508" y2="679.0508"/><polygon fill="#A80036" points="1619,675.0508,1609,679.0508,1619,683.0508,1615,679.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="661.3086">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1628" y="661.3086">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="708.3613" y2="708.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="708.3613" y2="721.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="721.3613" y2="721.3613"/><polygon fill="#A80036" points="1619,717.3613,1609,721.3613,1619,725.3613,1615,721.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="703.6191">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1628" y="703.6191">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1608" x2="1650" y1="750.6719" y2="750.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="750.6719" y2="763.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1609" x2="1650" y1="763.6719" y2="763.6719"/><polygon fill="#A80036" points="1619,759.6719,1609,763.6719,1619,767.6719,1615,763.6719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1615" y="745.9297">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1628" y="745.9297">Validates message signature</text><polygon fill="#FFFF00" filter="url(#f1d9xdvdezgbpt)" points="1613,776.6719,1613,1046.6719,1873,1046.6719,1873,786.6719,1863,776.6719,1613,776.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1863" x2="1863" y1="776.6719" y2="786.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1873" x2="1863" y1="786.6719" y2="786.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1619" y="794.2402">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="809.5508">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1635" y="824.8613">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1635" y="840.1719">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1635" y="855.4824">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1635" y="870.793">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1635" y="886.1035">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1635" y="901.4141">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1651" y="916.7246">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1667" y="932.0352">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1667" y="947.3457">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1667" y="962.6563">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1667" y="977.9668">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="1667" y="993.2773">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1651" y="1008.5879">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1635" y="1023.8984">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1619" y="1039.209">}</text><polygon fill="#A80036" points="1920,1072.9512,1930,1076.9512,1920,1080.9512,1924,1076.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1926" y1="1076.9512" y2="1076.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1610" y="1072.5195">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1632" y="1072.5195">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="2249,1102.2617,2259,1106.2617,2249,1110.2617,2253,1106.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1932" x2="2255" y1="1106.2617" y2="1106.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1939" y="1101.8301">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1961" y="1101.8301">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="3424.5,1131.5723,3434.5,1135.5723,3424.5,1139.5723,3428.5,1135.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2271" x2="3430.5" y1="1135.5723" y2="1135.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2278" y="1131.1406">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="2300" y="1131.1406">Request to persist event information</text><polygon fill="#A80036" points="3447.5,1160.8828,3437.5,1164.8828,3447.5,1168.8828,3443.5,1164.8828" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1160.8828,3770.5,1164.8828,3760.5,1168.8828,3764.5,1164.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3441.5" x2="3766.5" y1="1164.8828" y2="1164.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3453.5" y="1160.4512">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3475.5" y="1160.4512">Persist event information</text><polygon fill="#A80036" points="2282,1190.1934,2272,1194.1934,2282,1198.1934,2278,1194.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2276" x2="3435.5" y1="1194.1934" y2="1194.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2288" y="1189.7617">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2310" y="1189.7617">return success</text><polygon fill="#A80036" points="3327.5,1219.5039,3337.5,1223.5039,3327.5,1227.5039,3331.5,1223.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2271" x2="3333.5" y1="1223.5039" y2="1223.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2278" y="1219.0723">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="2300" y="1219.0723">Request latest position from DB for DFSP1</text><polygon fill="#A80036" points="3350.5,1248.8145,3340.5,1252.8145,3350.5,1256.8145,3346.5,1252.8145" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1248.8145,3770.5,1252.8145,3760.5,1256.8145,3764.5,1252.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3344.5" x2="3766.5" y1="1252.8145" y2="1252.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3356.5" y="1248.3828">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="3378.5" y="1248.3828">Retrieves latest position from DB for DFSP1</text><polygon fill="#A80036" points="2282,1278.125,2272,1282.125,2282,1286.125,2278,1282.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2276" x2="3338.5" y1="1282.125" y2="1282.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2288" y="1277.6934">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="2310" y="1277.6934">Return success</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2271" x2="2313" y1="1311.7461" y2="1311.7461"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2313" x2="2313" y1="1311.7461" y2="1324.7461"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2272" x2="2313" y1="1324.7461" y2="1324.7461"/><polygon fill="#A80036" points="2282,1320.7461,2272,1324.7461,2282,1328.7461,2278,1324.7461" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2278" y="1307.0039">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="2300" y="1307.0039">Calculates latest position by decrementing transfer for prepare</text><polygon fill="#A80036" points="3327.5,1349.7461,3337.5,1353.7461,3327.5,1357.7461,3331.5,1353.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2271" x2="3333.5" y1="1353.7461" y2="1353.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2278" y="1349.3145">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="2300" y="1349.3145">Request to persist latest position for DFSP1</text><polygon fill="#A80036" points="3350.5,1379.0566,3340.5,1383.0566,3350.5,1387.0566,3346.5,1383.0566" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1379.0566,3770.5,1383.0566,3760.5,1387.0566,3764.5,1383.0566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3344.5" x2="3766.5" y1="1383.0566" y2="1383.0566"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3356.5" y="1378.625">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="3378.5" y="1378.625">Persists latest position to DB for DFSP1</text><polygon fill="#A80036" points="2282,1408.3672,2272,1412.3672,2282,1416.3672,2278,1412.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2276" x2="3338.5" y1="1412.3672" y2="1412.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2288" y="1407.9355">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2310" y="1407.9355">return success</text><polygon fill="#FFFF00" filter="url(#f1d9xdvdezgbpt)" points="2276,1425.6777,2276,1695.6777,2536,1695.6777,2536,1435.6777,2526,1425.6777,2276,1425.6777" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2526" x2="2526" y1="1425.6777" y2="1435.6777"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2536" x2="2526" y1="1435.6777" y2="1435.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2282" y="1443.2461">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2282" y="1458.5566">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2298" y="1473.8672">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2298" y="1489.1777">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2298" y="1504.4883">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2298" y="1519.7988">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="2298" y="1535.1094">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2298" y="1550.4199">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2314" y="1565.7305">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="2330" y="1581.041">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="2330" y="1596.3516">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="2330" y="1611.6621">type: transfer,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2330" y="1626.9727">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2330" y="1642.2832">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2314" y="1657.5938">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2298" y="1672.9043">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2282" y="1688.2148">}</text><polygon fill="#A80036" points="2695,1721.957,2705,1725.957,2695,1729.957,2699,1725.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2266" x2="2701" y1="1725.957" y2="1725.957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2273" y="1721.5254">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="2295" y="1721.5254">Publishes Transfer event</text><polygon fill="#A80036" points="2901,1751.2676,2911,1755.2676,2901,1759.2676,2905,1755.2676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2707" x2="2907" y1="1755.2676" y2="1755.2676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2714" y="1750.8359">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="2736" y="1750.8359">Consumes Transfer event</text><polygon fill="#A80036" points="3523,1780.5781,3533,1784.5781,3523,1788.5781,3527,1784.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2913" x2="3529" y1="1784.5781" y2="1784.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2920" y="1780.1465">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="2942" y="1780.1465">Request to Transfer status to DB</text><polygon fill="#A80036" points="3546,1809.8887,3536,1813.8887,3546,1817.8887,3542,1813.8887" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3760.5,1809.8887,3770.5,1813.8887,3760.5,1817.8887,3764.5,1813.8887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3540" x2="3766.5" y1="1813.8887" y2="1813.8887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3552" y="1809.457">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="3574" y="1809.457">return success</text><polygon fill="#A80036" points="2924,1839.1992,2914,1843.1992,2924,1847.1992,2920,1843.1992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2918" x2="3534" y1="1843.1992" y2="1843.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2930" y="1838.7676">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="2952" y="1838.7676">Persists Transfer status to DB</text><polygon fill="#FFFF00" filter="url(#f1d9xdvdezgbpt)" points="2918,1856.5098,2918,2126.5098,3198,2126.5098,3198,1866.5098,3188,1856.5098,2918,1856.5098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3188" x2="3188" y1="1856.5098" y2="1866.5098"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3198" x2="3188" y1="1866.5098" y2="1866.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2924" y="1874.0781">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="1889.3887">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2940" y="1904.6992">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2940" y="1920.0098">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2940" y="1935.3203">to: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2940" y="1950.6309">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="2940" y="1965.9414">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2940" y="1981.252">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2956" y="1996.5625">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="2972" y="2011.873">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="2972" y="2027.1836">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2972" y="2042.4941">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2972" y="2057.8047">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2972" y="2073.1152">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2956" y="2088.4258">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2940" y="2103.7363">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="2119.0469">}</text><polygon fill="#A80036" points="3196,2152.7891,3206,2156.7891,3196,2160.7891,3200,2156.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2913" x2="3202" y1="2156.7891" y2="2156.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2920" y="2152.3574">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="2942" y="2152.3574">Publishes Notifications event for DFSP1</text><polygon fill="#FFFF00" filter="url(#f1d9xdvdezgbpt)" points="2918,2170.0996,2918,2440.0996,3198,2440.0996,3198,2180.0996,3188,2170.0996,2918,2170.0996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3188" x2="3188" y1="2170.0996" y2="2180.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3198" x2="3188" y1="2180.0996" y2="2180.0996"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2924" y="2187.668">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="2202.9785">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2940" y="2218.2891">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2940" y="2233.5996">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2940" y="2248.9102">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2940" y="2264.2207">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="2940" y="2279.5313">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2940" y="2294.8418">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2956" y="2310.1523">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="2972" y="2325.4629">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="2972" y="2340.7734">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2972" y="2356.084">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2972" y="2371.3945">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2972" y="2386.7051">createAt: &lt;timestamp&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2956" y="2402.0156">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2940" y="2417.3262">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2924" y="2432.6367">}</text><polygon fill="#A80036" points="3196,2466.3789,3206,2470.3789,3196,2474.3789,3200,2470.3789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2913" x2="3202" y1="2470.3789" y2="2470.3789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2920" y="2465.9473">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="2942" y="2465.9473">Publishes Notifications event for DFSP2</text><polygon fill="#A80036" points="543,2495.6895,533,2499.6895,543,2503.6895,539,2499.6895" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="3207" y1="2499.6895" y2="2499.6895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2495.2578">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="2495.2578">Consumes Notifications event</text><polygon fill="#A80036" points="1046,2525,1056,2529,1046,2533,1050,2529" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="2529" y2="2529"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2524.5684">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="2524.5684">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="1069,2554.3105,1059,2558.3105,1069,2562.3105,1065,2558.3105" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3642.5,2554.3105,3652.5,2558.3105,3642.5,2562.3105,3646.5,2558.3105" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3648.5" y1="2558.3105" y2="2558.3105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2553.8789">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2553.8789">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="543,2583.6211,533,2587.6211,543,2591.6211,539,2587.6211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="2587.6211" y2="2587.6211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2583.1895">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="2583.1895">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,2612.9316,68.5,2616.9316,78.5,2620.9316,74.5,2616.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="521" y1="2616.9316" y2="2616.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="2612.5">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="2612.5">HTTP Callback with Prepare result to DFSP1</text><polygon fill="#A80036" points="1046,2642.2422,1056,2646.2422,1046,2650.2422,1050,2646.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="2646.2422" y2="2646.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="2641.8105">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="2641.8105">Requests Notification details for DFSP2 - GET - HTTP://notifications/DFPS2</text><polygon fill="#A80036" points="1069,2671.5527,1059,2675.5527,1069,2679.5527,1065,2675.5527" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3642.5,2671.5527,3652.5,2675.5527,3642.5,2679.5527,3646.5,2675.5527" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3648.5" y1="2675.5527" y2="2675.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="2671.1211">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="2671.1211">Fetches Notifications details for DFSP2</text><polygon fill="#A80036" points="543,2700.8633,533,2704.8633,543,2708.8633,539,2704.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="2704.8633" y2="2704.8633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="2700.4316">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="2700.4316">Returns Notifications details for DFSP2</text><polygon fill="#A80036" points="137.5,2730.1738,127.5,2734.1738,137.5,2738.1738,133.5,2734.1738" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="526" y1="2734.1738" y2="2734.1738"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2729.7422">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="165.5" y="2729.7422">HTTP Callback with Prepare result to DFSP2</text><!--
@startuml
' declate title
title 1.1 DFSP1 sends a Prepare Transfer request to DFSP2

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt DFSP1 sends a Prepare Transfer request to DFSP2
    activate MLAPI
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: prepare,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: position,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    POS_HANDLER -> POS_DAO: Request latest position from DB for DFSP1
    POS_DAO <-> DB: Retrieves latest position from DB for DFSP1
    POS_DAO -> POS_HANDLER: Return success
    POS_HANDLER <-> POS_HANDLER: Calculates latest position by decrementing transfer for prepare
    POS_HANDLER -> POS_DAO: Request to persist latest position for DFSP1
    POS_DAO <-> DB: Persists latest position to DB for DFSP1
    POS_DAO -> POS_HANDLER: return success
    note right of POS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: transfer,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    POS_HANDLER -> TOPIC_TRANSFERS: Publishes Transfer event
    deactivate POS_HANDLER
    deactivate TRANS_HANDLER
    TOPIC_TRANSFERS -> TRANS_HANDLER: Consumes Transfer event
    TRANS_HANDLER -> TRANS_DAO: Request to Transfer status to DB
    TRANS_DAO <-> DB: return success
    TRANS_DAO -> TRANS_HANDLER: Persists Transfer status to DB
    note right of TRANS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp1,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP1
    note right of TRANS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createAt: <timestamp>
                }
            }
        }
    end note
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications event for DFSP2
    deactivate TRANS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP2 - GET - HTTP://notifications/DFPS2
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP2
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP2
    NOTIFY_HANDLER -> DFSP2: HTTP Callback with Prepare result to DFSP2
    deactivate NOTIFY_HANDLER
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>