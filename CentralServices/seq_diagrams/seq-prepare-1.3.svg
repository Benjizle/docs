<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1750px" preserveAspectRatio="none" style="width:3818px;height:1750px;" version="1.1" viewBox="0 0 3818 1750" width="3818px" zoomAndPan="magnify"><defs><filter height="300%" id="f18qg2xm9ak642" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="580" x="1619.5" y="23.5352">1.3. DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Position Failure</text><rect fill="#ADD8E6" height="1704.7832" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#90EE90" height="1704.7832" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1704.7832" style="stroke: #A80036; stroke-width: 1.0;" width="2778" x="987" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2325.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="1496.4961" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="162.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="1480.9199"/><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="423.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1628.5" y="561.1875"/><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="495.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2291.5" y="985.0879"/><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="1481.4961" style="stroke: #000000; stroke-width: 2.0;" width="3738" x="33" y="154.2871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058" x2="1058" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1249" x2="1249" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1633.5" x2="1633.5" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1962" x2="1962" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2296.5" x2="2296.5" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2737" x2="2737" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2922" x2="2922" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3118" x2="3118" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3280" x2="3280" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3377" x2="3377" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3475" x2="3475" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3595" x2="3595" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3713" x2="3713" y1="137.2871" y2="1652.7832"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3791" x2="3791" y1="137.2871" y2="1652.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="1665.3184">DFSP1</text><ellipse cx="67.5" cy="1678.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,1686.2715 L67.5,1713.2715 M54.5,1694.2715 L80.5,1694.2715 M67.5,1713.2715 L54.5,1728.2715 M67.5,1713.2715 L80.5,1728.2715 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="1665.3184">DFSP2</text><ellipse cx="126.5" cy="1678.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,1686.2715 L126.5,1713.2715 M113.5,1694.2715 L139.5,1694.2715 M126.5,1713.2715 L113.5,1728.2715 M126.5,1713.2715 L139.5,1728.2715 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="1665.3184">ML API Adapter</text><path d="M325,1672.2715 L325,1696.2715 M325,1684.2715 L342,1684.2715 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="1665.3184">ML API Notification Event Handler</text><ellipse cx="527" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,1672.2715,529,1667.2715,527,1672.2715,529,1677.2715,523,1672.2715" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="134.334">Central Service API</text><path d="M1037.5,92.7988 L1037.5,116.7988 M1037.5,104.7988 L1054.5,104.7988 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="991" y="1665.3184">Central Service API</text><path d="M1037.5,1672.2715 L1037.5,1696.2715 M1037.5,1684.2715 L1054.5,1684.2715 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1066.5" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1139" y="97.7988"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1135" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="1142" y="122.334">Prepare-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1139" y="1651.7832"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="1135" y="1655.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="1142" y="1676.3184">Prepare-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1554.5" y="134.334">Prepare Event Handler</text><ellipse cx="1633.5" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1629.5,92.7988,1635.5,87.7988,1633.5,92.7988,1635.5,97.7988,1629.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1554.5" y="1665.3184">Prepare Event Handler</text><ellipse cx="1633.5" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1629.5,1672.2715,1635.5,1667.2715,1633.5,1672.2715,1635.5,1677.2715,1629.5,1672.2715" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1851" y="97.7988"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1847" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="1854" y="122.334">Position-Topic-handler-dfsp1</text><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1851" y="1651.7832"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1847" y="1655.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="1854" y="1676.3184">Position-Topic-handler-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2216.5" y="134.334">Position Event Handler</text><ellipse cx="2296.5" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2292.5,92.7988,2298.5,87.7988,2296.5,92.7988,2298.5,97.7988,2292.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2216.5" y="1665.3184">Position Event Handler</text><ellipse cx="2296.5" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2292.5,1672.2715,2298.5,1667.2715,2296.5,1672.2715,2298.5,1677.2715,2292.5,1672.2715" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2648" y="97.7988"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2644" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="2651" y="122.334">Transfer-Topic-handler</text><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2648" y="1651.7832"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="2644" y="1655.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="2651" y="1676.3184">Transfer-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2841" y="134.334">Transfer Event Handler</text><ellipse cx="2922.5" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2918.5,92.7988,2924.5,87.7988,2922.5,92.7988,2924.5,97.7988,2918.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2841" y="1665.3184">Transfer Event Handler</text><ellipse cx="2922.5" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2918.5,1672.2715,2924.5,1667.2715,2922.5,1672.2715,2924.5,1677.2715,2918.5,1672.2715" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="3018" y="97.7988"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="3014" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="3021" y="122.334">Notification-Topic-handler</text><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="3018" y="1651.7832"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="200" x="3014" y="1655.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="186" x="3021" y="1676.3184">Notification-Topic-handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3232" y="134.334">Position DAO</text><ellipse cx="3280" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3268" x2="3292" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3232" y="1665.3184">Position DAO</text><ellipse cx="3280" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3268" x2="3292" y1="1698.2715" y2="1698.2715"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3338" y="134.334">Event DAO</text><ellipse cx="3377" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3365" x2="3389" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3338" y="1665.3184">Event DAO</text><ellipse cx="3377" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3365" x2="3389" y1="1698.2715" y2="1698.2715"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3426" y="134.334">Transfer DAO</text><ellipse cx="3475.5" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3463.5" x2="3487.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3426" y="1665.3184">Transfer DAO</text><ellipse cx="3475.5" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3463.5" x2="3487.5" y1="1698.2715" y2="1698.2715"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3535" y="134.334">Notification DAO</text><ellipse cx="3595" cy="104.7988" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3583" x2="3607" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3535" y="1665.3184">Notification DAO</text><ellipse cx="3595" cy="1684.2715" fill="#FEFECE" filter="url(#f18qg2xm9ak642)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3583" x2="3607" y1="1698.2715" y2="1698.2715"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3665" y="134.334">Central Store</text><path d="M3695,84.7988 C3695,74.7988 3713,74.7988 3713,74.7988 C3713,74.7988 3731,74.7988 3731,84.7988 L3731,110.7988 C3731,120.7988 3713,120.7988 3713,120.7988 C3713,120.7988 3695,120.7988 3695,110.7988 L3695,84.7988 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3695,84.7988 C3695,94.7988 3713,94.7988 3713,94.7988 C3713,94.7988 3731,94.7988 3731,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3665" y="1665.3184">Central Store</text><path d="M3695,1678.2715 C3695,1668.2715 3713,1668.2715 3713,1668.2715 C3713,1668.2715 3731,1668.2715 3731,1678.2715 L3731,1704.2715 C3731,1714.2715 3713,1714.2715 3713,1714.2715 C3713,1714.2715 3695,1714.2715 3695,1704.2715 L3695,1678.2715 " fill="#FEFECE" filter="url(#f18qg2xm9ak642)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M3695,1678.2715 C3695,1688.2715 3713,1688.2715 3713,1688.2715 C3713,1688.2715 3731,1688.2715 3731,1678.2715 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="36" x="3771" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="3778" y="122.334">API</text><rect fill="#FEFECE" filter="url(#f18qg2xm9ak642)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="36" x="3771" y="1651.7832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="3778" y="1672.3184">API</text><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="1496.4961" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="162.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="1480.9199"/><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="423.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1628.5" y="561.1875"/><rect fill="#FFFFFF" filter="url(#f18qg2xm9ak642)" height="495.832" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2291.5" y="985.0879"/><rect fill="none" height="1481.4961" style="stroke: #000000; stroke-width: 2.0;" width="3738" x="33" y="154.2871"/><polygon fill="#EEEEEE" points="33,154.2871,95,154.2871,95,161.2871,85,171.2871,33,171.2871,33,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="110" y="166.9219">[Prepare Position Failure]</text><polygon fill="#A80036" points="328.5,188.5977,338.5,192.5977,328.5,196.5977,332.5,192.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="192.5977" y2="192.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="188.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="188.166">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#f18qg2xm9ak642)" points="355,205.9082,355,429.9082,575,429.9082,575,215.9082,565,205.9082,355,205.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="565" y1="205.9082" y2="215.9082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="575" x2="565" y1="215.9082" y2="215.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="223.4766">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="238.7871">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="254.0977">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="377" y="269.4082">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="377" y="284.7188">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="300.0293">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="315.3398">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="330.6504">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="345.9609">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="361.2715">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="409" y="376.582">action: prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="391.8926">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="407.2031">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="422.5137">}</text><polygon fill="#A80036" points="1237.5,456.2559,1247.5,460.2559,1237.5,464.2559,1241.5,460.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1243.5" y1="460.2559" y2="460.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="455.8242">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="370.5" y="455.8242">Routes &amp; Publishes Prepare event for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1249.5" x2="1291.5" y1="489.877" y2="489.877"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1291.5" x2="1291.5" y1="489.877" y2="502.877"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1250.5" x2="1291.5" y1="502.877" y2="502.877"/><polygon fill="#A80036" points="1260.5,498.877,1250.5,502.877,1260.5,506.877,1256.5,502.877" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1256.5" y="485.1348">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1269.5" y="485.1348">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,527.877,351.5,531.877,361.5,535.877,357.5,531.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1248.5" y1="531.877" y2="531.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="527.4453">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="527.4453">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,557.1875,68.5,561.1875,78.5,565.1875,74.5,561.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="339.5" y1="561.1875" y2="561.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="556.7559">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="556.7559">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1616.5,586.498,1626.5,590.498,1616.5,594.498,1620.5,590.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1249.5" x2="1622.5" y1="590.498" y2="590.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1256.5" y="586.0664">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1269.5" y="586.0664">Consumes Prepare event message for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1638.5" x2="1680.5" y1="620.1191" y2="620.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680.5" x2="1680.5" y1="620.1191" y2="633.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639.5" x2="1680.5" y1="633.1191" y2="633.1191"/><polygon fill="#A80036" points="1649.5,629.1191,1639.5,633.1191,1649.5,637.1191,1645.5,633.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1645.5" y="615.377">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1658.5" y="615.377">Validates from - DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1638.5" x2="1680.5" y1="662.4297" y2="662.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680.5" x2="1680.5" y1="662.4297" y2="675.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639.5" x2="1680.5" y1="675.4297" y2="675.4297"/><polygon fill="#A80036" points="1649.5,671.4297,1639.5,675.4297,1649.5,679.4297,1645.5,675.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1645.5" y="657.6875">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="1658.5" y="657.6875">Validates to - DFSP2</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1638.5" x2="1680.5" y1="704.7402" y2="704.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680.5" x2="1680.5" y1="704.7402" y2="717.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639.5" x2="1680.5" y1="717.7402" y2="717.7402"/><polygon fill="#A80036" points="1649.5,713.7402,1639.5,717.7402,1649.5,721.7402,1645.5,717.7402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1645.5" y="699.998">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1658.5" y="699.998">Validates message signature</text><polygon fill="#FFFF00" filter="url(#f18qg2xm9ak642)" points="1643,730.7402,1643,954.7402,1863,954.7402,1863,740.7402,1853,730.7402,1643,730.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1853" x2="1853" y1="730.7402" y2="740.7402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1863" x2="1853" y1="740.7402" y2="740.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1649" y="748.3086">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1649" y="763.6191">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1665" y="778.9297">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1665" y="794.2402">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1665" y="809.5508">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1665" y="824.8613">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1665" y="840.1719">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1665" y="855.4824">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1681" y="870.793">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1697" y="886.1035">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="1697" y="901.4141">action: prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1681" y="916.7246">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1665" y="932.0352">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1649" y="947.3457">}</text><polygon fill="#A80036" points="1950.5,981.0879,1960.5,985.0879,1950.5,989.0879,1954.5,985.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1633.5" x2="1956.5" y1="985.0879" y2="985.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1640.5" y="980.6563">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="1662.5" y="980.6563">Routes &amp; Publishes Position event for DFSP1</text><polygon fill="#A80036" points="2279.5,1010.3984,2289.5,1014.3984,2279.5,1018.3984,2283.5,1014.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1962.5" x2="2285.5" y1="1014.3984" y2="1014.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1969.5" y="1009.9668">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1991.5" y="1009.9668">Consumes Position event message for DFSP1</text><polygon fill="#A80036" points="3365,1039.709,3375,1043.709,3365,1047.709,3369,1043.709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2301.5" x2="3371" y1="1043.709" y2="1043.709"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2308.5" y="1039.2773">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="2330.5" y="1039.2773">Request to persist event information</text><polygon fill="#A80036" points="3388,1069.0195,3378,1073.0195,3388,1077.0195,3384,1073.0195" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3701,1069.0195,3711,1073.0195,3701,1077.0195,3705,1073.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3382" x2="3707" y1="1073.0195" y2="1073.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3394" y="1068.5879">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3416" y="1068.5879">Persist event information</text><polygon fill="#A80036" points="2312.5,1098.3301,2302.5,1102.3301,2312.5,1106.3301,2308.5,1102.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2306.5" x2="3376" y1="1102.3301" y2="1102.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2318.5" y="1097.8984">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2340.5" y="1097.8984">return success</text><polygon fill="#A80036" points="2312.5,1127.6406,2302.5,1131.6406,2312.5,1135.6406,2308.5,1131.6406" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3701,1127.6406,3711,1131.6406,3701,1135.6406,3705,1131.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2306.5" x2="3707" y1="1131.6406" y2="1131.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2318.5" y="1127.209">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="2340.5" y="1127.209">Retrieves latest position from DB for DFSP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2301.5" x2="2343.5" y1="1161.2617" y2="1161.2617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2343.5" x2="2343.5" y1="1161.2617" y2="1174.2617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2302.5" x2="2343.5" y1="1174.2617" y2="1174.2617"/><polygon fill="#A80036" points="2312.5,1170.2617,2302.5,1174.2617,2312.5,1178.2617,2308.5,1174.2617" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2308.5" y="1156.5195">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="2330.5" y="1156.5195">Calculates latest position by decrementing transfer for prepare</text><polygon fill="#FF0000" filter="url(#f18qg2xm9ak642)" points="2306,1187.2617,2306,1212.2617,2438,1212.2617,2438,1197.2617,2428,1187.2617,2306,1187.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2428" x2="2428" y1="1187.2617" y2="1197.2617"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2438" x2="2428" y1="1197.2617" y2="1197.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="2312" y="1204.8301">Validation failure!</text><polygon fill="#FFFF00" filter="url(#f18qg2xm9ak642)" points="2306,1226.5723,2306,1450.5723,2586,1450.5723,2586,1236.5723,2576,1226.5723,2306,1226.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2576" x2="2576" y1="1226.5723" y2="1236.5723"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2586" x2="2576" y1="1236.5723" y2="1236.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2312" y="1244.1406">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2312" y="1259.4512">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2328" y="1274.7617">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2328" y="1290.0723">from: http://ledger/dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2328" y="1305.3828">to: http://ledger/dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2328" y="1320.6934">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="2328" y="1336.0039">content: &lt;transferResponseMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2328" y="1351.3145">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2344" y="1366.625">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2360" y="1381.9355">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="2360" y="1397.2461">action: prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2344" y="1412.5566">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2328" y="1427.8672">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2312" y="1443.1777">}</text><polygon fill="#A80036" points="3106,1476.9199,3116,1480.9199,3106,1484.9199,3110,1480.9199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2296.5" x2="3112" y1="1480.9199" y2="1480.9199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2303.5" y="1476.4883">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="2325.5" y="1476.4883">Publishes Notifications (Failure) event for DFSP2</text><polygon fill="#A80036" points="543,1506.2305,533,1510.2305,543,1514.2305,539,1510.2305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="3117" y1="1510.2305" y2="1510.2305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="1505.7988">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="1505.7988">Consumes Notifications event</text><polygon fill="#A80036" points="1046,1535.541,1056,1539.541,1046,1543.541,1050,1539.541" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1052" y1="1539.541" y2="1539.541"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="1535.1094">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="561" y="1535.1094">Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="1069,1564.8516,1059,1568.8516,1069,1572.8516,1065,1568.8516" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3583,1564.8516,3593,1568.8516,3583,1572.8516,3587,1568.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="3589" y1="1568.8516" y2="1568.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1075" y="1564.4199">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="1097" y="1564.4199">Fetches Notifications details for DFSP1</text><polygon fill="#A80036" points="543,1594.1621,533,1598.1621,543,1602.1621,539,1598.1621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1057" y1="1598.1621" y2="1598.1621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="1593.7305">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="571" y="1593.7305">Returns Notifications details for DFSP1</text><polygon fill="#A80036" points="78.5,1623.4727,68.5,1627.4727,78.5,1631.4727,74.5,1627.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="521" y1="1627.4727" y2="1627.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="1623.041">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="1623.041">HTTP Callback with Prepare result to DFSP1</text><!--
@startuml
' declate title
title 1.3. DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Position Failure

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-handler-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-handler-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic-handler" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic-handler" as TOPIC_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightBlue
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightGreen
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt Prepare Position Failure
    activate MLAPI
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    type: prepare,
                    action: prepare
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for DFSP1
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate API
    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates from - DFSP1
    PREP_HANDLER <-> PREP_HANDLER: Validates to - DFSP2
    PREP_HANDLER <-> PREP_HANDLER: Validates message signature
        note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    type: position,
                    action: prepare
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for DFSP1
    deactivate PREP_HANDLER
    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for DFSP1
    POS_HANDLER -> EVENT_DAO: Request to persist event information
    EVENT_DAO <-> DB: Persist event information
    EVENT_DAO -> POS_HANDLER: return success
    POS_HANDLER <-> DB: Retrieves latest position from DB for DFSP1
    POS_HANDLER <-> POS_HANDLER: Calculates latest position by decrementing transfer for prepare
    note right of POS_HANDLER #red: Validation failure!
    note right of POS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: http://ledger/dfsp1,
            to: http://ledger/dfsp2,
            type: application/json
            content: <transferResponseMessage>,
            metadata: {
                event: {
                    type: notification,
                    action: prepare
                }
            }
        }
    end note
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications (Failure) event for DFSP2
    deactivate POS_HANDLER
    activate NOTIFY_HANDLER
    TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
    NOTIFY_HANDLER -> CSAPI: Requests Notification details for DFSP1 - GET - HTTP://notifications/DFPS1
    CSAPI <-> NOTIFY_DAO: Fetches Notifications details for DFSP1
    CSAPI -> NOTIFY_HANDLER: Returns Notifications details for DFSP1
    NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to DFSP1
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>