<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3538px" preserveAspectRatio="none" style="width:4420px;height:3538px;" version="1.1" viewBox="0 0 4420 3538" width="4420px" zoomAndPan="magnify"><defs><filter height="300%" id="f1bfangphthv49" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="580" x="1921" y="23.5352">1.3. DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Position Failure</text><rect fill="#D3D3D3" height="3492.7324" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="3492.7324" style="stroke: #A80036; stroke-width: 1.0;" width="361" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="388.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="3492.7324" style="stroke: #A80036; stroke-width: 1.0;" width="3402" x="981" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="2631.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="1050.3223" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="407.3477" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="3001.0742"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="689.3164" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1592" y="1197.6094"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="1114.1484" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2538" y="1886.9258"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="3269.4453" style="stroke: #000000; stroke-width: 2.0;" width="4386" x="23" y="154.2871"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="271.1738" style="stroke: #000000; stroke-width: 2.0;" width="707" x="1508" y="1242.2305"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1936" x="2453" y="1931.5469"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1936" x="2453" y="2050.7891"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="229.1738" style="stroke: #000000; stroke-width: 2.0;" width="1936" x="2453" y="2170.0313"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="400.3477" style="stroke: #000000; stroke-width: 2.0;" width="4366" x="33" y="3016.3848"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="3988.5" x="400.5" y="3070.0059"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="526.5" x2="526.5" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1052" x2="1052" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1213" x2="1213" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1597" x2="1597" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2215" x2="2215" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2543" x2="2543" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3160" x2="3160" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3314" x2="3314" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3479" x2="3479" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3618" x2="3618" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3731" x2="3731" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3828" x2="3828" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3926" x2="3926" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4046" x2="4046" y1="137.2871" y2="3440.7324"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="4331" x2="4331" y1="137.2871" y2="3440.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="3453.2676">DFSP1</text><ellipse cx="67.5" cy="3466.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,3474.2207 L67.5,3501.2207 M54.5,3482.2207 L80.5,3482.2207 M67.5,3501.2207 L54.5,3516.2207 M67.5,3501.2207 L80.5,3516.2207 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="3453.2676">DFSP2</text><ellipse cx="126.5" cy="3466.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,3474.2207 L126.5,3501.2207 M113.5,3482.2207 L139.5,3482.2207 M126.5,3501.2207 L113.5,3516.2207 M126.5,3501.2207 L139.5,3516.2207 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="134.334">ML API Adapter</text><path d="M325,92.7988 L325,116.7988 M325,104.7988 L342,104.7988 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="3453.2676">ML API Adapter</text><path d="M325,3460.2207 L325,3484.2207 M325,3472.2207 L342,3472.2207 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="134.334">ML API Notification Event Handler</text><ellipse cx="527" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,92.7988,529,87.7988,527,92.7988,529,97.7988,523,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="410.5" y="3453.2676">ML API Notification Event Handler</text><ellipse cx="527" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="523,3460.2207,529,3455.2207,527,3460.2207,529,3465.2207,523,3460.2207" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="985" y="134.334">Central Service API</text><path d="M1031.5,92.7988 L1031.5,116.7988 M1031.5,104.7988 L1048.5,104.7988 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1060.5" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="985" y="3453.2676">Central Service API</text><path d="M1031.5,3460.2207 L1031.5,3484.2207 M1031.5,3472.2207 L1048.5,3472.2207 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1060.5" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1133" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1129" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1136" y="122.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1133" y="3439.7324"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1129" y="3443.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1136" y="3464.2676">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1518" y="134.334">Prepare Event Handler</text><ellipse cx="1597" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1593,92.7988,1599,87.7988,1597,92.7988,1599,97.7988,1593,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1518" y="3453.2676">Prepare Event Handler</text><ellipse cx="1597" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1593,3460.2207,1599,3455.2207,1597,3460.2207,1599,3465.2207,1593,3460.2207" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2134" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2130" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2137" y="122.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2134" y="3439.7324"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="2130" y="3443.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="2137" y="3464.2676">Position-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2463" y="134.334">Position Event Handler</text><ellipse cx="2543" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2539,92.7988,2545,87.7988,2543,92.7988,2545,97.7988,2539,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="2463" y="3453.2676">Position Event Handler</text><ellipse cx="2543" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2539,3460.2207,2545,3455.2207,2543,3460.2207,2545,3465.2207,2539,3460.2207" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3101" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3097" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="3104" y="122.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3101" y="3439.7324"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="3097" y="3443.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="3104" y="3464.2676">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="3233" y="134.334">Transfer Event Handler</text><ellipse cx="3314.5" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="3310.5,92.7988,3316.5,87.7988,3314.5,92.7988,3316.5,97.7988,3310.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="3233" y="3453.2676">Transfer Event Handler</text><ellipse cx="3314.5" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="3310.5,3460.2207,3316.5,3455.2207,3314.5,3460.2207,3316.5,3465.2207,3310.5,3460.2207" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3410" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3406" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3413" y="122.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3410" y="3439.7324"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="3406" y="3443.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="3413" y="3464.2676">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="3567" y="97.7988"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="3563" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="3570" y="122.334">Errors-Topic</text><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="3567" y="3439.7324"/><rect fill="#FEFECE" filter="url(#f1bfangphthv49)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="3563" y="3443.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="3570" y="3464.2676">Errors-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3683" y="134.334">Position DAO</text><ellipse cx="3731" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3719" x2="3743" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="3683" y="3453.2676">Position DAO</text><ellipse cx="3731" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3719" x2="3743" y1="3486.2207" y2="3486.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3789" y="134.334">Event DAO</text><ellipse cx="3828" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3816" x2="3840" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="3789" y="3453.2676">Event DAO</text><ellipse cx="3828" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3816" x2="3840" y1="3486.2207" y2="3486.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3877" y="134.334">Transfer DAO</text><ellipse cx="3926.5" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3914.5" x2="3938.5" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="3877" y="3453.2676">Transfer DAO</text><ellipse cx="3926.5" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3914.5" x2="3938.5" y1="3486.2207" y2="3486.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3986" y="134.334">Notification DAO</text><ellipse cx="4046" cy="104.7988" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4034" x2="4058" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="3986" y="3453.2676">Notification DAO</text><ellipse cx="4046" cy="3472.2207" fill="#FEFECE" filter="url(#f1bfangphthv49)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="4034" x2="4058" y1="3486.2207" y2="3486.2207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4283" y="134.334">Central Store</text><path d="M4313,84.7988 C4313,74.7988 4331,74.7988 4331,74.7988 C4331,74.7988 4349,74.7988 4349,84.7988 L4349,110.7988 C4349,120.7988 4331,120.7988 4331,120.7988 C4331,120.7988 4313,120.7988 4313,110.7988 L4313,84.7988 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M4313,84.7988 C4313,94.7988 4331,94.7988 4331,94.7988 C4331,94.7988 4349,94.7988 4349,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="4283" y="3453.2676">Central Store</text><path d="M4313,3466.2207 C4313,3456.2207 4331,3456.2207 4331,3456.2207 C4331,3456.2207 4349,3456.2207 4349,3466.2207 L4349,3492.2207 C4349,3502.2207 4331,3502.2207 4331,3502.2207 C4331,3502.2207 4313,3502.2207 4313,3492.2207 L4313,3466.2207 " fill="#FEFECE" filter="url(#f1bfangphthv49)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M4313,3466.2207 C4313,3476.2207 4331,3476.2207 4331,3476.2207 C4331,3476.2207 4349,3476.2207 4349,3466.2207 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="1050.3223" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="407.3477" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="522" y="3001.0742"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="689.3164" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1592" y="1197.6094"/><rect fill="#FFFFFF" filter="url(#f1bfangphthv49)" height="1114.1484" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2538" y="1886.9258"/><rect fill="none" height="3269.4453" style="stroke: #000000; stroke-width: 2.0;" width="4386" x="23" y="154.2871"/><polygon fill="#EEEEEE" points="23,154.2871,85,154.2871,85,161.2871,75,171.2871,23,171.2871,23,154.2871" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="167.8555">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="100" y="166.9219">[Prepare Position Failure]</text><polygon fill="#FFFF00" filter="url(#f1bfangphthv49)" points="72,176.5977,72,706.5977,413,706.5977,413,186.5977,403,176.5977,72,176.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403" x2="403" y1="176.5977" y2="186.5977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="413" x2="403" y1="186.5977" y2="186.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="78" y="194.166">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="209.4766">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="224.7871">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="240.0977">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="255.4082">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="270.7188">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="286.0293">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="301.3398">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="316.6504">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="331.9609">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="347.2715">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="362.582">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="377.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="78" y="393.2031">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="408.5137">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="94" y="423.8242">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="94" y="439.1348">"payeeFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="94" y="454.4453">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="94" y="469.7559">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="110" y="485.0664">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="110" y="500.377">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="515.6875">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="94" y="530.998">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="94" y="546.3086">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="94" y="561.6191">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="576.9297">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="592.2402">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="607.5508">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="142" y="622.8613">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="142" y="638.1719">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="653.4824">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="668.793">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="684.1035">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="699.4141">}</text><polygon fill="#A80036" points="328.5,733.1563,338.5,737.1563,328.5,741.1563,332.5,737.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="334.5" y1="737.1563" y2="737.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="732.7246">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="87.5" y="732.7246">POST - http://transfers</text><polygon fill="#FFFF00" filter="url(#f1bfangphthv49)" points="355,750.4668,355,1066.4668,583,1066.4668,583,760.4668,573,750.4668,355,750.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="573" x2="573" y1="750.4668" y2="760.4668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="583" x2="573" y1="760.4668" y2="760.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="768.0352">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="783.3457">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="377" y="798.6563">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="377" y="813.9668">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="377" y="829.2773">to: dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="844.5879">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="377" y="859.8984">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="875.209">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="890.5195">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="905.8301">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="921.1406">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="936.4512">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="951.7617">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="967.0723">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="425" y="982.3828">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="997.6934">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1013.0039">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1028.3145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1043.625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1058.9355">}</text><polygon fill="#A80036" points="1201,1092.6777,1211,1096.6777,1201,1100.6777,1205,1096.6777" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1207" y1="1096.6777" y2="1096.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1092.2461">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="370.5" y="1092.2461">Routes &amp; Publishes Prepare event for Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1213" x2="1255" y1="1126.2988" y2="1126.2988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1255" x2="1255" y1="1126.2988" y2="1139.2988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1214" x2="1255" y1="1139.2988" y2="1139.2988"/><polygon fill="#A80036" points="1224,1135.2988,1214,1139.2988,1224,1143.2988,1220,1139.2988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1220" y="1121.5566">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1233" y="1121.5566">Ensures that event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="361.5,1164.2988,351.5,1168.2988,361.5,1172.2988,357.5,1168.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="1212" y1="1168.2988" y2="1168.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1163.8672">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="380.5" y="1163.8672">Responds replication acknoledgements have been received</text><polygon fill="#A80036" points="78.5,1193.6094,68.5,1197.6094,78.5,1201.6094,74.5,1197.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="344.5" y1="1197.6094" y2="1197.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1193.1777">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1193.1777">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1580,1222.9199,1590,1226.9199,1580,1230.9199,1584,1226.9199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1213" x2="1586" y1="1226.9199" y2="1226.9199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1220" y="1222.4883">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1233" y="1222.4883">Consumes Prepare event message for Payer</text><rect fill="none" height="271.1738" style="stroke: #000000; stroke-width: 2.0;" width="707" x="1508" y="1242.2305"/><polygon fill="#EEEEEE" points="1508,1242.2305,1570,1242.2305,1570,1249.2305,1560,1259.2305,1508,1259.2305,1508,1242.2305" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1523" y="1255.7988">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="1585" y="1254.8652">[Validate Prepare Transfer]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1280.8516" y2="1280.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1280.8516" y2="1293.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1293.8516" y2="1293.8516"/><polygon fill="#A80036" points="1613,1289.8516,1603,1293.8516,1613,1297.8516,1609,1293.8516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1609" y="1276.1094">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="1622" y="1276.1094">Request to persist event information (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1323.1621" y2="1323.1621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1323.1621" y2="1336.1621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1336.1621" y2="1336.1621"/><polygon fill="#A80036" points="1613,1332.1621,1603,1336.1621,1613,1340.1621,1609,1336.1621" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1609" y="1318.4199">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1622" y="1318.4199">Validates from - Payer (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1365.4727" y2="1365.4727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1365.4727" y2="1378.4727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1378.4727" y2="1378.4727"/><polygon fill="#A80036" points="1613,1374.4727,1603,1378.4727,1613,1382.4727,1609,1378.4727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1609" y="1360.7305">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="1622" y="1360.7305">Validates to - Payee (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1407.7832" y2="1407.7832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1407.7832" y2="1420.7832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1420.7832" y2="1420.7832"/><polygon fill="#A80036" points="1613,1416.7832,1603,1420.7832,1613,1424.7832,1609,1420.7832" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1403.041">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="1631" y="1403.041">Validates duplicate Check (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1450.0938" y2="1450.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1450.0938" y2="1463.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1463.0938" y2="1463.0938"/><polygon fill="#A80036" points="1613,1459.0938,1603,1463.0938,1613,1467.0938,1609,1463.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1445.3516">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="1631" y="1445.3516">Validates crypto-condition (refer to 1.1 for detail)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1602" x2="1644" y1="1492.4043" y2="1492.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1644" x2="1644" y1="1492.4043" y2="1505.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1603" x2="1644" y1="1505.4043" y2="1505.4043"/><polygon fill="#A80036" points="1613,1501.4043,1603,1505.4043,1613,1509.4043,1609,1505.4043" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1609" y="1487.6621">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="572" x="1631" y="1487.6621">Validates message signature (to be confirmed in future requirement) (refer to 1.1 for detail)</text><polygon fill="#FFFF00" filter="url(#f1bfangphthv49)" points="1607,1525.4043,1607,1856.4043,1867,1856.4043,1867,1535.4043,1857,1525.4043,1607,1525.4043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1857" x2="1857" y1="1525.4043" y2="1535.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1867" x2="1857" y1="1535.4043" y2="1535.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="1613" y="1542.9727">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1613" y="1558.2832">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1629" y="1573.5938">id: &lt;transferMessage.id&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1629" y="1588.9043">from: dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1629" y="1604.2148">to: dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1629" y="1619.5254">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1629" y="1634.8359">content: &lt;transferMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1629" y="1650.1465">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1645" y="1665.457">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1661" y="1680.7676">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1661" y="1696.0781">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1661" y="1711.3887">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1661" y="1726.6992">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1661" y="1742.0098">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="1661" y="1757.3203">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="1677" y="1772.6309">status: "success"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1677" y="1787.9414">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1661" y="1803.252">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1645" y="1818.5625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1629" y="1833.873">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1613" y="1849.1836">}</text><polygon fill="#A80036" points="2203,1882.9258,2213,1886.9258,2203,1890.9258,2207,1886.9258" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1597" x2="2209" y1="1886.9258" y2="1886.9258"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1604" y="1882.4941">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="1626" y="1882.4941">Routes &amp; Publishes Position event for Payer</text><polygon fill="#A80036" points="2526,1912.2363,2536,1916.2363,2526,1920.2363,2530,1916.2363" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2215" x2="2532" y1="1916.2363" y2="1916.2363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2222" y="1911.8047">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="2244" y="1911.8047">Consumes Position event message for Payer</text><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1936" x="2453" y="1931.5469"/><polygon fill="#EEEEEE" points="2453,1931.5469,2515,1931.5469,2515,1938.5469,2505,1948.5469,2453,1948.5469,2453,1931.5469" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="2468" y="1945.1152">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="2530" y="1944.1816">[Persist Event Information]</text><polygon fill="#A80036" points="3816,1965.8574,3826,1969.8574,3816,1973.8574,3820,1969.8574" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2548" x2="3822" y1="1969.8574" y2="1969.8574"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2555" y="1965.4258">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="2577" y="1965.4258">Request to persist event information</text><polygon fill="#A80036" points="3839,1995.168,3829,1999.168,3839,2003.168,3835,1999.168" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4319,1995.168,4329,1999.168,4319,2003.168,4323,1999.168" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3833" x2="4325" y1="1999.168" y2="1999.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3845" y="1994.7363">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3867" y="1994.7363">Persist event information</text><polygon fill="#A80036" points="2559,2024.4785,2549,2028.4785,2559,2032.4785,2555,2028.4785" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2553" x2="3827" y1="2028.4785" y2="2028.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2565" y="2024.0469">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2587" y="2024.0469">return success</text><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="1936" x="2453" y="2050.7891"/><polygon fill="#EEEEEE" points="2453,2050.7891,2515,2050.7891,2515,2057.7891,2505,2067.7891,2453,2067.7891,2453,2050.7891" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="2468" y="2064.3574">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="336" x="2530" y="2063.4238">[Persist Prepare Transfer State with transferState='pending']</text><polygon fill="#A80036" points="3914.5,2085.0996,3924.5,2089.0996,3914.5,2093.0996,3918.5,2089.0996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2548" x2="3920.5" y1="2089.0996" y2="2089.0996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2555" y="2084.668">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="2577" y="2084.668">Request to persist transfer</text><polygon fill="#A80036" points="3937.5,2114.4102,3927.5,2118.4102,3937.5,2122.4102,3933.5,2118.4102" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4319,2114.4102,4329,2118.4102,4319,2122.4102,4323,2118.4102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3931.5" x2="4325" y1="2118.4102" y2="2118.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3943.5" y="2113.9785">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="3965.5" y="2113.9785">Persist transfer</text><polygon fill="#A80036" points="2559,2143.7207,2549,2147.7207,2559,2151.7207,2555,2147.7207" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2553" x2="3925.5" y1="2147.7207" y2="2147.7207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2565" y="2143.2891">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="2587" y="2143.2891">return success</text><rect fill="none" height="229.1738" style="stroke: #000000; stroke-width: 2.0;" width="1936" x="2453" y="2170.0313"/><polygon fill="#EEEEEE" points="2453,2170.0313,2515,2170.0313,2515,2177.0313,2505,2187.0313,2453,2187.0313,2453,2170.0313" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="2468" y="2183.5996">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="2530" y="2182.666">[Calculate position and persist change]</text><polygon fill="#A80036" points="3719,2204.3418,3729,2208.3418,3719,2212.3418,3723,2208.3418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2548" x2="3725" y1="2208.3418" y2="2208.3418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2555" y="2203.9102">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="2577" y="2203.9102">Request latest position from DB for Payer</text><polygon fill="#A80036" points="3742,2233.6523,3732,2237.6523,3742,2241.6523,3738,2237.6523" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4319,2233.6523,4329,2237.6523,4319,2241.6523,4323,2237.6523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3736" x2="4325" y1="2237.6523" y2="2237.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3748" y="2233.2207">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="3770" y="2233.2207">Retrieves latest position from DB for Payer</text><polygon fill="#A80036" points="2559,2262.9629,2549,2266.9629,2559,2270.9629,2555,2266.9629" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2553" x2="3730" y1="2266.9629" y2="2266.9629"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2565" y="2262.5313">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="2587" y="2262.5313">Return latest position</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2548" x2="2590" y1="2296.584" y2="2296.584"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2590" x2="2590" y1="2296.584" y2="2309.584"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2549" x2="2590" y1="2309.584" y2="2309.584"/><polygon fill="#A80036" points="2559,2305.584,2549,2309.584,2559,2313.584,2555,2309.584" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2555" y="2291.8418">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="2577" y="2291.8418">Calculates latest position (lpos) by incrementing transfer for prepare</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2548" x2="2590" y1="2338.8945" y2="2338.8945"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2590" x2="2590" y1="2338.8945" y2="2351.8945"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2549" x2="2590" y1="2351.8945" y2="2351.8945"/><polygon fill="#A80036" points="2559,2347.8945,2549,2351.8945,2559,2355.8945,2555,2351.8945" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2555" y="2334.1523">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="571" x="2577" y="2334.1523">Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos &lt; netcap</text><polygon fill="#FF0000" filter="url(#f1bfangphthv49)" points="2553,2364.8945,2553,2389.8945,2685,2389.8945,2685,2374.8945,2675,2364.8945,2553,2364.8945" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2675" x2="2675" y1="2364.8945" y2="2374.8945"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2685" x2="2675" y1="2374.8945" y2="2374.8945"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="2559" y="2382.4629">Validation failure!</text><polygon fill="#FFFF00" filter="url(#f1bfangphthv49)" points="2553,2411.2051,2553,2941.2051,2963,2941.2051,2963,2421.2051,2953,2411.2051,2553,2411.2051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2953" x2="2953" y1="2411.2051" y2="2421.2051"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2963" x2="2953" y1="2421.2051" y2="2421.2051"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="2559" y="2428.7734">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2559" y="2444.084">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="2575" y="2459.3945">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="2575" y="2474.7051">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="2575" y="2490.0156">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="2575" y="2505.3262">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="2575" y="2520.6367">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="2591" y="2535.9473">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="2591" y="2551.2578">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="2607" y="2566.5684">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="2623" y="2581.8789">"errorCode": 4001,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="325" x="2623" y="2597.1895">"errorDescription": "Payer FSP insufficient liquidity",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="2623" y="2612.5">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2591" y="2627.8105">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2575" y="2643.1211">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="2575" y="2658.4316">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="2591" y="2673.7422">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="2607" y="2689.0527">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="2607" y="2704.3633">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2607" y="2719.6738">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2607" y="2734.9844">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="2607" y="2750.2949">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="2607" y="2765.6055">status: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="2623" y="2780.916">type: functional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="2623" y="2796.2266">code: failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2607" y="2811.5371">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="2607" y="2826.8477">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="2623" y="2842.1582">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="2623" y="2857.4688">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="2623" y="2872.7793">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2607" y="2888.0898">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2591" y="2903.4004">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2575" y="2918.7109">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2559" y="2934.0215">}</text><polygon fill="#A80036" points="3467.5,2967.7637,3477.5,2971.7637,3467.5,2975.7637,3471.5,2971.7637" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2548" x2="3473.5" y1="2971.7637" y2="2971.7637"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2555" y="2967.332">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="295" x="2577" y="2967.332">Publishes Notifications (failure) event for Payer</text><polygon fill="#A80036" points="3606,2997.0742,3616,3001.0742,3606,3005.0742,3610,3001.0742" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2543" x2="3612" y1="3001.0742" y2="3001.0742"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2550" y="2996.6426">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479" x="2572" y="2996.6426">Publishes Notification (failure) event for Payer (handled by seperate process)</text><rect fill="none" height="400.3477" style="stroke: #000000; stroke-width: 2.0;" width="4366" x="33" y="3016.3848"/><polygon fill="#EEEEEE" points="33,3016.3848,95,3016.3848,95,3023.3848,85,3033.3848,33,3033.3848,33,3016.3848" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="3029.9531">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="110" y="3029.0195">[Send notification for Payer]</text><polygon fill="#A80036" points="543,3050.6953,533,3054.6953,543,3058.6953,539,3054.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="3478.5" y1="3054.6953" y2="3054.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="3050.2637">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="3050.2637">Consumes Notifications event</text><rect fill="none" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="3988.5" x="400.5" y="3070.0059"/><polygon fill="#EEEEEE" points="400.5,3070.0059,462.5,3070.0059,462.5,3077.0059,452.5,3087.0059,400.5,3087.0059,400.5,3070.0059" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="415.5" y="3083.5742">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="477.5" y="3082.6406">[Persist Event Information]</text><polygon fill="#A80036" points="1040,3104.3164,1050,3108.3164,1040,3112.3164,1044,3108.3164" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1046" y1="3108.3164" y2="3108.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="3103.8848">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="561" y="3103.8848">Requests to persist event information - POST - HTTP://events/</text><polygon fill="#A80036" points="3816,3133.627,3826,3137.627,3816,3141.627,3820,3137.627" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052" x2="3822" y1="3137.627" y2="3137.627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1059" y="3133.1953">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1081" y="3133.1953">Request to persist event information</text><polygon fill="#A80036" points="3839,3162.9375,3829,3166.9375,3839,3170.9375,3835,3166.9375" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4319,3162.9375,4329,3166.9375,4319,3170.9375,4323,3166.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3833" x2="4325" y1="3166.9375" y2="3166.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="3845" y="3162.5059">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="3867" y="3162.5059">Persist event information</text><polygon fill="#A80036" points="1063,3192.248,1053,3196.248,1063,3200.248,1059,3196.248" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1057" x2="3827" y1="3196.248" y2="3196.248"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1069" y="3191.8164">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1091" y="3191.8164">return success</text><polygon fill="#A80036" points="543,3221.5586,533,3225.5586,543,3229.5586,539,3225.5586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1051" y1="3225.5586" y2="3225.5586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="3221.127">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="571" y="3221.127">return success</text><polygon fill="#A80036" points="1040,3257.8691,1050,3261.8691,1040,3265.8691,1044,3261.8691" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="532" x2="1046" y1="3261.8691" y2="3261.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="539" y="3257.4375">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="561" y="3257.4375">Requests Notification details for Payer - GET - HTTP://notifications/DFPS1</text><polygon fill="#A80036" points="4034,3287.1797,4044,3291.1797,4034,3295.1797,4038,3291.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1052" x2="4040" y1="3291.1797" y2="3291.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1059" y="3286.748">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1081" y="3286.748">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="4057,3316.4902,4047,3320.4902,4057,3324.4902,4053,3320.4902" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4319,3316.4902,4329,3320.4902,4319,3324.4902,4323,3320.4902" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="4051" x2="4325" y1="3320.4902" y2="3320.4902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="4063" y="3316.0586">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="4085" y="3316.0586">Fetches Notifications details for Payer</text><polygon fill="#A80036" points="1063,3345.8008,1053,3349.8008,1063,3353.8008,1059,3349.8008" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1057" x2="4045" y1="3349.8008" y2="3349.8008"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1069" y="3345.3691">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1091" y="3345.3691">Returns Notifications details for Payer</text><polygon fill="#A80036" points="543,3375.1113,533,3379.1113,543,3383.1113,539,3379.1113" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="537" x2="1051" y1="3379.1113" y2="3379.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="549" y="3374.6797">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="571" y="3374.6797">Returns Notifications details for Payer</text><polygon fill="#A80036" points="78.5,3404.4219,68.5,3408.4219,78.5,3412.4219,74.5,3408.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="526" y1="3408.4219" y2="3408.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="3403.9902">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="106.5" y="3403.9902">HTTP Callback with Prepare result to Payer</text><!--
@startuml
' declate title
title 1.3. DFSP1 sends a Prepare Transfer request to DFSP2 - Prepare Position Failure

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor DFSP1
actor DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "Errors-Topic" as ERRORS_NOTIFICATIONS
entity "Position DAO" as POS_DAO
entity "Event DAO" as EVENT_DAO
entity "Transfer DAO" as TRANS_DAO
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Providers" #LightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant ERRORS_NOTIFICATIONS
    participant POS_DAO
    participant EVENT_DAO
    participant TRANS_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
alt Prepare Position Failure
    activate MLAPI
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp1,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    DFSP1 -> MLAPI: POST - http://transfers
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_PREPARE_DFSP1: Routes & Publishes Prepare event for Payer
    TOPIC_PREPARE_DFSP1 <-> TOPIC_PREPARE_DFSP1: Ensures that event is replicated as configured (ACKS=all)
    TOPIC_PREPARE_DFSP1 -> MLAPI: Responds replication acknoledgements have been received
    MLAPI -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI

    activate PREP_HANDLER
    TOPIC_PREPARE_DFSP1 -> PREP_HANDLER: Consumes Prepare event message for Payer
    alt Validate Prepare Transfer
        PREP_HANDLER <-> PREP_HANDLER: Request to persist event information (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates from - Payer (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates to - Payee (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates duplicate Check (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates crypto-condition (refer to 1.1 for detail)
        PREP_HANDLER <-> PREP_HANDLER: Validates message signature (to be confirmed in future requirement) (refer to 1.1 for detail)
    end
    note right of PREP_HANDLER #yellow
        Message:
        {
            id: <transferMessage.id>
            from: dfsp1,
            to: dfsp2,
            type: application/json
            content: <transferMessage>,
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: position,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success"
                        code: 0
                    }
                }
            }
        }
    end note
    PREP_HANDLER -> TOPIC_POSITION_DFSP1: Routes & Publishes Position event for Payer
    deactivate PREP_HANDLER

    activate POS_HANDLER
    TOPIC_POSITION_DFSP1 -> POS_HANDLER: Consumes Position event message for Payer
    alt Persist Event Information
        POS_HANDLER -> EVENT_DAO: Request to persist event information
        EVENT_DAO <-> DB: Persist event information
        EVENT_DAO -> POS_HANDLER: return success
    end

    alt Persist Prepare Transfer State with transferState='pending'
        POS_HANDLER -> TRANS_DAO: Request to persist transfer
        TRANS_DAO <-> DB: Persist transfer
        TRANS_DAO -> POS_HANDLER: return success
    end

    alt Calculate position and persist change
        POS_HANDLER -> POS_DAO: Request latest position from DB for Payer
        POS_DAO <-> DB: Retrieves latest position from DB for Payer
        POS_DAO -> POS_HANDLER: Return latest position

        POS_HANDLER <-> POS_HANDLER: Calculates latest position (lpos) by incrementing transfer for prepare
        POS_HANDLER <-> POS_HANDLER: Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos < netcap
        
        note right of POS_HANDLER #red: Validation failure!
    end
    ' POS_HANDLER -> EVENT_DAO: Request to persist event information
    ' EVENT_DAO <-> DB: Persist event information
    ' EVENT_DAO -> POS_HANDLER: return success
    note right of POS_HANDLER #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <ledgerName>,
            to: <transferMessage.payerFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: {
                    "errorInformation": {
                        "errorCode": 4001,
                        "errorDescription": "Payer FSP insufficient liquidity",
                        "extensionList": <transferMessage.extensionList>
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: prepare,
                    createdAt: <timestamp>,
                    status: {
                        type: functional
                        code: failure
                    }
                    state: {
                        status: 'error',
                        code: <errorInformation.errorCode>
                        description: <errorInformation.errorDescription>
                    }
                }
            }
        }
    end note
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Publishes Notifications (failure) event for Payer
    POS_HANDLER -> ERRORS_NOTIFICATIONS: Publishes Notification (failure) event for Payer (handled by seperate process)
    deactivate POS_HANDLER

    alt Send notification for Payer
        activate NOTIFY_HANDLER
        TOPIC_NOTIFICATIONS -> NOTIFY_HANDLER: Consumes Notifications event
        alt Persist Event Information
            NOTIFY_HANDLER -> CSAPI: Requests to persist event information - POST - HTTP://events/
            CSAPI -> EVENT_DAO: Request to persist event information
            EVENT_DAO <-> DB: Persist event information
            EVENT_DAO -> CSAPI: return success
            CSAPI -> NOTIFY_HANDLER: return success
        end
        NOTIFY_HANDLER -> CSAPI: Requests Notification details for Payer - GET - HTTP://notifications/DFPS1
        CSAPI -> NOTIFY_DAO: Fetches Notifications details for Payer
        NOTIFY_DAO <-> DB: Fetches Notifications details for Payer
        NOTIFY_DAO -> CSAPI: Returns Notifications details for Payer
        CSAPI -> NOTIFY_HANDLER: Returns Notifications details for Payer
        NOTIFY_HANDLER -> DFSP1: HTTP Callback with Prepare result to Payer
        deactivate NOTIFY_HANDLER
    end
end
@enduml

PlantUML version 1.2017.18(Fri Oct 06 18:56:32 SAST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>